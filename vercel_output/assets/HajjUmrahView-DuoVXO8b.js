import{c as il,r as I,k as Rt,j as t,b as Yl,a as tt,p as lt,B as Lt,G as Ut,X as ze,i as W,q as it,F as Wt,l as Kl,h as Wl,T as Zl,o as Zt,s as el}from"./index-D5SAcJeb.js";import{P as Dt}from"./package-Dboa16hE.js";import{L as nt}from"./layers-CL93vmD0.js";import{P as Se}from"./plus-BF-0wA7Y.js";import{P as xt}from"./pen-D_z02ClP.js";import{T as Pt}from"./trash-2-DM2JoFNM.js";import{S as ei}from"./save-rr93RyJ0.js";import{M as ti}from"./map-pin-rBoBnscX.js";import{C as tl}from"./calendar-D1O96ZoP.js";import{B as ll}from"./ban-Cmi2X8G8.js";import{P as li}from"./percent-BheMet7L.js";import{T as ii}from"./tag-BL2AETyq.js";import{C as ni}from"./calculator-DtoQFCRR.js";import{A as si}from"./activity-CugLzOtG.js";import{P as ri}from"./printer-C1bXofd9.js";import{C as ai}from"./chevron-left-DH7PncNj.js";const di=[["path",{d:"M3.85 8.62a4 4 0 0 1 4.78-4.77 4 4 0 0 1 6.74 0 4 4 0 0 1 4.78 4.78 4 4 0 0 1 0 6.74 4 4 0 0 1-4.77 4.78 4 4 0 0 1-6.75 0 4 4 0 0 1-4.78-4.77 4 4 0 0 1 0-6.76Z",key:"3c2336"}],["path",{d:"M16 8h-6a2 2 0 1 0 0 4h4a2 2 0 1 1 0 4H8",key:"1h4pet"}],["path",{d:"M12 18V6",key:"zqpxq5"}]],mt=il("badge-dollar-sign",di);const oi=[["path",{d:"M18 5h4",key:"1lhgn2"}],["path",{d:"M20 3v4",key:"1olli1"}],["path",{d:"M20.985 12.486a9 9 0 1 1-9.473-9.472c.405-.022.617.46.402.803a6 6 0 0 0 8.268 8.268c.344-.215.825-.004.803.401",key:"kfwtm"}]],ci=il("moon-star",oi),st={name:"",masterTripId:"",customerId:"",supplierId:"",supplierType:"SUPPLIER",purchasePrice:"",sellingPrice:"",adultPurchasePrice:"",childPurchasePrice:"",infantPurchasePrice:"",singlePurchasePrice:"",singleChildPurchasePrice:"",singleInfantPurchasePrice:"",doublePurchasePrice:"",doubleChildPurchasePrice:"",doubleInfantPurchasePrice:"",triplePurchasePrice:"",tripleChildPurchasePrice:"",tripleInfantPurchasePrice:"",quadPurchasePrice:"",quadChildPurchasePrice:"",quadInfantPurchasePrice:"",adultSellingPrice:"",childSellingPrice:"",infantSellingPrice:"",singleSellingPrice:"",singleChildSellingPrice:"",singleInfantSellingPrice:"",doubleSellingPrice:"",doubleChildSellingPrice:"",doubleInfantSellingPrice:"",tripleSellingPrice:"",tripleChildSellingPrice:"",tripleInfantSellingPrice:"",quadSellingPrice:"",quadChildSellingPrice:"",quadInfantSellingPrice:"",adultAgentPrice:"",childAgentPrice:"",infantAgentPrice:"",singleAgentPrice:"",doubleAgentPrice:"",tripleAgentPrice:"",quadAgentPrice:"",type:"UMRAH",date:new Date().toISOString().split("T")[0],currencyCode:"EGP",exchangeRate:"1",components:[],adultCount:"0",childCount:"0",infantCount:"0",roomType:"DEFAULT",singleAdultCount:"0",singleChildCount:"0",singleInfantCount:"0",doubleAdultCount:"0",doubleChildCount:"0",doubleInfantCount:"0",tripleAdultCount:"0",tripleChildCount:"0",tripleInfantCount:"0",quadAdultCount:"0",quadChildCount:"0",quadInfantCount:"0",isAgent:!1,employeeId:"",employeeCommissionRate:"",commissionAmount:"",applyCommission:!0},Ft={programId:"",customerId:"",agentId:"",bookingType:"DIRECT",employeeId:"",accommodationEmployeeId:"",accommodation:"",names:"",roomType:"DEFAULT",discount:"0",date:new Date().toISOString().split("T")[0],customSellingPrice:"",adultCount:"1",childCount:"0",infantCount:"0",supervisorCount:"0",supervisorName:"",employeeCommissionRate:"",commissionAmount:"",applyCommission:!0,costCenterId:""},Gt={type:"FLIGHT",name:"",pricingMode:"PER_PERSON",quantity:"1",purchasePrice:"",sellingPrice:"",adultPurchasePrice:"",childPurchasePrice:"",infantPurchasePrice:"",singlePurchasePrice:"",singleChildPurchasePrice:"",singleInfantPurchasePrice:"",doublePurchasePrice:"",doubleChildPurchasePrice:"",doubleInfantPurchasePrice:"",triplePurchasePrice:"",tripleChildPurchasePrice:"",tripleInfantPurchasePrice:"",quadPurchasePrice:"",quadChildPurchasePrice:"",quadInfantPurchasePrice:"",adultSellingPrice:"",childSellingPrice:"",infantSellingPrice:"",singleSellingPrice:"",singleChildSellingPrice:"",singleInfantSellingPrice:"",doubleSellingPrice:"",doubleChildSellingPrice:"",doubleInfantSellingPrice:"",tripleSellingPrice:"",tripleChildSellingPrice:"",tripleInfantSellingPrice:"",quadSellingPrice:"",quadChildSellingPrice:"",quadInfantSellingPrice:"",currencyCode:"EGP",exchangeRate:"1",supplierId:"",details:"",supplierType:"SUPPLIER",isCommissionable:!0,employeeId:"",commissionAmount:0},Ti=({transactions:T,journalEntries:kt,addTransaction:G,updateTransaction:je,deleteTransaction:qt,voidTransaction:Ot,deleteMasterTrip:nl,restoreMasterTrip:sl,deleteProgram:rl,customers:Q,suppliers:O,treasuries:bt,currencies:ke,programs:A,setPrograms:rt,masterTrips:Ce,setMasterTrips:Mt,employees:H,currentUser:B,addAuditLog:Je,searchTerm:qe="",formatCurrency:N,costCenters:$t,enableCostCenters:_t,onManageAccommodation:al,initialEditingId:yt,onClearInitialEdit:Ht,settings:D,notify:V,askConfirm:Oe})=>{const se=B?.permissions?.includes("HIDE_FINANCIAL_AMOUNTS"),oe=B?.role==="BOOKING_EMPLOYEE",k=se||oe,ft=I.useMemo(()=>{const e={},l={};return(Q||[]).forEach(d=>{d&&d.id&&(e[d.id]=d.openingBalanceInBase||0)}),(O||[]).forEach(d=>{d&&d.id&&(l[d.id]=d.openingBalanceInBase||0)}),(kt||[]).forEach(d=>{(d?.lines||[]).forEach(p=>{if(!p||!p.accountId)return;const r=typeof p.debit=="number"?p.debit:parseFloat(p.debit)||0,g=typeof p.credit=="number"?p.credit:parseFloat(p.credit)||0;p.accountType==="CUSTOMER"&&e[p.accountId]!==void 0?e[p.accountId]+=r-g:p.accountType==="SUPPLIER"&&l[p.accountId]!==void 0&&(l[p.accountId]+=g-r)})}),{customers:e,suppliers:l}},[Q,O,kt]),[ge,at]=I.useState("PROGRAMS"),[K,dl]=I.useState("SINGLE"),[xe,ol]=I.useState("SINGLE"),Xe=I.useMemo(()=>{const e=Array.isArray(A)?A:[],l=e.length,d=(T||[]).filter(m=>m&&!m.isVoided&&(m.category==="HAJJ"||m.category==="UMRAH")&&m.type==="INCOME"),p=d.length,r=d.reduce((m,E)=>m+(E?.amountInBase||0),0),g=new Date().getTime(),f=e.filter(m=>m&&m.date&&new Date(m.date).getTime()>=g).length,j=(T||[]).filter(m=>m&&!m.isVoided&&m.category==="GUARANTEE_LETTER"&&m.type==="EXPENSE").length,M=(T||[]).filter(m=>m&&!m.isVoided&&m.category==="GUARANTEE_LETTER"&&m.type==="INCOME").length;return{totalPrograms:l,totalBookings:p,revenue:r,activePrograms:f,openGuarantees:j,releasedGuarantees:M}},[A,T]),[cl,Ee]=I.useState(!1),[ul,Ye]=I.useState(!1),[pl,dt]=I.useState(!1),[F,Ke]=I.useState(null),[Z,St]=I.useState(null),[hl,ot]=I.useState(!1),[Pe,It]=I.useState(null),[C,ce]=I.useState({supplierId:"",programId:"",amount:"",currencyCode:D?.baseCurrency||"EGP",exchangeRate:"1",treasuryId:"",date:new Date().toISOString().split("T")[0],details:"",costCenterId:""}),[c,y]=I.useState(()=>({...Gt,currencyCode:D?.baseCurrency||"EGP"})),[We,Nt]=I.useState(null),[ve,Bt]=I.useState(null),[gl,Me]=I.useState(!1),[$e,xl]=I.useState(!1),[Ze,jt]=I.useState(null),[Te,ct]=I.useState([]),[Pl,Vt]=I.useState(null),[ml,ut]=I.useState(!1),[bl,pt]=I.useState(!1),[w,ht]=I.useState({programId:"",componentId:"",compName:"",supplierName:"",originalQuantity:1,quantity:"1",amount:"",currencyCode:"EGP",exchangeRate:"1",supplierId:"",supplierType:"SUPPLIER"});I.useEffect(()=>{if(yt){const e=(T||[]).find(l=>l?.id===yt);e&&(at("BOOKINGS"),Vt(e.id),setTimeout(()=>{const l=document.getElementById(`booking-${e.id}`);l&&(l.scrollIntoView({behavior:"smooth",block:"center"}),setTimeout(()=>Vt(null),3e3))},500)),Ht?.()}},[yt,T,Ht]);const[re,we]=I.useState({name:"",date:new Date().toISOString().split("T")[0],type:"UMRAH",details:"",components:[]}),yl=()=>{setTimeout(()=>{const e=document.getElementById("rooming-list-to-print"),l=document.getElementById("print-section");if(e&&l){l.innerHTML="";const d=e.cloneNode(!0);l.appendChild(d),document.body.classList.add("printing-mode"),setTimeout(()=>{window.print(),setTimeout(()=>{document.body.classList.remove("printing-mode")},1e3)},300)}else V("خطأ: لم يتم العثور على محتوى للطباعة","error")},300)},[Ct,Qt]=I.useState(""),[Et,zt]=I.useState(""),_e=I.useMemo(()=>{const e={};return(O||[]).forEach(l=>{if(l&&l.id&&l.isSaudiWallet){const d=(T||[]).filter(p=>p&&!p.isVoided&&(p.supplierId===l.id||p.relatedEntityId===l.id)&&(p.category==="HAJJ"||p.category==="UMRAH")).reduce((p,r)=>p+(parseInt(r?.adultCount)||0)+(parseInt(r?.childCount)||0),0);e[l.id]={used:d,total:parseInt(l.visaQuota)||0}}}),e},[O,T]),[n,b]=I.useState(()=>({...st,currencyCode:D?.baseCurrency||"EGP"})),[a,R]=I.useState(Ft);I.useEffect(()=>{if(oe&&!a.employeeId&&!Z&&B?.employeeId)R(e=>({...e,employeeId:B.employeeId||""}));else if(oe&&!a.employeeId&&!Z){const e=(H||[]).find(l=>l&&Rt(l.name||"",B?.name||""));e&&R(l=>({...l,employeeId:e.id}))}},[oe,B,H,a.employeeId,Z]),I.useEffect(()=>{if(oe&&!n.employeeId&&!F&&B?.employeeId)b(e=>({...e,employeeId:B.employeeId||""}));else if(oe&&!n.employeeId&&!F){const e=(H||[]).find(l=>l&&Rt(l.name||"",B?.name||""));e&&b(l=>({...l,employeeId:e.id}))}},[oe,B,H,n.employeeId,F]),I.useEffect(()=>{if(oe&&!c.employeeId&&!Pe&&B?.employeeId)y(e=>({...e,employeeId:B.employeeId||""}));else if(oe&&!c.employeeId&&!Pe){const e=(H||[]).find(l=>l&&Rt(l.name||"",B?.name||""));e&&y(l=>({...l,employeeId:e.id}))}},[oe,B,H,c.employeeId,Pe]),I.useEffect(()=>{if(a.programId){const e=(A||[]).find(l=>l.id===a.programId);if(e){const l=parseInt(a.adultCount||"0"),d=parseInt(a.childCount||"0"),p=parseInt(a.infantCount||"0"),r=a.bookingType==="AGENT"?a.roomType==="SINGLE"?e.singleAgentPrice||e.adultAgentPrice||0:a.roomType==="DOUBLE"?e.doubleAgentPrice||e.adultAgentPrice||0:a.roomType==="TRIPLE"?e.tripleAgentPrice||e.adultAgentPrice||0:a.roomType==="QUAD"?e.quadAgentPrice||e.adultAgentPrice||0:e.adultAgentPrice||0:a.roomType==="SINGLE"?e.singleSellingPrice||e.adultSellingPrice||e.sellingPrice||0:a.roomType==="DOUBLE"?e.doubleSellingPrice||e.adultSellingPrice||e.sellingPrice||0:a.roomType==="TRIPLE"?e.tripleSellingPrice||e.adultSellingPrice||e.sellingPrice||0:a.roomType==="QUAD"?e.quadSellingPrice||e.adultSellingPrice||e.sellingPrice||0:e.adultSellingPrice||e.sellingPrice||0,g=a.bookingType==="AGENT"?e.childAgentPrice||0:a.roomType==="SINGLE"?e.singleChildSellingPrice||e.childSellingPrice||0:a.roomType==="DOUBLE"?e.doubleChildSellingPrice||e.childSellingPrice||0:a.roomType==="TRIPLE"?e.tripleChildSellingPrice||e.childSellingPrice||0:a.roomType==="QUAD"?e.quadChildSellingPrice||e.childSellingPrice||0:e.childSellingPrice||0,f=a.bookingType==="AGENT"?e.infantAgentPrice||0:a.roomType==="SINGLE"?e.singleInfantSellingPrice||e.infantSellingPrice||0:a.roomType==="DOUBLE"?e.doubleInfantSellingPrice||e.infantSellingPrice||0:a.roomType==="TRIPLE"?e.tripleInfantSellingPrice||e.infantSellingPrice||0:a.roomType==="QUAD"?e.quadInfantSellingPrice||e.infantSellingPrice||0:e.infantSellingPrice||0,j=l*r+d*g+p*f;R(M=>({...M,customSellingPrice:j.toString()}))}}},[a.programId,a.adultCount,a.childCount,a.infantCount,a.roomType,a.bookingType,A]),I.useEffect(()=>{if(a.employeeId&&!Z&&!a.employeeCommissionRate){const e=(H||[]).find(l=>l.id===a.employeeId);e&&R(l=>({...l,employeeCommissionRate:e.commissionRate.toString()}))}},[a.employeeId,H,Z]);const fl=e=>{if(e.preventDefault(),Ze){const l=(Ce||[]).find(p=>p.id===Ze),d={...l,...re};Je("UPDATE","SETTINGS",Ze,`تعديل الرحلة المجمعة: ${re.name}`,l,d),Mt(p=>(p||[]).map(r=>r.id===Ze?d:r))}else{const l={id:Date.now().toString(),...re,accommodation:{mecca:{hotelName:"",rooms:[]},medina:{hotelName:"",rooms:[]}}};Je("CREATE","SETTINGS",l.id,`إضافة رحلة مجمعة جديدة: ${l.name}`,void 0,l),Mt(d=>[...d||[],l])}Me(!1),jt(null),we({name:"",date:new Date().toISOString().split("T")[0],type:"UMRAH",details:"",components:[]})},Sl=e=>{jt(e.id),we({name:e.name,date:e.date,type:e.type,details:e.details||"",components:e.components||[]}),Me(!0)},Il=e=>{e.preventDefault();let l=parseFloat(n.purchasePrice||"0"),d=parseFloat(n.sellingPrice||"0"),p=parseFloat(n.adultPurchasePrice||n.purchasePrice||"0"),r=parseFloat(n.childPurchasePrice||"0"),g=parseFloat(n.infantPurchasePrice||"0"),f=parseFloat(n.singlePurchasePrice||"0"),j=parseFloat(n.singleChildPurchasePrice||"0"),M=parseFloat(n.singleInfantPurchasePrice||"0"),m=parseFloat(n.doublePurchasePrice||"0"),E=parseFloat(n.doubleChildPurchasePrice||"0"),v=parseFloat(n.doubleInfantPurchasePrice||"0"),U=parseFloat(n.triplePurchasePrice||"0"),o=parseFloat(n.tripleChildPurchasePrice||"0"),X=parseFloat(n.tripleInfantPurchasePrice||"0"),ee=parseFloat(n.quadPurchasePrice||"0"),_=parseFloat(n.quadChildPurchasePrice||"0"),te=parseFloat(n.quadInfantPurchasePrice||"0"),le=parseFloat(n.adultSellingPrice||n.sellingPrice||"0"),ue=parseFloat(n.childSellingPrice||"0"),me=parseFloat(n.infantSellingPrice||"0"),be=parseFloat(n.singleSellingPrice||"0"),ye=parseFloat(n.singleChildSellingPrice||"0"),Ie=parseFloat(n.singleInfantSellingPrice||"0"),pe=parseFloat(n.doubleSellingPrice||"0"),He=parseFloat(n.doubleChildSellingPrice||"0"),he=parseFloat(n.doubleInfantSellingPrice||"0"),z=parseFloat(n.tripleSellingPrice||"0"),q=parseFloat(n.tripleChildSellingPrice||"0"),Ae=parseFloat(n.tripleInfantSellingPrice||"0"),Ne=parseFloat(n.quadSellingPrice||"0"),Re=parseFloat(n.quadChildSellingPrice||"0"),Le=parseFloat(n.quadInfantSellingPrice||"0");const Be=l>0||d>0||p>0||le>0||f>0||m>0||U>0||ee>0,S=n.components||[];S.length>0&&!Be&&(l=S.reduce((h,u)=>h+(u?.purchasePrice||0),0),d=S.reduce((h,u)=>h+(u?.sellingPrice||0),0),p=S.reduce((h,u)=>u?.pricingMode==="TOTAL"?h+(u.purchasePrice||0):h+(u?.adultPurchasePrice||u?.purchasePrice||0),0),r=S.reduce((h,u)=>u?.pricingMode==="TOTAL"?h:h+(u?.childPurchasePrice||u?.purchasePrice||0),0),g=S.reduce((h,u)=>u?.pricingMode==="TOTAL"?h:h+(u?.infantPurchasePrice||u?.purchasePrice||0),0),f=S.reduce((h,u)=>u?.pricingMode==="TOTAL"?h:h+(u?.singlePurchasePrice||u?.purchasePrice||0),0),j=S.reduce((h,u)=>u?.pricingMode==="TOTAL"?h:h+(u?.singleChildPurchasePrice||u?.purchasePrice||0),0),M=S.reduce((h,u)=>u?.pricingMode==="TOTAL"?h:h+(u?.singleInfantPurchasePrice||u?.purchasePrice||0),0),m=S.reduce((h,u)=>u?.pricingMode==="TOTAL"?h:h+(u?.doublePurchasePrice||u?.purchasePrice||0),0),E=S.reduce((h,u)=>u?.pricingMode==="TOTAL"?h:h+(u?.doubleChildPurchasePrice||u?.purchasePrice||0),0),v=S.reduce((h,u)=>u?.pricingMode==="TOTAL"?h:h+(u?.doubleInfantPurchasePrice||u?.purchasePrice||0),0),U=S.reduce((h,u)=>u?.pricingMode==="TOTAL"?h:h+(u?.triplePurchasePrice||u?.purchasePrice||0),0),o=S.reduce((h,u)=>u?.pricingMode==="TOTAL"?h:h+(u?.tripleChildPurchasePrice||u?.purchasePrice||0),0),X=S.reduce((h,u)=>u?.pricingMode==="TOTAL"?h:h+(u?.tripleInfantPurchasePrice||u?.purchasePrice||0),0),ee=S.reduce((h,u)=>u?.pricingMode==="TOTAL"?h:h+(u?.quadPurchasePrice||u?.purchasePrice||0),0),_=S.reduce((h,u)=>u?.pricingMode==="TOTAL"?h:h+(u?.quadChildPurchasePrice||u?.purchasePrice||0),0),te=S.reduce((h,u)=>u?.pricingMode==="TOTAL"?h:h+(u?.quadInfantPurchasePrice||u?.purchasePrice||0),0),le=S.reduce((h,u)=>u?.pricingMode==="TOTAL"?h+(u.sellingPrice||0):h+(u?.adultSellingPrice||u?.sellingPrice||0),0),ue=S.reduce((h,u)=>u?.pricingMode==="TOTAL"?h:h+(u?.childSellingPrice||u?.sellingPrice||0),0),me=S.reduce((h,u)=>u?.pricingMode==="TOTAL"?h:h+(u?.infantSellingPrice||u?.sellingPrice||0),0),be=S.reduce((h,u)=>u?.pricingMode==="TOTAL"?h:h+(u?.singleSellingPrice||u?.sellingPrice||0),0),ye=S.reduce((h,u)=>u?.pricingMode==="TOTAL"?h:h+(u?.singleChildSellingPrice||u?.sellingPrice||0),0),Ie=S.reduce((h,u)=>u?.pricingMode==="TOTAL"?h:h+(u?.singleInfantSellingPrice||u?.sellingPrice||0),0),pe=S.reduce((h,u)=>u?.pricingMode==="TOTAL"?h:h+(u?.doubleSellingPrice||u?.sellingPrice||0),0),He=S.reduce((h,u)=>u?.pricingMode==="TOTAL"?h:h+(u?.doubleChildSellingPrice||u?.sellingPrice||0),0),he=S.reduce((h,u)=>u?.pricingMode==="TOTAL"?h:h+(u?.doubleInfantSellingPrice||u?.sellingPrice||0),0),z=S.reduce((h,u)=>u?.pricingMode==="TOTAL"?h:h+(u?.tripleSellingPrice||u?.sellingPrice||0),0),q=S.reduce((h,u)=>u?.pricingMode==="TOTAL"?h:h+(u?.tripleChildSellingPrice||u?.sellingPrice||0),0),Ae=S.reduce((h,u)=>u?.pricingMode==="TOTAL"?h:h+(u?.tripleInfantSellingPrice||u?.sellingPrice||0),0),Ne=S.reduce((h,u)=>u?.pricingMode==="TOTAL"?h:h+(u?.quadSellingPrice||u?.sellingPrice||0),0),Re=S.reduce((h,u)=>u?.pricingMode==="TOTAL"?h:h+(u?.quadChildSellingPrice||u?.sellingPrice||0),0),Le=S.reduce((h,u)=>u?.pricingMode==="TOTAL"?h:h+(u?.quadInfantSellingPrice||u?.sellingPrice||0),0));const i={id:F||Date.now().toString(),name:n.name,masterTripId:n.masterTripId||void 0,customerId:n.customerId||void 0,supplierId:n.supplierId,supplierType:n.supplierType,purchasePrice:l,sellingPrice:d,adultPurchasePrice:p,childPurchasePrice:r,infantPurchasePrice:g,singlePurchasePrice:f,singleChildPurchasePrice:j,singleInfantPurchasePrice:M,doublePurchasePrice:m,doubleChildPurchasePrice:E,doubleInfantPurchasePrice:v,triplePurchasePrice:U,tripleChildPurchasePrice:o,tripleInfantPurchasePrice:X,quadPurchasePrice:ee,quadChildPurchasePrice:_,quadInfantPurchasePrice:te,adultSellingPrice:le,childSellingPrice:ue,infantSellingPrice:me,singleSellingPrice:be,singleChildSellingPrice:ye,singleInfantSellingPrice:Ie,doubleSellingPrice:pe,doubleChildSellingPrice:He,doubleInfantSellingPrice:he,tripleSellingPrice:z,tripleChildSellingPrice:q,tripleInfantSellingPrice:Ae,quadSellingPrice:Ne,quadChildSellingPrice:Re,quadInfantSellingPrice:Le,adultAgentPrice:parseFloat(n.adultAgentPrice||"0"),childAgentPrice:parseFloat(n.childAgentPrice||"0"),infantAgentPrice:parseFloat(n.infantAgentPrice||"0"),singleAgentPrice:parseFloat(n.singleAgentPrice||"0"),doubleAgentPrice:parseFloat(n.doubleAgentPrice||"0"),tripleAgentPrice:parseFloat(n.tripleAgentPrice||"0"),quadAgentPrice:parseFloat(n.quadAgentPrice||"0"),type:n.type,date:n.date,currencyCode:n.currencyCode,exchangeRate:parseFloat(n.exchangeRate||"1"),components:n.components,adultCount:parseInt(n.adultCount||"0"),childCount:parseInt(n.childCount||"0"),infantCount:parseInt(n.infantCount||"0"),singleAdultCount:parseInt(n.singleAdultCount||"0"),singleChildCount:parseInt(n.singleChildCount||"0"),singleInfantCount:parseInt(n.singleInfantCount||"0"),doubleAdultCount:parseInt(n.doubleAdultCount||"0"),doubleChildCount:parseInt(n.doubleChildCount||"0"),doubleInfantCount:parseInt(n.doubleInfantCount||"0"),tripleAdultCount:parseInt(n.tripleAdultCount||"0"),tripleChildCount:parseInt(n.tripleChildCount||"0"),tripleInfantCount:parseInt(n.tripleInfantCount||"0"),quadAdultCount:parseInt(n.quadAdultCount||"0"),quadChildCount:parseInt(n.quadChildCount||"0"),quadInfantCount:parseInt(n.quadInfantCount||"0"),roomType:n.roomType,isAgent:n.isAgent,employeeId:n.employeeId,employeeCommissionRate:parseFloat(n.employeeCommissionRate||"0"),commissionAmount:parseFloat(n.commissionAmount||"0"),applyCommission:n.applyCommission};if(F&&(i.type==="INDIVIDUAL_UMRAH"||i.type==="GENERAL"||i.components&&i.components.length>0)){const h=(A||[]).find(u=>u.id===F);if(h&&h.components){const u=(i.components||[]).map(s=>s.id)||[];(h.components||[]).filter(s=>s&&!u.includes(s.id)).forEach(s=>{(T||[]).filter(L=>L&&L.programId===F&&!L.isVoided&&(L.componentId===s.id||L.description===`${h.name} - ${s.name}`)).forEach(L=>Ot(L.id))})}}if(F){const h=(A||[]).find(s=>s.id===F),u={...h,...i};Je("UPDATE","SETTINGS",F,`تعديل البرنامج: ${i.name}`,h,u),rt(s=>(s||[]).map(P=>P.id===F?u:P)),(T||[]).filter(s=>s&&s.programId===F&&!s.isVoided).forEach(s=>{let P={...s},L=!1;if(s.masterTripId!==i.masterTripId&&(P.masterTripId=i.masterTripId,L=!0),h&&h.name!==i.name&&(P.description=s.description.replace(h.name,i.name),L=!0),i.type==="INDIVIDUAL_UMRAH"||i.type==="GENERAL"||i.components&&i.components.length>0){const x=s.componentId?i.components?.find(J=>J.id===s.componentId):(()=>{const Y=s.description.split(" - ")[1]?.split(" (")[0];return i.components?.find(ie=>ie.name===Y)})();if(x){const J=s.adultCount||0,Y=s.childCount||0,ie=s.infantCount||0;let ae=0,ne=0;if(x.pricingMode==="TOTAL")ae=x.type==="EXPENSE"?0:x.sellingPrice||0,ne=x.purchasePrice||0;else{const Ge=s.roomType==="SINGLE"?x.singleSellingPrice||x.adultSellingPrice||x.sellingPrice||0:s.roomType==="DOUBLE"?x.doubleSellingPrice||x.adultSellingPrice||x.sellingPrice||0:s.roomType==="TRIPLE"?x.tripleSellingPrice||x.adultSellingPrice||x.sellingPrice||0:s.roomType==="QUAD"?x.quadSellingPrice||x.adultSellingPrice||x.sellingPrice||0:x.adultSellingPrice||x.sellingPrice||0,Ve=s.roomType==="SINGLE"?x.singleChildSellingPrice||x.childSellingPrice||0:s.roomType==="DOUBLE"?x.doubleChildSellingPrice||x.childSellingPrice||0:s.roomType==="TRIPLE"?x.tripleChildSellingPrice||x.childSellingPrice||0:s.roomType==="QUAD"?x.quadChildSellingPrice||x.childSellingPrice||0:x.childSellingPrice||0,vt=s.roomType==="SINGLE"?x.singleInfantSellingPrice||x.infantSellingPrice||0:s.roomType==="DOUBLE"?x.doubleInfantSellingPrice||x.infantSellingPrice||0:s.roomType==="TRIPLE"?x.tripleInfantSellingPrice||x.infantSellingPrice||0:s.roomType==="QUAD"?x.quadInfantSellingPrice||x.infantSellingPrice||0:x.infantSellingPrice||0;ae=x.type==="EXPENSE"?0:J*Ge+Y*Ve+ie*vt;const Tt=s.roomType==="SINGLE"?x.singlePurchasePrice||x.adultPurchasePrice||x.purchasePrice||0:s.roomType==="DOUBLE"?x.doublePurchasePrice||x.adultPurchasePrice||x.purchasePrice||0:s.roomType==="TRIPLE"?x.triplePurchasePrice||x.adultPurchasePrice||x.purchasePrice||0:s.roomType==="QUAD"?x.quadPurchasePrice||x.adultPurchasePrice||x.purchasePrice||0:x.adultPurchasePrice||x.purchasePrice||0,wt=s.roomType==="SINGLE"?x.singleChildPurchasePrice||x.childPurchasePrice||0:s.roomType==="DOUBLE"?x.doubleChildPurchasePrice||x.childPurchasePrice||0:s.roomType==="TRIPLE"?x.tripleChildPurchasePrice||x.childPurchasePrice||0:s.roomType==="QUAD"?x.quadChildPurchasePrice||x.childPurchasePrice||0:x.childPurchasePrice||0,At=s.roomType==="SINGLE"?x.singleInfantPurchasePrice||x.infantPurchasePrice||0:s.roomType==="DOUBLE"?x.doubleInfantPurchasePrice||x.infantPurchasePrice||0:s.roomType==="TRIPLE"?x.tripleInfantPurchasePrice||x.infantPurchasePrice||0:s.roomType==="QUAD"?x.quadInfantPurchasePrice||x.infantPurchasePrice||0:x.infantPurchasePrice||0;ne=J*Tt+Y*wt+ie*At}const de=i.exchangeRate||1,De=ae*(1/(de||1)),Fe=ne*(1/(de||1));(s.sellingPrice!==De||s.purchasePrice!==Fe)&&(P.sellingPrice=De,P.purchasePrice=Fe,s.isPurchaseOnly||s.type==="PURCHASE_ONLY"?P.amount=Fe:P.amount=De-(s.discount||0),L=!0)}}else if(s.category==="HAJJ_UMRAH"){const x=s.adultCount||0,J=s.childCount||0,Y=s.infantCount||0,ie=s.roomType==="SINGLE"?parseFloat(i.singleSellingPrice?.toString()||i.adultSellingPrice?.toString()||i.sellingPrice?.toString()||"0"):s.roomType==="DOUBLE"?parseFloat(i.doubleSellingPrice?.toString()||i.adultSellingPrice?.toString()||i.sellingPrice?.toString()||"0"):s.roomType==="TRIPLE"?parseFloat(i.tripleSellingPrice?.toString()||i.adultSellingPrice?.toString()||i.sellingPrice?.toString()||"0"):s.roomType==="QUAD"?parseFloat(i.quadSellingPrice?.toString()||i.adultSellingPrice?.toString()||i.sellingPrice?.toString()||"0"):parseFloat(i.adultSellingPrice?.toString()||i.sellingPrice?.toString()||"0"),ae=s.roomType==="SINGLE"?parseFloat(i.singleChildSellingPrice?.toString()||i.childSellingPrice?.toString()||"0"):s.roomType==="DOUBLE"?parseFloat(i.doubleChildSellingPrice?.toString()||i.childSellingPrice?.toString()||"0"):s.roomType==="TRIPLE"?parseFloat(i.tripleChildSellingPrice?.toString()||i.childSellingPrice?.toString()||"0"):s.roomType==="QUAD"?parseFloat(i.quadChildSellingPrice?.toString()||i.childSellingPrice?.toString()||"0"):parseFloat(i.childSellingPrice?.toString()||"0"),ne=s.roomType==="SINGLE"?parseFloat(i.singleInfantSellingPrice?.toString()||i.infantSellingPrice?.toString()||"0"):s.roomType==="DOUBLE"?parseFloat(i.doubleInfantSellingPrice?.toString()||i.infantSellingPrice?.toString()||"0"):s.roomType==="TRIPLE"?parseFloat(i.tripleInfantSellingPrice?.toString()||i.infantSellingPrice?.toString()||"0"):s.roomType==="QUAD"?parseFloat(i.quadInfantSellingPrice?.toString()||i.infantSellingPrice?.toString()||"0"):parseFloat(i.infantSellingPrice?.toString()||"0"),de=s.roomType==="SINGLE"?parseFloat(i.singlePurchasePrice?.toString()||i.adultPurchasePrice?.toString()||i.purchasePrice?.toString()||"0"):s.roomType==="DOUBLE"?parseFloat(i.doublePurchasePrice?.toString()||i.adultPurchasePrice?.toString()||i.purchasePrice?.toString()||"0"):s.roomType==="TRIPLE"?parseFloat(i.triplePurchasePrice?.toString()||i.adultPurchasePrice?.toString()||i.purchasePrice?.toString()||"0"):s.roomType==="QUAD"?parseFloat(i.quadPurchasePrice?.toString()||i.adultPurchasePrice?.toString()||i.purchasePrice?.toString()||"0"):parseFloat(i.adultPurchasePrice?.toString()||i.purchasePrice?.toString()||"0"),De=s.roomType==="SINGLE"?parseFloat(i.singleChildPurchasePrice?.toString()||i.childPurchasePrice?.toString()||"0"):s.roomType==="DOUBLE"?parseFloat(i.doubleChildPurchasePrice?.toString()||i.childPurchasePrice?.toString()||"0"):s.roomType==="TRIPLE"?parseFloat(i.tripleChildPurchasePrice?.toString()||i.childPurchasePrice?.toString()||"0"):s.roomType==="QUAD"?parseFloat(i.quadChildPurchasePrice?.toString()||i.childPurchasePrice?.toString()||"0"):parseFloat(i.childPurchasePrice?.toString()||"0"),Fe=s.roomType==="SINGLE"?parseFloat(i.singleInfantPurchasePrice?.toString()||i.infantPurchasePrice?.toString()||"0"):s.roomType==="DOUBLE"?parseFloat(i.doubleInfantPurchasePrice?.toString()||i.infantPurchasePrice?.toString()||"0"):s.roomType==="TRIPLE"?parseFloat(i.tripleInfantPurchasePrice?.toString()||i.infantPurchasePrice?.toString()||"0"):s.roomType==="QUAD"?parseFloat(i.quadInfantPurchasePrice?.toString()||i.infantPurchasePrice?.toString()||"0"):parseFloat(i.infantPurchasePrice?.toString()||"0"),Ge=x*ie+J*ae+Y*ne,Ve=x*de+J*De+Y*Fe;(s.sellingPrice!==Ge||s.purchasePrice!==Ve)&&(P.sellingPrice=Ge,P.purchasePrice=Ve,P.amount=Ge-(s.discount||0),L=!0)}L&&je(s.id,P)})}else if(Je("CREATE","SETTINGS",i.id,`إضافة برنامج جديد: ${i.name}`,void 0,i),rt(h=>[...h||[],i]),i.customerId){const h=(Q||[]).find(s=>s.id===i.customerId),u=[{type:"SINGLE",adult:i.singleAdultCount||0,child:i.singleChildCount||0,infant:i.singleInfantCount||0},{type:"DOUBLE",adult:i.doubleAdultCount||0,child:i.doubleChildCount||0,infant:i.doubleInfantCount||0},{type:"TRIPLE",adult:i.tripleAdultCount||0,child:i.tripleChildCount||0,infant:i.tripleInfantCount||0},{type:"QUAD",adult:i.quadAdultCount||0,child:i.quadChildCount||0,infant:i.quadInfantCount||0},{type:i.roomType||"DEFAULT",adult:i.adultCount||0,child:i.childCount||0,infant:i.infantCount||0}].filter(s=>s&&(s.adult>0||s.child>0||s.infant>0));let Ue=0;u.length===0?Ue=i.sellingPrice:u.forEach(s=>{const P=s.type==="SINGLE"?i.singleSellingPrice||i.adultSellingPrice||i.sellingPrice||0:s.type==="DOUBLE"?i.doubleSellingPrice||i.adultSellingPrice||i.sellingPrice||0:s.type==="TRIPLE"?i.tripleSellingPrice||i.adultSellingPrice||i.sellingPrice||0:s.type==="QUAD"?i.quadSellingPrice||i.adultSellingPrice||i.sellingPrice||0:i.adultSellingPrice||i.sellingPrice||0,L=s.type==="SINGLE"?i.singleChildSellingPrice||i.childSellingPrice||0:s.type==="DOUBLE"?i.doubleChildSellingPrice||i.childSellingPrice||0:s.type==="TRIPLE"?i.tripleChildSellingPrice||i.childSellingPrice||0:s.type==="QUAD"?i.quadChildSellingPrice||i.childSellingPrice||0:i.childSellingPrice||0,x=s.type==="SINGLE"?i.singleInfantSellingPrice||i.infantSellingPrice||0:s.type==="DOUBLE"?i.doubleInfantSellingPrice||i.infantSellingPrice||0:s.type==="TRIPLE"?i.tripleInfantSellingPrice||i.infantSellingPrice||0:s.type==="QUAD"?i.quadInfantSellingPrice||i.infantSellingPrice||0:i.infantSellingPrice||0;Ue+=s.adult*P+s.child*L+s.infant*x}),Oe(`هل تريد إثبات فاتورة مبيعات ومديونية للعميل (${h?.name}) وللمورد بقيمة ${Ue} ${i.currencyCode} الآن؟`,()=>{if(i.components&&i.components.length>0)i.components=i.components.map(s=>({...s,isPosted:!0})),i.components.forEach(s=>{if(s.type!=="EXPENSE")if(u.length===0){const P=s.sellingPrice||0,L=s.purchasePrice||0;G({description:`${i.name} - ${s.name}`,amount:P,currencyCode:i.currencyCode,exchangeRate:i.exchangeRate,type:"REVENUE_ONLY",category:s.type==="FLIGHT"?"FLIGHT":"GENERAL_SERVICE",date:i.date,relatedEntityId:i.customerId,relatedEntityType:"CUSTOMER",sellingPrice:P,purchasePrice:0,programId:i.id,componentId:s.id,masterTripId:i.masterTripId,isSaleOnly:!0,employeeId:s.employeeId||i.employeeId,employeeCommissionRate:i.employeeCommissionRate,commissionAmount:s.commissionAmount,applyCommission:s.isCommissionable!==void 0?s.isCommissionable:i.applyCommission}),(s.supplierId||i.supplierId)&&G({description:`شراء خدمة: ${s.name} - برنامج: ${i.name}`,amount:L,currencyCode:i.currencyCode,exchangeRate:i.exchangeRate,type:"PURCHASE_ONLY",category:s.type==="FLIGHT"?"FLIGHT":"GENERAL_SERVICE",date:i.date,relatedEntityId:s.supplierId||i.supplierId,relatedEntityType:s.supplierType||i.supplierType||"SUPPLIER",sellingPrice:0,purchasePrice:L,programId:i.id,componentId:s.id,masterTripId:i.masterTripId,isPurchaseOnly:!0,employeeId:s.employeeId||i.employeeId,employeeCommissionRate:i.employeeCommissionRate,commissionAmount:s.commissionAmount,applyCommission:s.isCommissionable!==void 0?s.isCommissionable:i.applyCommission})}else u.forEach(P=>{const L=P.type==="SINGLE"?s.singleSellingPrice||s.adultSellingPrice||s.sellingPrice||0:P.type==="DOUBLE"?s.doubleSellingPrice||s.adultSellingPrice||s.sellingPrice||0:P.type==="TRIPLE"?s.tripleSellingPrice||s.adultSellingPrice||s.sellingPrice||0:P.type==="QUAD"?s.quadSellingPrice||s.adultSellingPrice||s.sellingPrice||0:s.adultSellingPrice||s.sellingPrice||0,x=P.type==="SINGLE"?s.singleChildSellingPrice||s.childSellingPrice||0:P.type==="DOUBLE"?s.doubleChildSellingPrice||s.childSellingPrice||0:P.type==="TRIPLE"?s.tripleChildSellingPrice||s.childSellingPrice||0:P.type==="QUAD"?s.quadChildSellingPrice||s.childSellingPrice||0:s.childSellingPrice||0,J=P.type==="SINGLE"?s.singleInfantSellingPrice||s.infantSellingPrice||0:P.type==="DOUBLE"?s.doubleInfantSellingPrice||s.infantSellingPrice||0:P.type==="TRIPLE"?s.tripleInfantSellingPrice||s.infantSellingPrice||0:P.type==="QUAD"?s.quadInfantSellingPrice||s.infantSellingPrice||0:s.infantSellingPrice||0,Y=P.adult*L+P.child*x+P.infant*J,ie=P.type==="SINGLE"?s.singlePurchasePrice||s.adultPurchasePrice||s.purchasePrice||0:P.type==="DOUBLE"?s.doublePurchasePrice||s.adultPurchasePrice||s.purchasePrice||0:P.type==="TRIPLE"?s.triplePurchasePrice||s.adultPurchasePrice||s.purchasePrice||0:P.type==="QUAD"?s.quadPurchasePrice||s.adultPurchasePrice||s.purchasePrice||0:s.adultPurchasePrice||s.purchasePrice||0,ae=P.type==="SINGLE"?s.singleChildPurchasePrice||s.childPurchasePrice||0:P.type==="DOUBLE"?s.doubleChildPurchasePrice||s.childPurchasePrice||0:P.type==="TRIPLE"?s.tripleChildPurchasePrice||s.childPurchasePrice||0:P.type==="QUAD"?s.quadChildPurchasePrice||s.childPurchasePrice||0:s.childPurchasePrice||0,ne=P.type==="SINGLE"?s.singleInfantPurchasePrice||s.infantPurchasePrice||0:P.type==="DOUBLE"?s.doubleInfantPurchasePrice||s.infantPurchasePrice||0:P.type==="TRIPLE"?s.tripleInfantPurchasePrice||s.infantPurchasePrice||0:P.type==="QUAD"?s.quadInfantPurchasePrice||s.infantPurchasePrice||0:s.infantPurchasePrice||0,de=P.adult*ie+P.child*ae+P.infant*ne;G({description:`${i.name} - ${s.name} (${P.adult} بالغ، ${P.child} طفل، ${P.infant} رضيع) - ${P.type}`,amount:Y,currencyCode:i.currencyCode,exchangeRate:i.exchangeRate,type:"REVENUE_ONLY",category:s.type==="FLIGHT"?"FLIGHT":"GENERAL_SERVICE",date:i.date,relatedEntityId:i.customerId,relatedEntityType:"CUSTOMER",sellingPrice:Y,purchasePrice:0,programId:i.id,componentId:s.id,masterTripId:i.masterTripId,isSaleOnly:!0,adultCount:P.adult,childCount:P.child,infantCount:P.infant,roomType:P.type,employeeId:s.employeeId||i.employeeId,employeeCommissionRate:i.employeeCommissionRate,commissionAmount:s.commissionAmount,applyCommission:s.isCommissionable!==void 0?s.isCommissionable:i.applyCommission}),(s.supplierId||i.supplierId)&&G({description:`شراء خدمة: ${s.name} - برنامج: ${i.name} (${P.type})`,amount:de,currencyCode:i.currencyCode,exchangeRate:i.exchangeRate,type:"PURCHASE_ONLY",category:s.type==="FLIGHT"?"FLIGHT":"GENERAL_SERVICE",date:i.date,relatedEntityId:s.supplierId||i.supplierId,relatedEntityType:s.supplierType||i.supplierType||"SUPPLIER",sellingPrice:0,purchasePrice:de,programId:i.id,componentId:s.id,masterTripId:i.masterTripId,isPurchaseOnly:!0,adultCount:P.adult,childCount:P.child,infantCount:P.infant,roomType:P.type,employeeId:s.employeeId||i.employeeId,employeeCommissionRate:i.employeeCommissionRate,commissionAmount:s.commissionAmount,applyCommission:s.isCommissionable!==void 0?s.isCommissionable:i.applyCommission})})});else if(u.length===0){const s=i.sellingPrice,P=i.purchasePrice;G({description:`مبيعات برنامج: ${i.name} - عميل: ${h?.name}`,amount:s,currencyCode:i.currencyCode,exchangeRate:i.exchangeRate,type:"REVENUE_ONLY",category:i.type==="UMRAH"||i.type==="INDIVIDUAL_UMRAH"?"HAJJ_UMRAH":"GENERAL_SERVICE",date:i.date,relatedEntityId:i.customerId,relatedEntityType:"CUSTOMER",sellingPrice:s,purchasePrice:0,programId:i.id,masterTripId:i.masterTripId,isSaleOnly:!0,employeeId:i.employeeId,employeeCommissionRate:i.employeeCommissionRate,commissionAmount:i.commissionAmount,applyCommission:i.applyCommission}),i.supplierId&&G({description:`شراء برنامج: ${i.name} - مورد: ${(O||[]).find(L=>L?.id===i.supplierId)?.company||"---"}`,amount:P,currencyCode:i.currencyCode,exchangeRate:i.exchangeRate,type:"PURCHASE_ONLY",category:i.type==="UMRAH"||i.type==="INDIVIDUAL_UMRAH"?"HAJJ_UMRAH":"GENERAL_SERVICE",date:i.date,relatedEntityId:i.supplierId,relatedEntityType:i.supplierType||"SUPPLIER",sellingPrice:0,purchasePrice:P,programId:i.id,masterTripId:i.masterTripId,isPurchaseOnly:!0,employeeId:i.employeeId,employeeCommissionRate:i.employeeCommissionRate,commissionAmount:i.commissionAmount,applyCommission:i.applyCommission})}else u.forEach(s=>{const P=s.type==="SINGLE"?i.singleSellingPrice||i.adultSellingPrice||i.sellingPrice||0:s.type==="DOUBLE"?i.doubleSellingPrice||i.adultSellingPrice||i.sellingPrice||0:s.type==="TRIPLE"?i.tripleSellingPrice||i.adultSellingPrice||i.sellingPrice||0:s.type==="QUAD"?i.quadSellingPrice||i.adultSellingPrice||i.sellingPrice||0:i.adultSellingPrice||i.sellingPrice||0,L=s.type==="SINGLE"?i.singleChildSellingPrice||i.childSellingPrice||0:s.type==="DOUBLE"?i.doubleChildSellingPrice||i.childSellingPrice||0:s.type==="TRIPLE"?i.tripleChildSellingPrice||i.childSellingPrice||0:s.type==="QUAD"?i.quadChildSellingPrice||i.childSellingPrice||0:i.childSellingPrice||0,x=s.type==="SINGLE"?i.singleInfantSellingPrice||i.infantSellingPrice||0:s.type==="DOUBLE"?i.doubleInfantSellingPrice||i.infantSellingPrice||0:s.type==="TRIPLE"?i.tripleInfantSellingPrice||i.infantSellingPrice||0:s.type==="QUAD"?i.quadInfantSellingPrice||i.infantSellingPrice||0:i.infantSellingPrice||0,J=s.adult*P+s.child*L+s.infant*x,Y=s.type==="SINGLE"?i.singlePurchasePrice||i.adultPurchasePrice||i.purchasePrice||0:s.type==="DOUBLE"?i.doublePurchasePrice||i.adultPurchasePrice||i.purchasePrice||0:s.type==="TRIPLE"?i.triplePurchasePrice||i.adultPurchasePrice||i.purchasePrice||0:s.type==="QUAD"?i.quadPurchasePrice||i.adultPurchasePrice||i.purchasePrice||0:i.adultPurchasePrice||i.purchasePrice||0,ie=s.type==="SINGLE"?i.singleChildPurchasePrice||i.childPurchasePrice||0:s.type==="DOUBLE"?i.doubleChildPurchasePrice||i.childPurchasePrice||0:s.type==="TRIPLE"?i.tripleChildPurchasePrice||i.childPurchasePrice||0:s.type==="QUAD"?i.quadChildPurchasePrice||i.childPurchasePrice||0:i.childPurchasePrice||0,ae=s.type==="SINGLE"?i.singleInfantPurchasePrice||i.infantPurchasePrice||0:s.type==="DOUBLE"?i.doubleInfantPurchasePrice||i.infantPurchasePrice||0:s.type==="TRIPLE"?i.tripleInfantPurchasePrice||i.infantPurchasePrice||0:s.type==="QUAD"?i.quadInfantPurchasePrice||i.infantPurchasePrice||0:i.infantPurchasePrice||0,ne=s.adult*Y+s.child*ie+s.infant*ae;G({description:`مبيعات برنامج: ${i.name} - عميل: ${h?.name} (${s.adult} بالغ، ${s.child} طفل، ${s.infant} رضيع) - ${s.type}`,amount:J,currencyCode:i.currencyCode,exchangeRate:i.exchangeRate,type:"REVENUE_ONLY",category:i.type==="UMRAH"||i.type==="INDIVIDUAL_UMRAH"?"HAJJ_UMRAH":"GENERAL_SERVICE",date:i.date,relatedEntityId:i.customerId,relatedEntityType:"CUSTOMER",sellingPrice:J,purchasePrice:0,programId:i.id,masterTripId:i.masterTripId,isSaleOnly:!0,adultCount:s.adult,childCount:s.child,infantCount:s.infant,roomType:s.type,employeeId:i.employeeId,employeeCommissionRate:i.employeeCommissionRate,applyCommission:i.applyCommission}),i.supplierId&&G({description:`شراء برنامج: ${i.name} - مورد: ${(O||[]).find(de=>de?.id===i.supplierId)?.company||"---"} (${s.type})`,amount:ne,currencyCode:i.currencyCode,exchangeRate:i.exchangeRate,type:"PURCHASE_ONLY",category:i.type==="UMRAH"||i.type==="INDIVIDUAL_UMRAH"?"HAJJ_UMRAH":"GENERAL_SERVICE",date:i.date,relatedEntityId:i.supplierId,relatedEntityType:i.supplierType||"SUPPLIER",sellingPrice:0,purchasePrice:ne,programId:i.id,masterTripId:i.masterTripId,isPurchaseOnly:!0,adultCount:s.adult,childCount:s.child,infantCount:s.infant,roomType:s.type,employeeId:i.employeeId,employeeCommissionRate:i.employeeCommissionRate,applyCommission:i.applyCommission})});V("تم إثبات الفواتورة وترحيلها لحساب العميل والمورد بنجاح","success")})}Ee(!1),Ke(null),b({...st,currencyCode:D?.baseCurrency||"EGP"}),at("PROGRAMS")},Nl=(e,l)=>{Oe("هل أنت متأكد من إلغاء هذا المكون؟ سيتم إلغاء كافة القيود المالية المرتبطة به تلقائياً وتعديل حساب المورد والعميل.",()=>{(T||[]).filter(p=>p&&!p.isVoided&&p.programId===e&&p.componentId===l).forEach(p=>p?.id&&Ot(p.id,!0)),rt(p=>(p||[]).map(r=>r?.id===e?{...r,components:(r.components||[]).filter(g=>g?.id!==l)}:r)),V("تم إلغاء المكون وكافة قيوده المالية بنجاح.","success")})},Jt=(e,l,d)=>{const p=(A||[]).find(o=>o.id===e);if(!p)return;let r=(p.components||[]).find(o=>o.id===l),g=r?.supplierId,f=r?.name,j=r?.quantity||1,M=r?.currencyCode||"EGP",m=r?.exchangeRate||1,E=(r?.originalPurchasePrice||0)/(r?.quantity||1);const v=d?(T||[]).find(o=>o.id===d):(T||[]).find(o=>o.programId===e&&o.componentId===l&&o.supplierId&&!o.isVoided&&(o.type==="EXPENSE"||o.isPurchaseOnly));v&&(g=v.supplierId,f=v.description?.replace("شراء مكون:","")?.split("-")?.[0]?.trim()||v.description||f||"مكون سابق",M=v.currencyCode||"EGP",m=v.exchangeRate||1,E=v.amount||0,r||(j=(T||[]).filter(o=>o&&o.programId===e&&o.componentId===(l||v.componentId)&&o.supplierId===g&&!o.isVoided&&(o.type==="EXPENSE"||o.isPurchaseOnly)).length||1));const U=(O||[]).find(o=>o.id===g);ht({programId:e,componentId:l||v?.componentId||"",compName:f||"مكون غير معروف",supplierName:U?.company||"---",originalQuantity:j||1,quantity:"1",amount:E.toString(),currencyCode:M,exchangeRate:m.toString(),supplierId:g||"",supplierType:"SUPPLIER"}),pt(!0),setTimeout(()=>{const o=document.getElementById("return-form-section");o&&o.scrollIntoView({behavior:"smooth",block:"center"})},100)},jl=e=>{e.preventDefault(),e.stopPropagation();const l=parseInt(w.quantity),d=parseFloat(w.amount),p=parseFloat(w.exchangeRate||"1");if(l<=0||l>w.originalQuantity){V("كمية غير صالحة","error");return}if(d<=0){V("المبلغ غير صحيح","error");return}if(p<=0){V("سعر الصرف غير صحيح","error");return}try{const r=(A||[]).find(g=>g.id===w.programId);G({description:`ارتداد شراء مكون: ${w.compName} - عدد ${l} - برنامج: ${r?.name||"---"}`,amount:Number(Math.round(d*100)/100),purchasePrice:Number(Math.round(d*100)/100),sellingPrice:0,currencyCode:w.currencyCode||"EGP",exchangeRate:Number(p||1),type:"PURCHASE_ONLY",category:"HAJJ_UMRAH",date:new Date().toISOString().split("T")[0],supplierId:w.supplierId,supplierType:w.supplierType||"SUPPLIER",relatedEntityId:w.supplierId,relatedEntityType:w.supplierType||"SUPPLIER",programId:w.programId,componentId:w.componentId,isPurchaseOnly:!0,isReversal:!0}),pt(!1),V("تم تسجيل الارتداد بنجاح","success")}catch(r){console.error("Return submission error:",r),V("حدث خطأ أثناء الحفظ: "+r.message,"error")}},Cl=()=>{if(!F){V("لا يمكن عمل ارتداد لمكون في برنامج جديد لم يتم حفظه بعد.","error");return}if((n.components||[]).filter(l=>l&&l.supplierId).length===0){V("لا يوجد مكونات مرتبطة بموردين في هذا البرنامج لعمل ارتداد لها.","error");return}ut(!0)},El=e=>{if(!e.customerId){V("لا يمكن ترحيل برنامج بدون تحديد عميل.","error");return}const l=(Q||[]).find(r=>r.id===e.customerId),d=[{type:"SINGLE",adult:e.singleAdultCount||0,child:e.singleChildCount||0,infant:e.singleInfantCount||0},{type:"DOUBLE",adult:e.doubleAdultCount||0,child:e.doubleChildCount||0,infant:e.doubleInfantCount||0},{type:"TRIPLE",adult:e.tripleAdultCount||0,child:e.tripleChildCount||0,infant:e.tripleInfantCount||0},{type:"QUAD",adult:e.quadAdultCount||0,child:e.quadChildCount||0,infant:e.quadInfantCount||0},{type:e.roomType||"DEFAULT",adult:e.adultCount||0,child:e.childCount||0,infant:e.infantCount||0}].filter(r=>r&&(r.adult>0||r.child>0||r.infant>0));let p=0;d.length===0?p=e.sellingPrice:d.forEach(r=>{const g=r.type==="SINGLE"?e.singleSellingPrice||e.adultSellingPrice||e.sellingPrice||0:r.type==="DOUBLE"?e.doubleSellingPrice||e.adultSellingPrice||e.sellingPrice||0:r.type==="TRIPLE"?e.tripleSellingPrice||e.adultSellingPrice||e.sellingPrice||0:r.type==="QUAD"?e.quadSellingPrice||e.adultSellingPrice||e.sellingPrice||0:e.adultSellingPrice||e.sellingPrice||0,f=r.type==="SINGLE"?e.singleChildSellingPrice||e.childSellingPrice||0:r.type==="DOUBLE"?e.doubleChildSellingPrice||e.childSellingPrice||0:r.type==="TRIPLE"?e.tripleChildSellingPrice||e.childSellingPrice||0:r.type==="QUAD"?e.quadChildSellingPrice||e.childSellingPrice||0:e.childSellingPrice||0,j=r.type==="SINGLE"?e.singleInfantSellingPrice||e.infantSellingPrice||0:r.type==="DOUBLE"?e.doubleInfantSellingPrice||e.infantSellingPrice||0:r.type==="TRIPLE"?e.tripleInfantSellingPrice||e.infantSellingPrice||0:r.type==="QUAD"?e.quadInfantSellingPrice||e.infantSellingPrice||0:e.infantSellingPrice||0;p+=r.adult*g+r.child*f+r.infant*j}),Oe(`هل أنت متأكد من ترحيل مديونية بقيمة ${N(p)} للعميل (${l?.name}) الآن؟ سيتم ترحيل المكونات أيضاً.`,()=>{if(e.components&&e.components.length>0)e.components.forEach(r=>{if(r.type!=="EXPENSE")if(d.length===0){const g=r.sellingPrice||0,f=r.purchasePrice||0;G({description:`${e.name} - ${r.name}`,amount:g,currencyCode:e.currencyCode,exchangeRate:e.exchangeRate,type:"REVENUE_ONLY",category:r.type==="FLIGHT"?"FLIGHT":"GENERAL_SERVICE",date:e.date,relatedEntityId:e.customerId,relatedEntityType:"CUSTOMER",sellingPrice:g,purchasePrice:0,programId:e.id,componentId:r.id,masterTripId:e.masterTripId,isSaleOnly:!0,employeeId:r.employeeId||e.employeeId,employeeCommissionRate:e.employeeCommissionRate,commissionAmount:r.commissionAmount,applyCommission:r.isCommissionable!==void 0?r.isCommissionable:e.applyCommission}),(r.supplierId||e.supplierId)&&G({description:`شراء خدمة: ${r.name} - برنامج: ${e.name}`,amount:f,currencyCode:e.currencyCode,exchangeRate:e.exchangeRate,type:"PURCHASE_ONLY",category:r.type==="FLIGHT"?"FLIGHT":"GENERAL_SERVICE",date:e.date,relatedEntityId:r.supplierId||e.supplierId,relatedEntityType:r.supplierType||e.supplierType||"SUPPLIER",sellingPrice:0,purchasePrice:f,programId:e.id,componentId:r.id,masterTripId:e.masterTripId,isPurchaseOnly:!0,employeeId:r.employeeId||e.employeeId,applyCommission:!1})}else d.forEach(g=>{const f=g.type==="SINGLE"?r.singleSellingPrice||r.adultSellingPrice||r.sellingPrice||0:g.type==="DOUBLE"?r.doubleSellingPrice||r.adultSellingPrice||r.sellingPrice||0:g.type==="TRIPLE"?r.tripleSellingPrice||r.adultSellingPrice||r.sellingPrice||0:g.type==="QUAD"?r.quadSellingPrice||r.adultSellingPrice||r.sellingPrice||0:r.adultSellingPrice||r.sellingPrice||0,j=g.type==="SINGLE"?r.singleChildSellingPrice||r.childSellingPrice||0:g.type==="DOUBLE"?r.doubleChildSellingPrice||r.childSellingPrice||0:g.type==="TRIPLE"?r.tripleChildSellingPrice||r.childSellingPrice||0:g.type==="QUAD"?r.quadChildSellingPrice||r.childSellingPrice||0:r.childSellingPrice||0,M=g.type==="SINGLE"?r.singleInfantSellingPrice||r.infantSellingPrice||0:g.type==="DOUBLE"?r.doubleInfantSellingPrice||r.infantSellingPrice||0:g.type==="TRIPLE"?r.tripleInfantSellingPrice||r.infantSellingPrice||0:g.type==="QUAD"?r.quadInfantSellingPrice||r.infantSellingPrice||0:r.infantSellingPrice||0,m=g.adult*f+g.child*j+g.infant*M,E=g.type==="SINGLE"?r.singlePurchasePrice||r.adultPurchasePrice||r.purchasePrice||0:g.type==="DOUBLE"?r.doublePurchasePrice||r.adultPurchasePrice||r.purchasePrice||0:g.type==="TRIPLE"?r.triplePurchasePrice||r.adultPurchasePrice||r.purchasePrice||0:g.type==="QUAD"?r.quadPurchasePrice||r.adultPurchasePrice||r.purchasePrice||0:r.adultPurchasePrice||r.purchasePrice||0,v=g.type==="SINGLE"?r.singleChildPurchasePrice||r.childPurchasePrice||0:g.type==="DOUBLE"?r.doubleChildPurchasePrice||r.childPurchasePrice||0:g.type==="TRIPLE"?r.tripleChildPurchasePrice||r.childPurchasePrice||0:g.type==="QUAD"?r.quadChildPurchasePrice||r.childPurchasePrice||0:r.childPurchasePrice||0,U=g.type==="SINGLE"?r.singleInfantPurchasePrice||r.infantPurchasePrice||0:g.type==="DOUBLE"?r.doubleInfantPurchasePrice||r.infantPurchasePrice||0:g.type==="TRIPLE"?r.tripleInfantPurchasePrice||r.infantPurchasePrice||0:g.type==="QUAD"?r.quadInfantPurchasePrice||r.infantPurchasePrice||0:r.infantPurchasePrice||0,o=g.adult*E+g.child*v+g.infant*U;m>0&&G({description:`${e.name} - ${r.name} (${g.adult} بالغ، ${g.child} طفل، ${g.infant} رضيع) - ${g.type}`,amount:m,currencyCode:e.currencyCode,exchangeRate:e.exchangeRate,type:"REVENUE_ONLY",category:r.type==="FLIGHT"?"FLIGHT":"GENERAL_SERVICE",date:e.date,relatedEntityId:e.customerId,relatedEntityType:"CUSTOMER",sellingPrice:m,purchasePrice:0,programId:e.id,componentId:r.id,masterTripId:e.masterTripId,isSaleOnly:!0,adultCount:g.adult,childCount:g.child,infantCount:g.infant,roomType:g.type,employeeId:r.employeeId||e.employeeId,employeeCommissionRate:e.employeeCommissionRate,commissionAmount:r.commissionAmount,applyCommission:r.isCommissionable!==void 0?r.isCommissionable:e.applyCommission}),o>0&&(r.supplierId||e.supplierId)&&G({description:`شراء خدمة: ${r.name} - برنامج: ${e.name} (${g.type})`,amount:o,currencyCode:e.currencyCode,exchangeRate:e.exchangeRate,type:"PURCHASE_ONLY",category:r.type==="FLIGHT"?"FLIGHT":"GENERAL_SERVICE",date:e.date,relatedEntityId:r.supplierId||e.supplierId,relatedEntityType:r.supplierType||e.supplierType||"SUPPLIER",sellingPrice:0,purchasePrice:o,programId:e.id,componentId:r.id,masterTripId:e.masterTripId,isPurchaseOnly:!0,adultCount:g.adult,childCount:g.child,infantCount:g.infant,roomType:g.type,employeeId:r.employeeId||e.employeeId,employeeCommissionRate:e.employeeCommissionRate,commissionAmount:r.commissionAmount,applyCommission:r.isCommissionable!==void 0?r.isCommissionable:e.applyCommission})})});else if(d.length===0){const r=e.sellingPrice,g=e.purchasePrice;G({description:`مبيعات برنامج: ${e.name} - عميل: ${l?.name}`,amount:r,currencyCode:e.currencyCode,exchangeRate:e.exchangeRate,type:"REVENUE_ONLY",category:e.type==="UMRAH"||e.type==="INDIVIDUAL_UMRAH"?"HAJJ_UMRAH":"GENERAL_SERVICE",date:e.date,relatedEntityId:e.customerId,relatedEntityType:"CUSTOMER",sellingPrice:r,purchasePrice:0,programId:e.id,masterTripId:e.masterTripId,isSaleOnly:!0,employeeId:e.employeeId,employeeCommissionRate:e.employeeCommissionRate,commissionAmount:e.commissionAmount,applyCommission:e.applyCommission}),e.supplierId&&G({description:`شراء برنامج: ${e.name} - مورد: ${(O||[]).find(f=>f?.id===e.supplierId)?.company||"---"}`,amount:g,currencyCode:e.currencyCode,exchangeRate:e.exchangeRate,type:"PURCHASE_ONLY",category:e.type==="UMRAH"||e.type==="INDIVIDUAL_UMRAH"?"HAJJ_UMRAH":"GENERAL_SERVICE",date:e.date,relatedEntityId:e.supplierId,relatedEntityType:e.supplierType||"SUPPLIER",sellingPrice:0,purchasePrice:g,programId:e.id,masterTripId:e.masterTripId,isPurchaseOnly:!0,employeeId:e.employeeId,employeeCommissionRate:e.employeeCommissionRate,commissionAmount:e.commissionAmount,applyCommission:e.applyCommission})}else d.forEach(r=>{const g=r.type==="SINGLE"?e.singleSellingPrice||e.adultSellingPrice||e.sellingPrice||0:r.type==="DOUBLE"?e.doubleSellingPrice||e.adultSellingPrice||e.sellingPrice||0:r.type==="TRIPLE"?e.tripleSellingPrice||e.adultSellingPrice||e.sellingPrice||0:r.type==="QUAD"?e.quadSellingPrice||e.adultSellingPrice||e.sellingPrice||0:e.adultSellingPrice||e.sellingPrice||0,f=r.type==="SINGLE"?e.singleChildSellingPrice||e.childSellingPrice||0:r.type==="DOUBLE"?e.doubleChildSellingPrice||e.childSellingPrice||0:r.type==="TRIPLE"?e.tripleChildSellingPrice||e.childSellingPrice||0:r.type==="QUAD"?e.quadChildSellingPrice||e.childSellingPrice||0:e.childSellingPrice||0,j=r.type==="SINGLE"?e.singleInfantSellingPrice||e.infantSellingPrice||0:r.type==="DOUBLE"?e.doubleInfantSellingPrice||e.infantSellingPrice||0:r.type==="TRIPLE"?e.tripleInfantSellingPrice||e.infantSellingPrice||0:r.type==="QUAD"?e.quadInfantSellingPrice||e.infantSellingPrice||0:e.infantSellingPrice||0,M=r.adult*g+r.child*f+r.infant*j,m=r.type==="SINGLE"?e.singlePurchasePrice||e.adultPurchasePrice||e.purchasePrice||0:r.type==="DOUBLE"?e.doublePurchasePrice||e.adultPurchasePrice||e.purchasePrice||0:r.type==="TRIPLE"?e.triplePurchasePrice||e.adultPurchasePrice||e.purchasePrice||0:r.type==="QUAD"?e.quadPurchasePrice||e.adultPurchasePrice||e.purchasePrice||0:e.adultPurchasePrice||e.purchasePrice||0,E=r.type==="SINGLE"?e.singleChildPurchasePrice||e.childPurchasePrice||0:r.type==="DOUBLE"?e.doubleChildPurchasePrice||e.childPurchasePrice||0:r.type==="TRIPLE"?e.tripleChildPurchasePrice||e.childPurchasePrice||0:r.type==="QUAD"?e.quadChildPurchasePrice||e.childPurchasePrice||0:e.childPurchasePrice||0,v=r.type==="SINGLE"?e.singleInfantPurchasePrice||e.infantPurchasePrice||0:r.type==="DOUBLE"?e.doubleInfantPurchasePrice||e.infantPurchasePrice||0:r.type==="TRIPLE"?e.tripleInfantPurchasePrice||e.infantPurchasePrice||0:r.type==="QUAD"?e.quadInfantPurchasePrice||e.infantPurchasePrice||0:e.infantPurchasePrice||0,U=r.adult*m+r.child*E+r.infant*v;G({description:`مبيعات برنامج: ${e.name} - عميل: ${l?.name} (${r.adult} بالغ، ${r.child} طفل، ${r.infant} رضيع) - ${r.type}`,amount:M,currencyCode:e.currencyCode,exchangeRate:e.exchangeRate,type:"REVENUE_ONLY",category:e.type==="UMRAH"||e.type==="INDIVIDUAL_UMRAH"?"HAJJ_UMRAH":"GENERAL_SERVICE",date:e.date,relatedEntityId:e.customerId,relatedEntityType:"CUSTOMER",sellingPrice:M,purchasePrice:0,programId:e.id,masterTripId:e.masterTripId,isSaleOnly:!0,adultCount:r.adult,childCount:r.child,infantCount:r.infant,roomType:r.type,employeeId:e.employeeId,employeeCommissionRate:e.employeeCommissionRate,applyCommission:e.applyCommission}),e.supplierId&&G({description:`شراء برنامج: ${e.name} - مورد: ${(O||[]).find(o=>o?.id===e.supplierId)?.company||"---"} (${r.type})`,amount:U,currencyCode:e.currencyCode,exchangeRate:e.exchangeRate,type:"PURCHASE_ONLY",category:e.type==="UMRAH"||e.type==="INDIVIDUAL_UMRAH"?"HAJJ_UMRAH":"GENERAL_SERVICE",date:e.date,relatedEntityId:e.supplierId,relatedEntityType:e.supplierType||"SUPPLIER",sellingPrice:0,purchasePrice:U,programId:e.id,masterTripId:e.masterTripId,isPurchaseOnly:!0,adultCount:r.adult,childCount:r.child,infantCount:r.infant,roomType:r.type,employeeId:e.employeeId,employeeCommissionRate:e.employeeCommissionRate,applyCommission:e.applyCommission})});if(e.components){const r={...e,components:e.components.map(g=>({...g,isPosted:!0}))};rt(g=>(g||[]).map(f=>f.id===e.id?r:f))}Je("CREATE","TRANSACTION",e.id,`ترحيل حسابات البرنامج يدوياً: ${e.name}`),V("تم ترحيل الفواتير للحسابات بنجاح.","success")})},Xt=e=>{Ke(e.id),b({name:e.name,masterTripId:e.masterTripId||"",customerId:e.customerId||"",supplierId:e.supplierId,supplierType:e.supplierType||"SUPPLIER",purchasePrice:e.purchasePrice.toString(),sellingPrice:e.sellingPrice.toString(),adultPurchasePrice:(e.adultPurchasePrice||e.purchasePrice||0).toString(),childPurchasePrice:(e.childPurchasePrice||0).toString(),infantPurchasePrice:(e.infantPurchasePrice||0).toString(),singlePurchasePrice:(e.singlePurchasePrice||0).toString(),singleChildPurchasePrice:(e.singleChildPurchasePrice||0).toString(),singleInfantPurchasePrice:(e.singleInfantPurchasePrice||0).toString(),doublePurchasePrice:(e.doublePurchasePrice||0).toString(),doubleChildPurchasePrice:(e.doubleChildPurchasePrice||0).toString(),doubleInfantPurchasePrice:(e.doubleInfantPurchasePrice||0).toString(),triplePurchasePrice:(e.triplePurchasePrice||0).toString(),tripleChildPurchasePrice:(e.tripleChildPurchasePrice||0).toString(),tripleInfantPurchasePrice:(e.tripleInfantPurchasePrice||0).toString(),quadPurchasePrice:(e.quadPurchasePrice||0).toString(),quadChildPurchasePrice:(e.quadChildPurchasePrice||0).toString(),quadInfantPurchasePrice:(e.quadInfantPurchasePrice||0).toString(),adultSellingPrice:(e.adultSellingPrice||e.sellingPrice||0).toString(),childSellingPrice:(e.childSellingPrice||0).toString(),infantSellingPrice:(e.infantSellingPrice||0).toString(),singleSellingPrice:(e.singleSellingPrice||0).toString(),singleChildSellingPrice:(e.singleChildSellingPrice||0).toString(),singleInfantSellingPrice:(e.singleInfantSellingPrice||0).toString(),doubleSellingPrice:(e.doubleSellingPrice||0).toString(),doubleChildSellingPrice:(e.doubleChildSellingPrice||0).toString(),doubleInfantSellingPrice:(e.doubleInfantSellingPrice||0).toString(),tripleSellingPrice:(e.tripleSellingPrice||0).toString(),tripleChildSellingPrice:(e.tripleChildSellingPrice||0).toString(),tripleInfantSellingPrice:(e.tripleInfantSellingPrice||0).toString(),quadSellingPrice:(e.quadSellingPrice||0).toString(),quadChildSellingPrice:(e.quadChildSellingPrice||0).toString(),quadInfantSellingPrice:(e.quadInfantSellingPrice||0).toString(),adultAgentPrice:(e.adultAgentPrice||0).toString(),childAgentPrice:(e.childAgentPrice||0).toString(),infantAgentPrice:(e.infantAgentPrice||0).toString(),singleAgentPrice:(e.singleAgentPrice||0).toString(),doubleAgentPrice:(e.doubleAgentPrice||0).toString(),tripleAgentPrice:(e.tripleAgentPrice||0).toString(),quadAgentPrice:(e.quadAgentPrice||0).toString(),type:e.type,date:e.date,currencyCode:e.currencyCode,exchangeRate:(e.exchangeRate||1).toString(),components:e.components||[],adultCount:(e.adultCount||0).toString(),childCount:(e.childCount||0).toString(),infantCount:(e.infantCount||0).toString(),singleAdultCount:(e.singleAdultCount||0).toString(),singleChildCount:(e.singleChildCount||0).toString(),singleInfantCount:(e.singleInfantCount||0).toString(),doubleAdultCount:(e.doubleAdultCount||0).toString(),doubleChildCount:(e.doubleChildCount||0).toString(),doubleInfantCount:(e.doubleInfantCount||0).toString(),tripleAdultCount:(e.tripleAdultCount||0).toString(),tripleChildCount:(e.tripleChildCount||0).toString(),tripleInfantCount:(e.tripleInfantCount||0).toString(),quadAdultCount:(e.quadAdultCount||0).toString(),quadChildCount:(e.quadChildCount||0).toString(),quadInfantCount:(e.quadInfantCount||0).toString(),roomType:e.roomType||"DEFAULT",isAgent:e.isAgent||!1,employeeId:e.employeeId||"",employeeCommissionRate:(e.employeeCommissionRate||0).toString(),commissionAmount:(e.commissionAmount||0).toString(),applyCommission:e.applyCommission??!0}),Ee(!0)},vl=e=>{e.preventDefault();const l=parseFloat(C.amount||"0"),d=parseFloat(C.exchangeRate||"1"),p=(O||[]).find(g=>g.id===C.supplierId),r=(A||[]).find(g=>g.id===C.programId);if(l<=0||!C.supplierId||!C.treasuryId){V("يرجى ملء كافة البيانات المطلوبة","error");return}G({description:`دفع خطاب ضمان للوكيل: ${p?.company} - ${r?.name||"عام"}`,amount:l,amountInBase:l*d,currencyCode:C.currencyCode,exchangeRate:d,type:"EXPENSE",category:"GUARANTEE_LETTER",date:C.date,relatedEntityId:C.supplierId,relatedEntityType:"SUPPLIER",treasuryId:C.treasuryId,programId:C.programId||void 0,masterTripId:r?.masterTripId||void 0,details:C.details,costCenterId:C.costCenterId||void 0}),dt(!1),ce({supplierId:"",programId:"",amount:"",currencyCode:D.baseCurrency||"EGP",exchangeRate:"1",treasuryId:"",date:new Date().toISOString().split("T")[0],details:"",costCenterId:""})},Tl=e=>{Oe("هل تريد تأكيد استرداد خطاب الضمان هذا وإعادته للخزينة؟",()=>{G({description:`استرداد خطاب ضمان: ${e.description}`,amount:e.amount,amountInBase:e.amountInBase,currencyCode:e.currencyCode,exchangeRate:e.exchangeRate,type:"INCOME",category:"GUARANTEE_LETTER",date:new Date().toISOString().split("T")[0],relatedEntityId:e.relatedEntityId,relatedEntityType:"SUPPLIER",treasuryId:e.treasuryId,programId:e.programId,masterTripId:e.masterTripId,costCenterId:e.costCenterId,parentTransactionId:e.id})})},wl=e=>{St(e.id),R({programId:e.programId||"",customerId:e.bookingType==="AGENT"?"":e.relatedEntityId||"",agentId:e.bookingType==="AGENT"&&e.relatedEntityId||"",bookingType:e.bookingType||"DIRECT",employeeId:e.employeeId||"",accommodationEmployeeId:e.accommodationEmployeeId||"",accommodation:e.accommodation||"",roomType:e.roomType||"DEFAULT",discount:(e.discount||0).toString(),date:e.date,customSellingPrice:(e.sellingPrice||0).toString(),adultCount:(e.adultCount||0).toString(),childCount:(e.childCount||0).toString(),infantCount:(e.infantCount||0).toString(),supervisorCount:(e.supervisorCount||0).toString(),supervisorName:e.supervisorName||"",names:e.names||"",employeeCommissionRate:(e.employeeCommissionRate||0).toString(),commissionAmount:(e.commissionAmount||0).toString(),applyCommission:e.applyCommission??!0,costCenterId:e.costCenterId||""}),Ye(!0)},Al=e=>{e.preventDefault();const l=(A||[]).find(m=>m.id===a.programId);if(!l)return;const d=Z?(T||[]).find(m=>m.id===Z):null,p=d?.bookingGroupId||`BG-${Date.now()}`,r=parseInt(a.adultCount||"0"),g=parseInt(a.childCount||"0"),f=parseInt(a.infantCount||"0"),j=parseInt(a.supervisorCount||"0"),M=r+g+j;if(l.components&&l.components.length>0)for(const m of l.components){const E=m.supplierId||l.supplierId;if(E&&_e[E]){const v=_e[E];if(v.used+M>v.total){V(`خطأ: لا يمكن إتمام الحجز. كوتا التأشيرات للمورد (${(O||[]).find(U=>U.id===E)?.company}) غير كافية. المتبقي: ${v.total-v.used}`,"error");return}}}else if(l.supplierId&&_e[l.supplierId]){const m=_e[l.supplierId];if(m.used+M>m.total){V(`خطأ: لا يمكن إتمام الحجز. كوتا التأشيرات للمورد (${(O||[]).find(E=>E.id===l.supplierId)?.company}) غير كافية. المتبقي: ${m.total-m.used}`,"error");return}}if(l.components&&l.components.length>0){const m=l.exchangeRate||1;let E=0;l.components.forEach(o=>{if(o.type!=="EXPENSE")if(o.pricingMode==="TOTAL")E+=o.sellingPrice||0;else{const X=a.roomType==="SINGLE"?o.singleSellingPrice||o.adultSellingPrice||o.sellingPrice||0:a.roomType==="DOUBLE"?o.doubleSellingPrice||o.adultSellingPrice||o.sellingPrice||0:a.roomType==="TRIPLE"?o.tripleSellingPrice||o.adultSellingPrice||o.sellingPrice||0:a.roomType==="QUAD"?o.quadSellingPrice||o.adultSellingPrice||o.sellingPrice||0:o.adultSellingPrice||o.sellingPrice||0,ee=a.roomType==="SINGLE"?o.singleChildSellingPrice||o.childSellingPrice||0:a.roomType==="DOUBLE"?o.doubleChildSellingPrice||o.childSellingPrice||0:a.roomType==="TRIPLE"?o.tripleChildSellingPrice||o.childSellingPrice||0:a.roomType==="QUAD"?o.quadChildSellingPrice||o.childSellingPrice||0:o.childSellingPrice||0,_=a.roomType==="SINGLE"?o.singleInfantSellingPrice||o.infantSellingPrice||0:a.roomType==="DOUBLE"?o.doubleInfantSellingPrice||o.infantSellingPrice||0:a.roomType==="TRIPLE"?o.tripleInfantSellingPrice||o.infantSellingPrice||0:a.roomType==="QUAD"?o.quadInfantSellingPrice||o.infantSellingPrice||0:o.infantSellingPrice||0;E+=r*X+g*ee+f*_+j*X}});const v=parseFloat(a.customSellingPrice||"0")*m,U=E>0?v*(1/(E||1)):v>0?1:null;(l.components||[]).forEach(o=>{if(!o)return;const X=o.type==="FLIGHT"?"FLIGHT":o.type==="GUARANTEE_LETTER"?"GUARANTEE_LETTER":o.type==="GIFTS_AND_PRINTS"?"GIFTS_AND_PRINTS":"GENERAL_SERVICE",ee="INCOME";let _=0,te=0;if(o.pricingMode==="TOTAL"){if(_=o.type==="EXPENSE"?0:o.sellingPrice||0,U!==null&&o.type!=="EXPENSE")if(E>0)_=_*U;else{const z=(l.components||[]).filter(q=>q&&q.type!=="EXPENSE").length||1;_=v*(1/z)}te=o.purchasePrice||0}else{const z=a.roomType==="SINGLE"?o.singleSellingPrice||o.adultSellingPrice||o.sellingPrice||0:a.roomType==="DOUBLE"?o.doubleSellingPrice||o.adultSellingPrice||o.sellingPrice||0:a.roomType==="TRIPLE"?o.tripleSellingPrice||o.adultSellingPrice||o.sellingPrice||0:a.roomType==="QUAD"?o.quadSellingPrice||o.adultSellingPrice||o.sellingPrice||0:o.adultSellingPrice||o.sellingPrice||0,q=a.roomType==="SINGLE"?o.singleChildSellingPrice||o.childSellingPrice||0:a.roomType==="DOUBLE"?o.doubleChildSellingPrice||o.childSellingPrice||0:a.roomType==="TRIPLE"?o.tripleChildSellingPrice||o.childSellingPrice||0:a.roomType==="QUAD"?o.quadChildSellingPrice||o.childSellingPrice||0:o.childSellingPrice||0,Ae=a.roomType==="SINGLE"?o.singleInfantSellingPrice||o.infantSellingPrice||0:a.roomType==="DOUBLE"?o.doubleInfantSellingPrice||o.infantSellingPrice||0:a.roomType==="TRIPLE"?o.tripleInfantSellingPrice||o.infantSellingPrice||0:a.roomType==="QUAD"?o.quadInfantSellingPrice||o.infantSellingPrice||0:o.infantSellingPrice||0;if(_=o.type==="EXPENSE"?0:r*z+g*q+f*Ae+j*z,U!==null&&o.type!=="EXPENSE")if(E>0)_=_*U;else{const Be=(l.components||[]).filter(S=>S&&S.type!=="EXPENSE").length||1;_=v*(1/Be)}const Ne=a.roomType==="SINGLE"?o.singlePurchasePrice||o.adultPurchasePrice||o.purchasePrice||0:a.roomType==="DOUBLE"?o.doublePurchasePrice||o.adultPurchasePrice||o.purchasePrice||0:a.roomType==="TRIPLE"?o.triplePurchasePrice||o.adultPurchasePrice||o.purchasePrice||0:a.roomType==="QUAD"?o.quadPurchasePrice||o.adultPurchasePrice||o.purchasePrice||0:o.adultPurchasePrice||o.purchasePrice||0,Re=a.roomType==="SINGLE"?o.singleChildPurchasePrice||o.childPurchasePrice||0:a.roomType==="DOUBLE"?o.doubleChildPurchasePrice||o.childPurchasePrice||0:a.roomType==="TRIPLE"?o.tripleChildPurchasePrice||o.childPurchasePrice||0:a.roomType==="QUAD"?o.quadChildPurchasePrice||o.childPurchasePrice||0:o.childPurchasePrice||0,Le=a.roomType==="SINGLE"?o.singleInfantPurchasePrice||o.infantPurchasePrice||0:a.roomType==="DOUBLE"?o.doubleInfantPurchasePrice||o.infantPurchasePrice||0:a.roomType==="TRIPLE"?o.tripleInfantPurchasePrice||o.infantPurchasePrice||0:a.roomType==="QUAD"?o.quadInfantPurchasePrice||o.infantPurchasePrice||0:o.infantPurchasePrice||0;te=r*Ne+g*Re+f*Le+j*Ne}const le=o.type==="EXPENSE"?0:parseFloat(a.discount||"0")*(_*(1/(E||1)))*(1/m),ue=_*(1/m),me=o.isCommissionable!==!1?o.commissionAmount||parseFloat(a.employeeCommissionRate||"0"):0,be=`(${r} بالغ، ${g} طفل، ${f} رضيع${j>0?`، ${j} مشرف${a.supervisorName?`: ${a.supervisorName}`:""}`:""})`,ye=a.names?` - الأسماء: ${a.names}`:"",Ie=o.type==="FLIGHT"?"تذكرة طيران":o.type==="VISA"?"تأشيرة":o.type==="HOTEL"?"فندق":o.type==="INTERNAL_TRANSPORT"?"نقل داخلي":o.type==="SAUDI_TRANSPORT"?"نقل سعودي":o.type==="GUARANTEE_LETTER"?"خطاب ضمان":o.type==="GIFTS_AND_PRINTS"?"هدايا ومطبوعات":"مصروفات",pe=a.accommodation?.trim()||l.name||"غير محدد",he={description:`${Ie} - ${pe} ${be}${ye}`,amount:ue-le,currencyCode:l.currencyCode,exchangeRate:l.exchangeRate,type:ee,category:X,date:a.date,relatedEntityId:a.bookingType==="AGENT"?a.agentId:a.customerId,relatedEntityType:"CUSTOMER",supplierId:o.supplierId||l.supplierId,supplierType:o.supplierType||l.supplierType||"SUPPLIER",employeeId:a.employeeId,employeeCommissionRate:me,accommodationEmployeeId:a.accommodationEmployeeId,accommodation:o.type==="HOTEL"?o.name:a.accommodation,purchasePrice:te*(1/m),sellingPrice:ue,adultCount:r,childCount:g,infantCount:f,supervisorCount:j,supervisorName:a.supervisorName,names:a.names,roomType:a.roomType,discount:le,programId:l.id,masterTripId:l.masterTripId,componentId:o.id,bookingGroupId:p,bookingType:a.bookingType,agentId:a.bookingType==="AGENT"?a.agentId:void 0,isSaleOnly:!1,visaStatus:o.type==="VISA"?"PENDING":void 0,visaIssuedCount:o.type==="VISA"?0:void 0,costCenterId:a.costCenterId||void 0,applyCommission:a.applyCommission};if(Z){let z=(T||[]).find(q=>q.bookingGroupId===p&&q.componentId===o.id&&!q.isVoided);!z&&!d?.bookingGroupId&&(z=(T||[]).find(q=>q.programId===l.id&&q.relatedEntityId===(a.bookingType==="AGENT"?a.agentId:a.customerId)&&q.date===a.date&&q.category===X&&q.supplierId===(o.supplierId||l.supplierId)&&!q.bookingGroupId&&!q.isVoided)),z?je(z.id,he):d&&d.id===Z&&d.category===X&&d.supplierId===(o.supplierId||l.supplierId)?je(Z,he):d?.bookingGroupId&&G(he)}else G(he)})}else{const m=a.bookingType==="AGENT"?a.roomType==="SINGLE"?l.singleAgentPrice||l.adultAgentPrice||0:a.roomType==="DOUBLE"?l.doubleAgentPrice||l.adultAgentPrice||0:a.roomType==="TRIPLE"?l.tripleAgentPrice||l.adultAgentPrice||0:a.roomType==="QUAD"?l.quadAgentPrice||l.adultAgentPrice||0:l.adultAgentPrice||0:a.roomType==="SINGLE"?parseFloat(l.singleSellingPrice?.toString()||l.adultSellingPrice?.toString()||l.sellingPrice?.toString()||"0"):a.roomType==="DOUBLE"?parseFloat(l.doubleSellingPrice?.toString()||l.adultSellingPrice?.toString()||l.sellingPrice?.toString()||"0"):a.roomType==="TRIPLE"?parseFloat(l.tripleSellingPrice?.toString()||l.adultSellingPrice?.toString()||l.sellingPrice?.toString()||"0"):a.roomType==="QUAD"?parseFloat(l.quadSellingPrice?.toString()||l.adultSellingPrice?.toString()||l.sellingPrice?.toString()||"0"):parseFloat(l.adultSellingPrice?.toString()||l.sellingPrice?.toString()||"0"),E=a.bookingType==="AGENT"?l.childAgentPrice||0:a.roomType==="SINGLE"?parseFloat(l.singleChildSellingPrice?.toString()||l.childSellingPrice?.toString()||"0"):a.roomType==="DOUBLE"?parseFloat(l.doubleChildSellingPrice?.toString()||l.childSellingPrice?.toString()||"0"):a.roomType==="TRIPLE"?parseFloat(l.tripleChildSellingPrice?.toString()||l.childSellingPrice?.toString()||"0"):a.roomType==="QUAD"?parseFloat(l.quadChildSellingPrice?.toString()||l.childSellingPrice?.toString()||"0"):parseFloat(l.childSellingPrice?.toString()||"0"),v=a.bookingType==="AGENT"?l.infantAgentPrice||0:a.roomType==="SINGLE"?parseFloat(l.singleInfantSellingPrice?.toString()||l.infantSellingPrice?.toString()||"0"):a.roomType==="DOUBLE"?parseFloat(l.doubleInfantSellingPrice?.toString()||l.infantSellingPrice?.toString()||"0"):a.roomType==="TRIPLE"?parseFloat(l.tripleInfantSellingPrice?.toString()||l.infantSellingPrice?.toString()||"0"):a.roomType==="QUAD"?parseFloat(l.quadInfantSellingPrice?.toString()||l.infantSellingPrice?.toString()||"0"):parseFloat(l.infantSellingPrice?.toString()||"0"),U=a.roomType==="SINGLE"?parseFloat(l.singlePurchasePrice?.toString()||l.adultPurchasePrice?.toString()||l.purchasePrice?.toString()||"0"):a.roomType==="DOUBLE"?parseFloat(l.doublePurchasePrice?.toString()||l.adultPurchasePrice?.toString()||l.purchasePrice?.toString()||"0"):a.roomType==="TRIPLE"?parseFloat(l.triplePurchasePrice?.toString()||l.adultPurchasePrice?.toString()||l.purchasePrice?.toString()||"0"):a.roomType==="QUAD"?parseFloat(l.quadPurchasePrice?.toString()||l.adultPurchasePrice?.toString()||l.purchasePrice?.toString()||"0"):parseFloat(l.adultPurchasePrice?.toString()||l.purchasePrice?.toString()||"0"),o=a.roomType==="SINGLE"?parseFloat(l.singleChildPurchasePrice?.toString()||l.childPurchasePrice?.toString()||"0"):a.roomType==="DOUBLE"?parseFloat(l.doubleChildPurchasePrice?.toString()||l.childPurchasePrice?.toString()||"0"):a.roomType==="TRIPLE"?parseFloat(l.tripleChildPurchasePrice?.toString()||l.childPurchasePrice?.toString()||"0"):a.roomType==="QUAD"?parseFloat(l.quadChildPurchasePrice?.toString()||l.childPurchasePrice?.toString()||"0"):parseFloat(l.childPurchasePrice?.toString()||"0"),X=a.roomType==="SINGLE"?parseFloat(l.singleInfantPurchasePrice?.toString()||l.infantPurchasePrice?.toString()||"0"):a.roomType==="DOUBLE"?parseFloat(l.doubleInfantPurchasePrice?.toString()||l.infantPurchasePrice?.toString()||"0"):a.roomType==="TRIPLE"?parseFloat(l.tripleInfantPurchasePrice?.toString()||l.infantPurchasePrice?.toString()||"0"):a.roomType==="QUAD"?parseFloat(l.quadInfantPurchasePrice?.toString()||l.infantPurchasePrice?.toString()||"0"):parseFloat(l.infantPurchasePrice?.toString()||"0"),ee=r*m+g*E+f*v+j*m,_=r*U+g*o+f*X+j*U,te=parseFloat(a.customSellingPrice||ee.toString()),le=parseFloat(a.discount||"0"),ue=`(${r} بالغ، ${g} طفل، ${f} رضيع${j>0?`، ${j} مشرف${a.supervisorName?`: ${a.supervisorName}`:""}`:""})`,me=a.names?` - الأسماء: ${a.names}`:"",be=l.type==="HAJJ"?"حج":"عمرة",ye=a.accommodation?.trim()||l.name||"غير محدد",pe={description:`${be} - ${ye} ${ue}${me}`,amount:te-le,currencyCode:l.currencyCode,exchangeRate:l.exchangeRate,type:"INCOME",category:"HAJJ_UMRAH",date:a.date,relatedEntityId:a.bookingType==="AGENT"?a.agentId:a.customerId,relatedEntityType:"CUSTOMER",supplierId:l.supplierId,supplierType:l.supplierType||"SUPPLIER",employeeId:a.employeeId,employeeCommissionRate:parseFloat(a.employeeCommissionRate||"0"),accommodationEmployeeId:a.accommodationEmployeeId,accommodation:a.accommodation,purchasePrice:_,sellingPrice:te,adultCount:r,childCount:g,infantCount:f,supervisorCount:j,supervisorName:a.supervisorName,names:a.names,roomType:a.roomType,discount:le,programId:l.id,masterTripId:l.masterTripId,bookingGroupId:p,bookingType:a.bookingType,agentId:a.bookingType==="AGENT"?a.agentId:void 0,visaStatus:"PENDING",visaIssuedCount:0,costCenterId:a.costCenterId||void 0,applyCommission:a.applyCommission};Z?je(Z,pe):G(pe)}Ye(!1),St(null),R(Ft)},Rl=()=>{const e=parseFloat(c.exchangeRate||"1")||1,l=parseFloat(c.quantity||"1")||1,d=parseFloat(c.purchasePrice||"0")||parseFloat(c.doublePurchasePrice||"0")||parseFloat(c.singlePurchasePrice||"0")||parseFloat(c.triplePurchasePrice||"0")||parseFloat(c.quadPurchasePrice||"0")||parseFloat(c.adultPurchasePrice||"0")||0,p=parseFloat(c.sellingPrice||"0")||parseFloat(c.doubleSellingPrice||"0")||parseFloat(c.singleSellingPrice||"0")||parseFloat(c.tripleSellingPrice||"0")||parseFloat(c.quadSellingPrice||"0")||parseFloat(c.adultSellingPrice||"0")||0,r=d*l,g=p*l,f=(parseFloat(c.adultPurchasePrice||"0")||d)*l,j=parseFloat(c.childPurchasePrice||"0")*l,M=parseFloat(c.infantPurchasePrice||"0")*l,m=parseFloat(c.singlePurchasePrice||"0")*l,E=parseFloat(c.singleChildPurchasePrice||"0")*l,v=parseFloat(c.singleInfantPurchasePrice||"0")*l,U=parseFloat(c.doublePurchasePrice||"0")*l,o=parseFloat(c.doubleChildPurchasePrice||"0")*l,X=parseFloat(c.doubleInfantPurchasePrice||"0")*l,ee=parseFloat(c.triplePurchasePrice||"0")*l,_=parseFloat(c.tripleChildPurchasePrice||"0")*l,te=parseFloat(c.tripleInfantPurchasePrice||"0")*l,le=parseFloat(c.quadPurchasePrice||"0")*l,ue=parseFloat(c.quadChildPurchasePrice||"0")*l,me=parseFloat(c.quadInfantPurchasePrice||"0")*l,be=(parseFloat(c.adultSellingPrice||"0")||p)*l,ye=parseFloat(c.childSellingPrice||"0")*l,Ie=parseFloat(c.infantSellingPrice||"0")*l,pe=parseFloat(c.singleSellingPrice||"0")*l,He=parseFloat(c.singleChildSellingPrice||"0")*l,he=parseFloat(c.singleInfantSellingPrice||"0")*l,z=parseFloat(c.doubleSellingPrice||"0")*l,q=parseFloat(c.doubleChildSellingPrice||"0")*l,Ae=parseFloat(c.doubleInfantSellingPrice||"0")*l,Ne=parseFloat(c.tripleSellingPrice||"0")*l,Re=parseFloat(c.tripleChildSellingPrice||"0")*l,Le=parseFloat(c.tripleInfantSellingPrice||"0")*l,Be=parseFloat(c.quadSellingPrice||"0")*l,S=parseFloat(c.quadChildSellingPrice||"0")*l,i=parseFloat(c.quadInfantSellingPrice||"0")*l,h=r*e,u=c.type==="EXPENSE"?0:g*e,Ue=f*e,s=j*e,P=M*e,L=m*e,x=E*e,J=v*e,Y=U*e,ie=o*e,ae=X*e,ne=ee*e,de=_*e,De=te*e,Fe=le*e,Ge=ue*e,Ve=me*e,vt=be*e,Tt=ye*e,wt=Ie*e,At=pe*e,Ol=He*e,Ml=he*e,$l=z*e,_l=q*e,Hl=Ae*e,Bl=Ne*e,Vl=Re*e,Ql=Le*e,zl=Be*e,Jl=S*e,Xl=i*e,$={id:Pe||Date.now().toString(),type:c.type,name:c.name,pricingMode:c.pricingMode,quantity:l,purchasePrice:h,sellingPrice:u,adultPurchasePrice:Ue,childPurchasePrice:s,infantPurchasePrice:P,singlePurchasePrice:L,singleChildPurchasePrice:x,singleInfantPurchasePrice:J,doublePurchasePrice:Y,doubleChildPurchasePrice:ie,doubleInfantPurchasePrice:ae,triplePurchasePrice:ne,tripleChildPurchasePrice:de,tripleInfantPurchasePrice:De,quadPurchasePrice:Fe,quadChildPurchasePrice:Ge,quadInfantPurchasePrice:Ve,adultSellingPrice:vt,childSellingPrice:Tt,infantSellingPrice:wt,singleSellingPrice:At,singleChildSellingPrice:Ol,singleInfantSellingPrice:Ml,doubleSellingPrice:$l,doubleChildSellingPrice:_l,doubleInfantSellingPrice:Hl,tripleSellingPrice:Bl,tripleChildSellingPrice:Vl,tripleInfantSellingPrice:Ql,quadSellingPrice:zl,quadChildSellingPrice:Jl,quadInfantSellingPrice:Xl,originalPurchasePrice:r,originalSellingPrice:g,originalAdultPurchasePrice:f,originalChildPurchasePrice:j,originalInfantPurchasePrice:M,originalSinglePurchasePrice:m,originalSingleChildPurchasePrice:E,originalSingleInfantPurchasePrice:v,originalDoublePurchasePrice:U,originalDoubleChildPurchasePrice:o,originalDoubleInfantPurchasePrice:X,originalTriplePurchasePrice:ee,originalTripleChildPurchasePrice:_,originalTripleInfantPurchasePrice:te,originalQuadPurchasePrice:le,originalQuadChildPurchasePrice:ue,originalQuadInfantPurchasePrice:me,originalAdultSellingPrice:be,originalChildSellingPrice:ye,originalInfantSellingPrice:Ie,originalSingleSellingPrice:pe,originalSingleChildSellingPrice:He,originalSingleInfantSellingPrice:he,originalDoubleSellingPrice:z,originalDoubleChildSellingPrice:q,originalDoubleInfantSellingPrice:Ae,originalTripleSellingPrice:Ne,originalTripleChildSellingPrice:Re,originalTripleInfantSellingPrice:Le,originalQuadSellingPrice:Be,originalQuadChildSellingPrice:S,originalQuadInfantSellingPrice:i,currencyCode:c.currencyCode,exchangeRate:e,supplierId:c.supplierId||void 0,supplierType:c.supplierType,isCommissionable:c.isCommissionable,details:c.details||void 0};if($.supplierId&&r>0){const fe=Pe?(T||[]).find(Qe=>Qe.programId===(F||void 0)&&Qe.isPurchaseOnly&&Qe.description.includes(`شراء مكون: ${$.name}`)):null;fe?(je(fe.id,{...fe,amount:r,purchasePrice:r,amountInBase:r*e,exchangeRate:e,currencyCode:$.currencyCode,employeeId:$.employeeId||n.employeeId,employeeCommissionRate:parseFloat(n.employeeCommissionRate||"0"),applyCommission:$.isCommissionable!==void 0?$.isCommissionable:n.applyCommission}),V("تم تحديث فاتورة الشراء ومديونية المورد بنجاح لتطابق التعديلات الجديدة","success")):Oe(`هل تريد إثبات فاتورة شراء ومديونية للمورد (${$.name}) بقيمة ${r} ${$.currencyCode} الآن؟`,()=>{G({description:`شراء مكون: ${$.name} - برنامج: ${n.name||"جديد"}`,amount:r,currencyCode:$.currencyCode,exchangeRate:e,type:"EXPENSE",category:$.type==="FLIGHT"?"FLIGHT":$.type==="GUARANTEE_LETTER"?"GUARANTEE_LETTER":$.type==="GIFTS_AND_PRINTS"?"GIFTS_AND_PRINTS":"GENERAL_SERVICE",date:new Date().toISOString().split("T")[0],supplierId:$.supplierId,relatedEntityId:$.supplierId,relatedEntityType:$.supplierType||"SUPPLIER",purchasePrice:r,amountInBase:r*e,sellingPrice:0,programId:F||void 0,isPurchaseOnly:!0,employeeId:$.employeeId||n.employeeId,employeeCommissionRate:parseFloat(n.employeeCommissionRate||"0"),applyCommission:$.isCommissionable!==void 0?$.isCommissionable:n.applyCommission}),V("تم إثبات فاتورة الشراء بنجاح","success")})}b(Pe?fe=>({...fe,components:(fe.components||[]).map(Qe=>Qe.id===Pe?$:Qe)}):fe=>({...fe,components:[...fe.components||[],$]})),ot(!1),It(null),y({...Gt,currencyCode:D.baseCurrency||"EGP"})},Ll=e=>{It(e.id);const l=e.quantity||1;y({type:e.type,name:e.name,pricingMode:e.pricingMode||"PER_PERSON",quantity:l.toString(),purchasePrice:(e.originalPurchasePrice*(1/l)).toString(),sellingPrice:(e.originalSellingPrice*(1/l)).toString(),adultPurchasePrice:(e.adultPurchasePrice?e.adultPurchasePrice/e.exchangeRate*(1/l):e.originalPurchasePrice*(1/l)).toString(),childPurchasePrice:(e.childPurchasePrice?e.childPurchasePrice/e.exchangeRate*(1/l):0).toString(),infantPurchasePrice:(e.infantPurchasePrice?e.infantPurchasePrice/e.exchangeRate*(1/l):0).toString(),singlePurchasePrice:(e.singlePurchasePrice?e.singlePurchasePrice/e.exchangeRate*(1/l):0).toString(),singleChildPurchasePrice:(e.singleChildPurchasePrice?e.singleChildPurchasePrice/e.exchangeRate*(1/l):0).toString(),singleInfantPurchasePrice:(e.singleInfantPurchasePrice?e.singleInfantPurchasePrice/e.exchangeRate*(1/l):0).toString(),doublePurchasePrice:(e.doublePurchasePrice?e.doublePurchasePrice/e.exchangeRate*(1/l):0).toString(),doubleChildPurchasePrice:(e.doubleChildPurchasePrice?e.doubleChildPurchasePrice/e.exchangeRate*(1/l):0).toString(),doubleInfantPurchasePrice:(e.doubleInfantPurchasePrice?e.doubleInfantPurchasePrice/e.exchangeRate*(1/l):0).toString(),triplePurchasePrice:(e.triplePurchasePrice?e.triplePurchasePrice/e.exchangeRate*(1/l):0).toString(),tripleChildPurchasePrice:(e.tripleChildPurchasePrice?e.tripleChildPurchasePrice/e.exchangeRate*(1/l):0).toString(),tripleInfantPurchasePrice:(e.tripleInfantPurchasePrice?e.tripleInfantPurchasePrice/e.exchangeRate*(1/l):0).toString(),quadPurchasePrice:(e.quadPurchasePrice?e.quadPurchasePrice/e.exchangeRate*(1/l):0).toString(),quadChildPurchasePrice:(e.quadChildPurchasePrice?e.quadChildPurchasePrice/e.exchangeRate*(1/l):0).toString(),quadInfantPurchasePrice:(e.quadInfantPurchasePrice?e.quadInfantPurchasePrice/e.exchangeRate*(1/l):0).toString(),adultSellingPrice:(e.adultSellingPrice?e.adultSellingPrice/e.exchangeRate*(1/l):e.originalSellingPrice*(1/l)).toString(),childSellingPrice:(e.childSellingPrice?e.childSellingPrice/e.exchangeRate*(1/l):0).toString(),infantSellingPrice:(e.infantSellingPrice?e.infantSellingPrice/e.exchangeRate*(1/l):0).toString(),singleSellingPrice:(e.singleSellingPrice?e.singleSellingPrice/e.exchangeRate*(1/l):0).toString(),singleChildSellingPrice:(e.singleChildSellingPrice?e.singleChildSellingPrice/e.exchangeRate*(1/l):0).toString(),singleInfantSellingPrice:(e.singleInfantSellingPrice?e.singleInfantSellingPrice/e.exchangeRate*(1/l):0).toString(),doubleSellingPrice:(e.doubleSellingPrice?e.doubleSellingPrice/e.exchangeRate*(1/l):0).toString(),doubleChildSellingPrice:(e.doubleChildSellingPrice?e.doubleChildSellingPrice/e.exchangeRate*(1/l):0).toString(),doubleInfantSellingPrice:(e.doubleInfantSellingPrice?e.doubleInfantSellingPrice/e.exchangeRate*(1/l):0).toString(),tripleSellingPrice:(e.tripleSellingPrice?e.tripleSellingPrice/e.exchangeRate*(1/l):0).toString(),tripleChildSellingPrice:(e.tripleChildSellingPrice?e.tripleChildSellingPrice/e.exchangeRate*(1/l):0).toString(),tripleInfantSellingPrice:(e.tripleInfantSellingPrice?e.tripleInfantSellingPrice/e.exchangeRate*(1/l):0).toString(),quadSellingPrice:(e.quadSellingPrice?e.quadSellingPrice/e.exchangeRate*(1/l):0).toString(),quadChildSellingPrice:(e.quadChildSellingPrice?e.quadChildSellingPrice/e.exchangeRate*(1/l):0).toString(),quadInfantSellingPrice:(e.quadInfantSellingPrice?e.quadInfantSellingPrice/e.exchangeRate*(1/l):0).toString(),currencyCode:e.currencyCode,exchangeRate:e.exchangeRate.toString(),supplierId:e.supplierId||"",supplierType:e.supplierType||"SUPPLIER",isCommissionable:e.isCommissionable!==!1,employeeId:e.employeeId||"",commissionAmount:e.commissionAmount||0,details:e.details||""}),ot(!0),setTimeout(()=>{document.getElementById("component-form-section")?.scrollIntoView({behavior:"smooth",block:"center"})},100)},Yt=e=>{Nt(e.id),Qt(e.originalPurchasePrice.toString()),zt(e.originalSellingPrice.toString())},gt=()=>{if(!We)return;const e=(n.components||[]).find(l=>l.id===We)?.exchangeRate||1;b(l=>({...l,components:(l.components||[]).map(d=>d.id===We?{...d,originalPurchasePrice:parseFloat(Ct||"0"),originalSellingPrice:parseFloat(Et||"0"),purchasePrice:parseFloat(Ct||"0")*e,sellingPrice:d.type==="EXPENSE"?0:parseFloat(Et||"0")*e}:d)})),Nt(null)},Kt=()=>{Nt(null)},et=I.useMemo(()=>T.filter(e=>{if(!e)return!1;if(e.category==="HAJJ_UMRAH")return!0;if(e.programId){const l=(A||[]).find(d=>d.id===e.programId);return l&&(l.type==="INDIVIDUAL_UMRAH"||l.type==="GENERAL"||l.components&&l.components.length>0)}return!1}).filter(e=>{if(!qe)return!0;const l=qe.toLowerCase(),d=(Q||[]).find(g=>g?.id===e?.relatedEntityId),p=(H||[]).find(g=>g?.id===e?.employeeId),r=(H||[]).find(g=>g?.id===e?.accommodationEmployeeId);return(e?.description||"").toLowerCase().includes(l)||(e?.refNo||"").toLowerCase().includes(l)||(d?.name||"").toLowerCase().includes(l)||(p?.name||"").toLowerCase().includes(l)||(r?.name||"").toLowerCase().includes(l)||(e?.accommodation||"").toLowerCase().includes(l)}).sort((e,l)=>(l?.date||"").localeCompare(e?.date||"")),[T,A,qe,Q]),Ul=I.useMemo(()=>{const e=Array.isArray(A)?A:[];if(!qe)return e;const l=qe.toLowerCase();return e.filter(d=>d&&((d.name||"").toLowerCase().includes(l)||((O||[]).find(p=>p?.id===d.supplierId)?.company||"").toLowerCase().includes(l)))},[A,qe,O]),Dl=()=>{Te.length===et.length?ct([]):ct(et.map(e=>e?.id).filter(Boolean))},Fl=e=>{ct(l=>l.includes(e)?l.filter(d=>d!==e):[...l,e])},Gl=()=>{Oe(`هل أنت متأكد من حذف ${Te.length} من الحجوزات المحددة؟`,()=>{Te.forEach(e=>qt(e)),ct([])})},{purchasePrice:kl,sellingPrice:ql}=I.useMemo(()=>{let e=parseFloat(n.purchasePrice||"0"),l=parseFloat(n.sellingPrice||"0");const d=e>0||l>0||parseFloat(n.adultSellingPrice?.toString()||"0")>0||parseFloat(n.singleSellingPrice?.toString()||"0")>0;return n.components&&n.components.length>0&&!d&&(e=n.components.reduce((p,r)=>p+(r.purchasePrice||0),0),l=n.components.reduce((p,r)=>p+(r.sellingPrice||0),0)),{purchasePrice:e,sellingPrice:l}},[n]);return t.jsxs("div",{className:"space-y-8 animate-in fade-in duration-500 pb-12",children:[t.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 no-print",children:[t.jsxs("div",{className:"bg-white p-6 rounded-3xl border border-slate-100 shadow-sm flex items-center gap-4 transition-all duration-300",children:[t.jsx("div",{className:"w-14 h-14 bg-gradient-to-br from-slate-800 to-slate-900 text-white rounded-2xl flex items-center justify-center shadow-md",children:t.jsx(Dt,{size:24})}),t.jsxs("div",{children:[t.jsx("p",{className:"text-[10px] font-bold text-slate-400 uppercase tracking-widest mb-1",children:"إجمالي البرامج"}),t.jsx("p",{className:"text-2xl font-bold text-slate-900 tracking-tight",children:Xe.totalPrograms})]})]}),t.jsxs("div",{className:"bg-white p-6 rounded-3xl border border-slate-100 shadow-sm flex items-center gap-4 transition-all duration-300",children:[t.jsx("div",{className:"w-14 h-14 bg-gradient-to-br from-indigo-500 to-indigo-600 text-white rounded-2xl flex items-center justify-center shadow-md",children:t.jsx(Yl,{size:24})}),t.jsxs("div",{children:[t.jsx("p",{className:"text-[10px] font-bold text-slate-400 uppercase tracking-widest mb-1",children:"إجمالي الحجوزات"}),t.jsx("p",{className:"text-2xl font-bold text-slate-900 tracking-tight",children:Xe.totalBookings})]})]}),t.jsxs("div",{className:"bg-white p-6 rounded-3xl border border-slate-100 shadow-sm flex items-center gap-4 transition-all duration-300",children:[t.jsx("div",{className:"w-14 h-14 bg-slate-900 text-indigo-400 rounded-2xl flex items-center justify-center shadow-md",children:t.jsx(mt,{size:24})}),t.jsxs("div",{children:[t.jsx("p",{className:"text-[10px] font-bold text-slate-400 uppercase tracking-widest mb-1",children:"المبيعات الإجمالية"}),t.jsx("p",{className:"text-2xl font-bold text-slate-900 tracking-tight",children:k?"****":N(Xe.revenue||0)})]})]}),t.jsxs("div",{className:"bg-white p-6 rounded-3xl border border-slate-100 shadow-sm flex items-center gap-4 transition-all duration-300",children:[t.jsx("div",{className:"w-14 h-14 bg-gradient-to-br from-amber-500 to-amber-600 text-white rounded-2xl flex items-center justify-center shadow-md",children:t.jsx(tt,{size:24})}),t.jsxs("div",{children:[t.jsx("p",{className:"text-[10px] font-bold text-slate-400 uppercase tracking-widest mb-1",children:"خطابات الضمان"}),t.jsx("p",{className:"text-2xl font-bold text-amber-600 tracking-tight",children:Xe.openGuarantees-Xe.releasedGuarantees})]})]})]}),t.jsxs("div",{className:"flex flex-col xl:flex-row justify-between items-start xl:items-center bg-white p-8 rounded-3xl shadow-sm border border-slate-200 no-print gap-8 mt-4",children:[t.jsxs("div",{className:"flex items-center gap-6",children:[t.jsx("div",{className:"w-16 h-16 bg-slate-900 text-indigo-400 rounded-2xl flex items-center justify-center shadow-lg",children:t.jsx(ci,{size:32})}),t.jsxs("div",{children:[t.jsx("h2",{className:"text-2xl font-bold text-slate-900 tracking-tight",children:"إدارة الحج والعمرة"}),t.jsx("p",{className:"text-slate-400 font-bold text-sm uppercase tracking-widest",children:"Faith-based Trip Management System"})]})]}),t.jsx("div",{className:"flex flex-wrap bg-slate-50 p-2 rounded-2xl border border-slate-100 shadow-inner gap-1",children:[{id:"BOOKINGS",icon:lt,label:"تسكين العملاء"},{id:"PROGRAMS",icon:Lt,label:"إدارة البرامج"},{id:"GUARANTEES",icon:tt,label:"خطابات الضمان"},{id:"VISA_MANAGEMENT",icon:Ut,label:"متابعة التأشيرات"},{id:"MASTER_TRIPS",icon:nt,label:"الرحلات المجمعة"}].map(e=>t.jsxs("button",{onClick:()=>at(e.id),className:`px-6 py-2.5 rounded-xl font-bold text-xs flex items-center gap-2 transition-all ${ge===e.id?"bg-white text-indigo-600 shadow-md border border-slate-100":"text-slate-400 hover:text-indigo-600"}`,children:[t.jsx(e.icon,{size:16})," ",e.label]},e.id))}),t.jsxs("div",{className:"flex items-center gap-4",children:[ge==="PROGRAMS"&&t.jsxs("button",{onClick:()=>{Ke(null),b({...st,currencyCode:D?.baseCurrency||"EGP"}),Ee(!0)},className:"bg-slate-900 text-white px-8 py-3 rounded-xl font-bold text-sm hover:bg-indigo-600 transition-all shadow-lg flex items-center gap-3 active:scale-95",children:[t.jsx(Se,{size:18})," إضافة برنامج"]}),ge==="BOOKINGS"&&t.jsxs("button",{onClick:()=>{St(null),R(Ft),Ye(!0)},className:"bg-indigo-600 text-white px-8 py-3 rounded-xl font-bold text-sm hover:bg-indigo-700 transition-all shadow-lg flex items-center gap-3 active:scale-95",children:[t.jsx(Se,{size:18})," حجز جديد"]}),ge==="GUARANTEES"&&t.jsxs("button",{onClick:()=>dt(!0),className:"bg-amber-600 text-white px-8 py-3 rounded-xl font-bold text-sm hover:bg-amber-700 transition-all shadow-lg flex items-center gap-3 active:scale-95",children:[t.jsx(Se,{size:18})," خطاب ضمان"]})]})]}),ge==="PROGRAMS"&&t.jsxs("div",{className:"space-y-6",children:[t.jsxs("div",{className:"flex justify-between items-center bg-white p-8 rounded-3xl border border-slate-100 shadow-sm",children:[t.jsxs("div",{className:"flex items-center gap-6",children:[t.jsx("div",{className:"w-16 h-16 bg-indigo-50 text-indigo-600 rounded-2xl flex items-center justify-center",children:t.jsx(Lt,{size:32})}),t.jsxs("div",{children:[t.jsx("h3",{className:"text-2xl font-bold text-slate-900 tracking-tight",children:"تعريف برامج الحج والعمرة"}),t.jsx("p",{className:"text-slate-400 font-bold text-sm uppercase tracking-widest",children:"إدارة برامج المجموعات والحجوزات الفردية"})]})]}),B.role==="ADMIN"&&t.jsxs("button",{onClick:()=>{Ke(null),b({...st,currencyCode:D?.baseCurrency||"EGP"}),Ee(!0)},className:"bg-slate-900 text-white px-8 py-3 rounded-xl font-bold text-sm flex items-center gap-3 shadow-lg hover:bg-indigo-600 transition-all active:scale-95",children:[t.jsx(Se,{size:18})," إضافة برنامج جديد"]})]}),cl&&t.jsxs("div",{className:"bg-white p-10 rounded-3xl border border-slate-200 shadow-xl animate-in fade-in zoom-in duration-300",children:[t.jsxs("div",{className:"mb-10 flex justify-between items-center",children:[t.jsxs("div",{className:"flex items-center gap-5",children:[t.jsx("div",{className:"p-4 rounded-2xl bg-slate-900 text-indigo-400 shadow-lg",children:t.jsx(Se,{size:28})}),t.jsxs("div",{children:[t.jsx("h3",{className:"text-2xl font-bold text-slate-900",children:F?"تعديل بيانات البرنامج":"تسجيل برنامج جديد"}),t.jsx("p",{className:"text-slate-400 font-bold text-xs mt-1 uppercase tracking-widest",children:"إدارة برامج المجموعات والحجوزات الفردية"})]})]}),t.jsx("button",{onClick:()=>Ee(!1),className:"w-10 h-10 flex items-center justify-center rounded-full bg-slate-50 text-slate-400 hover:bg-rose-50 hover:text-rose-600 transition-all",children:t.jsx(ze,{size:20})})]}),t.jsxs("form",{onSubmit:Il,className:"space-y-10",children:[t.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-8",children:[t.jsxs("div",{className:"flex flex-col gap-3",children:[t.jsxs("div",{className:"flex justify-between items-center px-2",children:[t.jsx("label",{className:"text-[11px] font-bold text-slate-500 uppercase tracking-widest",children:"الرحلة المجموعة (الأم)"}),t.jsx("button",{type:"button",onClick:()=>Me(!0),className:"text-[10px] font-bold text-indigo-600 hover:underline",children:"+ رحلة جديدة"})]}),t.jsx(W,{options:(Ce||[]).map(e=>({id:e?.id,name:e?.name,subtext:e?.date})),value:n.masterTripId,onChange:e=>{const l=(Ce||[]).find(d=>d?.id===e);b({...n,masterTripId:e,components:l?.components||n.components||[],date:l?.date||n.date,type:l?.type||n.type})},placeholder:"اختر الرحلة الأم..."})]}),t.jsxs("div",{className:"flex flex-col gap-3",children:[t.jsx("label",{className:"text-[11px] font-bold text-slate-500 uppercase tracking-widest px-2",children:"اسم البرنامج"}),t.jsx("input",{required:!0,className:"w-full p-4 bg-slate-50 border border-slate-200 rounded-xl font-bold text-slate-900 focus:border-indigo-600 outline-none shadow-sm transition-all",placeholder:"مثال: عمرة رجب - الاقتصادي",value:n.name,onChange:e=>b({...n,name:e.target.value})})]}),t.jsxs("div",{className:"flex flex-col gap-3",children:[t.jsx("label",{className:"text-[11px] font-bold text-slate-500 uppercase tracking-widest px-2",children:"نوع الرحلة"}),t.jsxs("div",{className:"flex gap-4 items-center",children:[t.jsxs("select",{className:"flex-1 p-4 bg-slate-50 border border-slate-200 rounded-xl font-bold text-slate-900 focus:border-slate-900 outline-none shadow-sm transition-all h-[52px]",value:n.type,onChange:e=>b({...n,type:e.target.value}),children:[t.jsx("option",{value:"UMRAH",children:"رحلة عمرة"}),t.jsx("option",{value:"INDIVIDUAL_UMRAH",children:"برنامج عمرة فردي"}),t.jsx("option",{value:"HAJJ",children:"رحلة حج"}),t.jsx("option",{value:"GENERAL",children:"رحلة سياحية عامة"})]}),t.jsxs("label",{className:"flex items-center gap-2 cursor-pointer group bg-slate-50 p-2 rounded-xl border border-slate-200 h-[52px] px-4",children:[t.jsx("input",{type:"checkbox",className:"hidden",checked:n.isAgent,onChange:e=>b({...n,isAgent:e.target.checked})}),t.jsx("div",{className:`w-10 h-5 rounded-full transition-all relative ${n.isAgent?"bg-indigo-600":"bg-slate-300"}`,children:t.jsx("div",{className:`absolute top-0.5 w-4 h-4 rounded-full bg-white shadow-sm transition-all ${n.isAgent?"left-5.5":"left-0.5"}`,style:{left:n.isAgent?"22px":"2px"}})}),t.jsx("span",{className:"text-[10px] font-black text-slate-600 group-hover:text-indigo-600 whitespace-nowrap",children:"برنامج وكلاء"})]})]})]}),t.jsxs("div",{className:"flex flex-col gap-3",children:[t.jsxs("div",{className:"flex justify-between items-center px-2",children:[t.jsx("label",{className:"text-[11px] font-bold text-slate-500 uppercase tracking-widest",children:"العميل (المستفيد)"}),t.jsx("div",{className:"flex bg-slate-100 p-1 rounded-lg gap-1",children:t.jsx("button",{type:"button",onClick:()=>b({...n,customerId:""}),className:"px-2 py-0.5 rounded text-[8px] font-bold text-rose-500 hover:bg-white transition-all",children:"مسح"})})]}),t.jsx(W,{options:(Q||[]).map(e=>({id:e?.id,name:e?.name,subtext:e?.phone})),value:n.customerId,onChange:e=>b({...n,customerId:e}),placeholder:"اختر العميل المستلم..."})]}),t.jsxs("div",{className:"flex flex-col gap-3 md:col-span-2",children:[t.jsx("label",{className:"text-[11px] font-bold text-slate-500 uppercase tracking-widest px-2",children:"توزيع الغرف والعدد (كشف التسكين)"}),t.jsx("div",{className:"bg-white rounded-2xl border border-slate-200 overflow-hidden",children:t.jsxs("table",{className:"w-full text-center text-[10px]",children:[t.jsx("thead",{className:"bg-slate-50 border-b border-slate-200",children:t.jsxs("tr",{children:[t.jsx("th",{className:"p-2 font-bold text-slate-500",children:"نوع الغرفة"}),t.jsx("th",{className:"p-2 font-bold text-slate-500",children:"بالغ"}),t.jsx("th",{className:"p-2 font-bold text-slate-500",children:"طفل"}),t.jsx("th",{className:"p-2 font-bold text-slate-500",children:"رضيع"})]})}),t.jsxs("tbody",{className:"divide-y divide-slate-100",children:[[{id:"single",label:"فردي"},{id:"double",label:"ثنائي"},{id:"triple",label:"ثلاثي"},{id:"quad",label:"رباعي"}].map(e=>t.jsxs("tr",{className:"hover:bg-slate-50 transition-colors",children:[t.jsx("td",{className:"p-2 font-bold text-slate-700",children:e.label}),t.jsx("td",{className:"p-1",children:t.jsx("input",{type:"number",className:"w-12 p-1 text-center bg-slate-50 border border-slate-100 rounded focus:border-indigo-500 outline-none font-bold",value:n[`${e.id}AdultCount`],onChange:l=>b({...n,[`${e.id}AdultCount`]:l.target.value})})}),t.jsx("td",{className:"p-1",children:t.jsx("input",{type:"number",className:"w-12 p-1 text-center bg-slate-50 border border-slate-100 rounded focus:border-indigo-500 outline-none font-bold",value:n[`${e.id}ChildCount`],onChange:l=>b({...n,[`${e.id}ChildCount`]:l.target.value})})}),t.jsx("td",{className:"p-1",children:t.jsx("input",{type:"number",className:"w-12 p-1 text-center bg-slate-50 border border-slate-100 rounded focus:border-indigo-500 outline-none font-bold",value:n[`${e.id}InfantCount`],onChange:l=>b({...n,[`${e.id}InfantCount`]:l.target.value})})})]},e.id)),t.jsxs("tr",{className:"bg-slate-50 font-black text-slate-900 border-t border-slate-200",children:[t.jsx("td",{className:"p-2",children:"أخرى (عام)"}),t.jsx("td",{className:"p-1",children:t.jsx("input",{type:"number",className:"w-12 p-1 text-center bg-white border border-slate-200 rounded outline-none font-bold",value:n.adultCount,onChange:e=>b({...n,adultCount:e.target.value})})}),t.jsx("td",{className:"p-1",children:t.jsx("input",{type:"number",className:"w-12 p-1 text-center bg-white border border-slate-200 rounded outline-none font-bold",value:n.childCount,onChange:e=>b({...n,childCount:e.target.value})})}),t.jsx("td",{className:"p-1",children:t.jsx("input",{type:"number",className:"w-12 p-1 text-center bg-white border border-slate-200 rounded outline-none font-bold",value:n.infantCount,onChange:e=>b({...n,infantCount:e.target.value})})})]})]})]})})]}),t.jsxs("div",{className:"flex flex-col gap-3 md:col-span-2",children:[t.jsxs("div",{className:"flex justify-between items-center px-2",children:[t.jsx("label",{className:"text-[11px] font-bold text-slate-500 uppercase tracking-widest",children:"جهة الشراء"}),t.jsxs("div",{className:"flex bg-slate-100 p-1 rounded-lg gap-1",children:[t.jsx("button",{type:"button",onClick:()=>b({...n,supplierType:"SUPPLIER",supplierId:""}),className:`px-2 py-0.5 rounded text-[8px] font-bold transition-all ${n.supplierType==="SUPPLIER"?"bg-white shadow-sm text-indigo-600":"text-slate-400"}`,children:"مورد"}),t.jsx("button",{type:"button",onClick:()=>b({...n,supplierType:"CUSTOMER",supplierId:""}),className:`px-2 py-0.5 rounded text-[8px] font-bold transition-all ${n.supplierType==="CUSTOMER"?"bg-white shadow-sm text-indigo-600":"text-slate-400"}`,children:"عميل"}),t.jsx("button",{type:"button",onClick:()=>b({...n,supplierType:"TREASURY",supplierId:""}),className:`px-2 py-0.5 rounded text-[8px] font-bold transition-all ${n.supplierType==="TREASURY"?"bg-white shadow-sm text-indigo-600":"text-slate-400"}`,children:"خزينة"})]})]}),t.jsx(W,{options:n.supplierType==="SUPPLIER"?(O||[]).map(e=>{const l=_e[e.id],d=l?` (متبقي: ${l.total-l.used})`:"";return{id:e.id,name:e.company+(e.isSaudiWallet?" 🇸🇦":"")+d,subtext:`الرصيد: ${se?"****":N(ft.suppliers[e.id]||0)}`}}):n.supplierType==="CUSTOMER"?(Q||[]).map(e=>({id:e.id,name:e.name,subtext:`الرصيد: ${se?"****":N(ft.customers[e.id]||0)}`})):(bt||[]).map(e=>({id:e.id,name:e.name,subtext:`الرصيد: ${se?"****":N(e.balance)}`})),value:n.supplierId,onChange:e=>b({...n,supplierId:e}),disabled:n.type==="INDIVIDUAL_UMRAH",placeholder:`اختر ${n.supplierType==="SUPPLIER"?"المورد":n.supplierType==="CUSTOMER"?"العميل":"الخزينة"}`})]}),t.jsxs("div",{className:"flex flex-col gap-3",children:[t.jsxs("div",{className:"flex justify-between items-center px-2",children:[t.jsx("label",{className:"text-[11px] font-bold text-indigo-600 uppercase tracking-widest",children:"عمولة الموظف المسؤول"}),t.jsxs("label",{className:"flex items-center gap-2 cursor-pointer",children:[t.jsx("input",{type:"checkbox",className:"hidden",checked:n.applyCommission,onChange:e=>b({...n,applyCommission:e.target.checked})}),t.jsx("div",{className:`w-8 h-4 rounded-full transition-all relative ${n.applyCommission?"bg-indigo-500":"bg-slate-300"}`,children:t.jsx("div",{className:`absolute top-0.5 w-3 h-3 rounded-full bg-white transition-all ${n.applyCommission?"left-4.5":"left-0.5"}`,style:{left:n.applyCommission?"18px":"2px"}})}),t.jsx("span",{className:"text-[9px] font-bold text-slate-500",children:"تفعيل"})]})]}),t.jsxs("div",{className:"flex gap-2",children:[t.jsx("div",{className:"flex-1",children:t.jsx(W,{options:(H||[]).map(e=>({id:e.id,name:e.name,subtext:e.position})),value:n.employeeId,onChange:e=>{const l=(H||[]).find(d=>d.id===e);b({...n,employeeId:e,employeeCommissionRate:l?l.commissionRate.toString():n.employeeCommissionRate})},placeholder:"اختر الموظف..."})}),t.jsx("div",{className:"w-24",children:t.jsx("input",{type:"number",className:"w-full p-4 bg-slate-50 border border-slate-200 rounded-xl font-bold text-slate-900 focus:border-indigo-600 outline-none shadow-sm transition-all h-[52px] text-center",placeholder:"النسبة %",value:n.employeeCommissionRate,onChange:e=>b({...n,employeeCommissionRate:e.target.value})})})]})]}),t.jsxs("div",{className:"space-y-4 md:col-span-3 bg-slate-50 p-6 rounded-3xl border-2 border-slate-100",children:[t.jsxs("div",{className:"flex justify-between items-center mb-4",children:[t.jsxs("h4",{className:"font-bold text-slate-900 flex items-center gap-2",children:[t.jsx(mt,{size:20,className:"text-indigo-600"})," تفاصيل الأسعار للفرد"]}),t.jsx("div",{className:"flex bg-slate-200 p-1 rounded-2xl gap-1",children:[{id:"SINGLE",label:"فردي"},{id:"DOUBLE",label:"ثنائي"},{id:"TRIPLE",label:"ثلاثي"},{id:"QUAD",label:"رباعي"}].map(e=>t.jsx("button",{type:"button",onClick:()=>dl(e.id),className:`px-4 py-2 rounded-xl font-bold text-xs transition-all ${K===e.id?"bg-white text-slate-900 shadow-sm":"text-slate-500 hover:text-slate-900"}`,children:e.label},e.id))})]}),t.jsx("div",{className:"overflow-x-auto",children:t.jsxs("table",{className:"w-full border-separate border-spacing-0 bg-white rounded-2xl overflow-hidden shadow-sm border border-slate-100",children:[t.jsx("thead",{children:t.jsxs("tr",{className:"bg-slate-50 border-b border-slate-100",children:[t.jsx("th",{className:"p-4 text-center border-l border-slate-100 font-bold text-slate-500 text-[10px] uppercase tracking-wider",children:"النوع"}),t.jsx("th",{className:"p-4 text-center border-l border-slate-100 font-bold text-slate-500 text-[10px] uppercase tracking-wider",children:"بالغ"}),t.jsx("th",{className:"p-4 text-center border-l border-slate-100 font-bold text-slate-500 text-[10px] uppercase tracking-wider",children:"طفل"}),t.jsx("th",{className:"p-4 text-center border-l border-slate-100 font-bold text-slate-500 text-[10px] uppercase tracking-wider",children:"رضيع"})]})}),t.jsxs("tbody",{className:"divide-y divide-slate-50",children:[t.jsxs("tr",{children:[t.jsx("td",{className:"p-4 font-bold text-rose-600 bg-rose-50 bg-opacity-30 border-l border-slate-100 text-center text-[11px] uppercase tracking-wide whitespace-nowrap",children:"سعر الشراء"}),K==="SINGLE"&&t.jsxs(t.Fragment,{children:[t.jsx("td",{className:"p-2 border-l border-slate-50",children:t.jsx("input",{type:"number",disabled:n.type==="INDIVIDUAL_UMRAH"||n.type==="GENERAL",className:"w-full p-3 bg-slate-50 bg-opacity-50 rounded-lg font-bold text-sm text-center text-rose-600 outline-none focus:ring-1 focus:ring-rose-500 transition-all",value:n.singlePurchasePrice,onChange:e=>b({...n,singlePurchasePrice:e.target.value})})}),t.jsx("td",{className:"p-2 border-l border-slate-50",children:t.jsx("input",{type:"number",disabled:n.type==="INDIVIDUAL_UMRAH"||n.type==="GENERAL",className:"w-full p-3 bg-slate-50 bg-opacity-50 rounded-lg font-bold text-sm text-center text-rose-600 outline-none focus:ring-1 focus:ring-rose-500 transition-all",value:n.singleChildPurchasePrice,onChange:e=>b({...n,singleChildPurchasePrice:e.target.value})})}),t.jsx("td",{className:"p-2 border-l border-slate-50",children:t.jsx("input",{type:"number",disabled:n.type==="INDIVIDUAL_UMRAH"||n.type==="GENERAL",className:"w-full p-3 bg-slate-50 bg-opacity-50 rounded-lg font-bold text-sm text-center text-rose-600 outline-none focus:ring-1 focus:ring-rose-500 transition-all",value:n.singleInfantPurchasePrice,onChange:e=>b({...n,singleInfantPurchasePrice:e.target.value})})})]}),K==="DOUBLE"&&t.jsxs(t.Fragment,{children:[t.jsx("td",{className:"p-2 border-l border-slate-50",children:t.jsx("input",{type:"number",disabled:n.type==="INDIVIDUAL_UMRAH"||n.type==="GENERAL",className:"w-full p-3 bg-slate-50 bg-opacity-50 rounded-lg font-bold text-sm text-center text-rose-600 outline-none focus:ring-1 focus:ring-rose-500 transition-all",value:n.doublePurchasePrice,onChange:e=>b({...n,doublePurchasePrice:e.target.value})})}),t.jsx("td",{className:"p-2 border-l border-slate-50",children:t.jsx("input",{type:"number",disabled:n.type==="INDIVIDUAL_UMRAH"||n.type==="GENERAL",className:"w-full p-3 bg-slate-50 bg-opacity-50 rounded-lg font-bold text-sm text-center text-rose-600 outline-none focus:ring-1 focus:ring-rose-500 transition-all",value:n.doubleChildPurchasePrice,onChange:e=>b({...n,doubleChildPurchasePrice:e.target.value})})}),t.jsx("td",{className:"p-2 border-l border-slate-50",children:t.jsx("input",{type:"number",disabled:n.type==="INDIVIDUAL_UMRAH"||n.type==="GENERAL",className:"w-full p-3 bg-slate-50 bg-opacity-50 rounded-lg font-bold text-sm text-center text-rose-600 outline-none focus:ring-1 focus:ring-rose-500 transition-all",value:n.doubleInfantPurchasePrice,onChange:e=>b({...n,doubleInfantPurchasePrice:e.target.value})})})]}),K==="TRIPLE"&&t.jsxs(t.Fragment,{children:[t.jsx("td",{className:"p-2 border-l border-slate-50",children:t.jsx("input",{type:"number",disabled:n.type==="INDIVIDUAL_UMRAH"||n.type==="GENERAL",className:"w-full p-3 bg-slate-50 bg-opacity-50 rounded-lg font-bold text-sm text-center text-rose-600 outline-none focus:ring-1 focus:ring-rose-500 transition-all",value:n.triplePurchasePrice,onChange:e=>b({...n,triplePurchasePrice:e.target.value})})}),t.jsx("td",{className:"p-2 border-l border-slate-50",children:t.jsx("input",{type:"number",disabled:n.type==="INDIVIDUAL_UMRAH"||n.type==="GENERAL",className:"w-full p-3 bg-slate-50 bg-opacity-50 rounded-lg font-bold text-sm text-center text-rose-600 outline-none focus:ring-1 focus:ring-rose-500 transition-all",value:n.tripleChildPurchasePrice,onChange:e=>b({...n,tripleChildPurchasePrice:e.target.value})})}),t.jsx("td",{className:"p-2 border-l border-slate-50",children:t.jsx("input",{type:"number",disabled:n.type==="INDIVIDUAL_UMRAH"||n.type==="GENERAL",className:"w-full p-3 bg-slate-50 bg-opacity-50 rounded-lg font-bold text-sm text-center text-rose-600 outline-none focus:ring-1 focus:ring-rose-500 transition-all",value:n.tripleInfantPurchasePrice,onChange:e=>b({...n,tripleInfantPurchasePrice:e.target.value})})})]}),K==="QUAD"&&t.jsxs(t.Fragment,{children:[t.jsx("td",{className:"p-2 border-l border-slate-50",children:t.jsx("input",{type:"number",disabled:n.type==="INDIVIDUAL_UMRAH"||n.type==="GENERAL",className:"w-full p-3 bg-slate-50 bg-opacity-50 rounded-lg font-bold text-sm text-center text-rose-600 outline-none focus:ring-1 focus:ring-rose-500 transition-all",value:n.quadPurchasePrice,onChange:e=>b({...n,quadPurchasePrice:e.target.value})})}),t.jsx("td",{className:"p-2 border-l border-slate-50",children:t.jsx("input",{type:"number",disabled:n.type==="INDIVIDUAL_UMRAH"||n.type==="GENERAL",className:"w-full p-3 bg-slate-50 bg-opacity-50 rounded-lg font-bold text-sm text-center text-rose-600 outline-none focus:ring-1 focus:ring-rose-500 transition-all",value:n.quadChildPurchasePrice,onChange:e=>b({...n,quadChildPurchasePrice:e.target.value})})}),t.jsx("td",{className:"p-2 border-l border-slate-50",children:t.jsx("input",{type:"number",disabled:n.type==="INDIVIDUAL_UMRAH"||n.type==="GENERAL",className:"w-full p-3 bg-slate-50 bg-opacity-50 rounded-lg font-bold text-sm text-center text-rose-600 outline-none focus:ring-1 focus:ring-rose-500 transition-all",value:n.quadInfantPurchasePrice,onChange:e=>b({...n,quadInfantPurchasePrice:e.target.value})})})]})]}),t.jsxs("tr",{children:[t.jsx("td",{className:"p-4 font-bold text-emerald-600 bg-emerald-50 bg-opacity-30 border-l border-slate-100 text-center text-[11px] uppercase tracking-wide whitespace-nowrap",children:"سعر البيع"}),K==="SINGLE"&&t.jsxs(t.Fragment,{children:[t.jsx("td",{className:"p-2 border-l border-slate-50",children:t.jsx("input",{type:"number",disabled:n.type==="INDIVIDUAL_UMRAH"||n.type==="GENERAL",className:"w-full p-3 bg-slate-50 bg-opacity-50 rounded-lg font-bold text-sm text-center text-emerald-600 outline-none focus:ring-1 focus:ring-indigo-500 transition-all",value:n.singleSellingPrice,onChange:e=>b({...n,singleSellingPrice:e.target.value})})}),t.jsx("td",{className:"p-2 border-l border-slate-50",children:t.jsx("input",{type:"number",disabled:n.type==="INDIVIDUAL_UMRAH"||n.type==="GENERAL",className:"w-full p-3 bg-slate-50 bg-opacity-50 rounded-lg font-bold text-sm text-center text-emerald-600 outline-none focus:ring-1 focus:ring-indigo-500 transition-all",value:n.singleChildSellingPrice,onChange:e=>b({...n,singleChildSellingPrice:e.target.value})})}),t.jsx("td",{className:"p-2 border-l border-slate-50",children:t.jsx("input",{type:"number",disabled:n.type==="INDIVIDUAL_UMRAH"||n.type==="GENERAL",className:"w-full p-3 bg-slate-50 bg-opacity-50 rounded-lg font-bold text-sm text-center text-emerald-600 outline-none focus:ring-1 focus:ring-indigo-500 transition-all",value:n.singleInfantSellingPrice,onChange:e=>b({...n,singleInfantSellingPrice:e.target.value})})})]}),K==="DOUBLE"&&t.jsxs(t.Fragment,{children:[t.jsx("td",{className:"p-2 border-l border-slate-50",children:t.jsx("input",{type:"number",disabled:n.type==="INDIVIDUAL_UMRAH"||n.type==="GENERAL",className:"w-full p-3 bg-slate-50 bg-opacity-50 rounded-lg font-bold text-sm text-center text-emerald-600 outline-none focus:ring-1 focus:ring-indigo-500 transition-all",value:n.doubleSellingPrice,onChange:e=>b({...n,doubleSellingPrice:e.target.value})})}),t.jsx("td",{className:"p-2 border-l border-slate-50",children:t.jsx("input",{type:"number",disabled:n.type==="INDIVIDUAL_UMRAH"||n.type==="GENERAL",className:"w-full p-3 bg-slate-50 bg-opacity-50 rounded-lg font-bold text-sm text-center text-emerald-600 outline-none focus:ring-1 focus:ring-indigo-500 transition-all",value:n.doubleChildSellingPrice,onChange:e=>b({...n,doubleChildSellingPrice:e.target.value})})}),t.jsx("td",{className:"p-2 border-l border-slate-50",children:t.jsx("input",{type:"number",disabled:n.type==="INDIVIDUAL_UMRAH"||n.type==="GENERAL",className:"w-full p-3 bg-slate-50 bg-opacity-50 rounded-lg font-bold text-sm text-center text-emerald-600 outline-none focus:ring-1 focus:ring-indigo-500 transition-all",value:n.doubleInfantSellingPrice,onChange:e=>b({...n,doubleInfantSellingPrice:e.target.value})})})]}),K==="TRIPLE"&&t.jsxs(t.Fragment,{children:[t.jsx("td",{className:"p-2 border-l border-slate-50",children:t.jsx("input",{type:"number",disabled:n.type==="INDIVIDUAL_UMRAH"||n.type==="GENERAL",className:"w-full p-3 bg-slate-50 bg-opacity-50 rounded-lg font-bold text-sm text-center text-emerald-600 outline-none focus:ring-1 focus:ring-indigo-500 transition-all",value:n.tripleSellingPrice,onChange:e=>b({...n,tripleSellingPrice:e.target.value})})}),t.jsx("td",{className:"p-2 border-l border-slate-50",children:t.jsx("input",{type:"number",disabled:n.type==="INDIVIDUAL_UMRAH"||n.type==="GENERAL",className:"w-full p-3 bg-slate-50 bg-opacity-50 rounded-lg font-bold text-sm text-center text-emerald-600 outline-none focus:ring-1 focus:ring-indigo-500 transition-all",value:n.tripleChildSellingPrice,onChange:e=>b({...n,tripleChildSellingPrice:e.target.value})})}),t.jsx("td",{className:"p-2 border-l border-slate-50",children:t.jsx("input",{type:"number",disabled:n.type==="INDIVIDUAL_UMRAH"||n.type==="GENERAL",className:"w-full p-3 bg-slate-50 bg-opacity-50 rounded-lg font-bold text-sm text-center text-emerald-600 outline-none focus:ring-1 focus:ring-indigo-500 transition-all",value:n.tripleInfantSellingPrice,onChange:e=>b({...n,tripleInfantSellingPrice:e.target.value})})})]}),K==="QUAD"&&t.jsxs(t.Fragment,{children:[t.jsx("td",{className:"p-2 border-l border-slate-50",children:t.jsx("input",{type:"number",disabled:n.type==="INDIVIDUAL_UMRAH"||n.type==="GENERAL",className:"w-full p-3 bg-slate-50 bg-opacity-50 rounded-lg font-bold text-sm text-center text-emerald-600 outline-none focus:ring-1 focus:ring-indigo-500 transition-all",value:n.quadSellingPrice,onChange:e=>b({...n,quadSellingPrice:e.target.value})})}),t.jsx("td",{className:"p-2 border-l border-slate-50",children:t.jsx("input",{type:"number",disabled:n.type==="INDIVIDUAL_UMRAH"||n.type==="GENERAL",className:"w-full p-3 bg-slate-50 bg-opacity-50 rounded-lg font-bold text-sm text-center text-emerald-600 outline-none focus:ring-1 focus:ring-indigo-500 transition-all",value:n.quadChildSellingPrice,onChange:e=>b({...n,quadChildSellingPrice:e.target.value})})}),t.jsx("td",{className:"p-2 border-l border-slate-50",children:t.jsx("input",{type:"number",disabled:n.type==="INDIVIDUAL_UMRAH"||n.type==="GENERAL",className:"w-full p-3 bg-slate-50 bg-opacity-50 rounded-lg font-bold text-sm text-center text-emerald-600 outline-none focus:ring-1 focus:ring-indigo-500 transition-all",value:n.quadInfantSellingPrice,onChange:e=>b({...n,quadInfantSellingPrice:e.target.value})})})]})]}),t.jsxs("tr",{children:[t.jsx("td",{className:"p-4 font-bold text-indigo-600 bg-indigo-50 bg-opacity-30 border-l border-slate-100 text-center text-[11px] uppercase tracking-wide whitespace-nowrap",children:"سعر المندوب (الصافي)"}),K==="SINGLE"&&t.jsxs(t.Fragment,{children:[t.jsx("td",{className:"p-2 border-l border-slate-50",children:t.jsx("input",{type:"number",className:"w-full p-3 bg-slate-50 bg-opacity-50 rounded-lg font-bold text-sm text-center text-indigo-600 outline-none focus:ring-1 focus:ring-indigo-500 transition-all",value:n.adultAgentPrice,onChange:e=>b({...n,adultAgentPrice:e.target.value})})}),t.jsx("td",{className:"p-2 border-l border-slate-50",children:t.jsx("input",{type:"number",className:"w-full p-3 bg-slate-50 bg-opacity-50 rounded-lg font-bold text-sm text-center text-indigo-600 outline-none focus:ring-1 focus:ring-indigo-500 transition-all",value:n.childAgentPrice,onChange:e=>b({...n,childAgentPrice:e.target.value})})}),t.jsx("td",{className:"p-2 border-l border-slate-50",children:t.jsx("input",{type:"number",className:"w-full p-3 bg-slate-50 bg-opacity-50 rounded-lg font-bold text-sm text-center text-indigo-600 outline-none focus:ring-1 focus:ring-indigo-500 transition-all",value:n.infantAgentPrice,onChange:e=>b({...n,infantAgentPrice:e.target.value})})})]}),K==="DOUBLE"&&t.jsxs(t.Fragment,{children:[t.jsx("td",{className:"p-2 border-l border-slate-50",children:t.jsx("input",{type:"number",className:"w-full p-3 bg-slate-50 bg-opacity-50 rounded-lg font-bold text-sm text-center text-indigo-600 outline-none focus:ring-1 focus:ring-indigo-500 transition-all",value:n.doubleAgentPrice,onChange:e=>b({...n,doubleAgentPrice:e.target.value})})}),t.jsx("td",{colSpan:2,className:"p-2 border-l border-slate-50 text-[10px] text-slate-400 text-center font-bold italic",children:"نفس أسعار الطفل والرضيع في الفئة الفردية"})]}),K==="TRIPLE"&&t.jsxs(t.Fragment,{children:[t.jsx("td",{className:"p-2 border-l border-slate-50",children:t.jsx("input",{type:"number",className:"w-full p-3 bg-slate-50 bg-opacity-50 rounded-lg font-bold text-sm text-center text-indigo-600 outline-none focus:ring-1 focus:ring-indigo-500 transition-all",value:n.tripleAgentPrice,onChange:e=>b({...n,tripleAgentPrice:e.target.value})})}),t.jsx("td",{colSpan:2,className:"p-2 border-l border-slate-50 text-[10px] text-slate-400 text-center font-bold italic",children:"نفس أسعار الطفل والرضيع في الفئة الفردية"})]}),K==="QUAD"&&t.jsxs(t.Fragment,{children:[t.jsx("td",{className:"p-2 border-l border-slate-50",children:t.jsx("input",{type:"number",className:"w-full p-3 bg-slate-50 bg-opacity-50 rounded-lg font-bold text-sm text-center text-indigo-600 outline-none focus:ring-1 focus:ring-indigo-500 transition-all",value:n.quadAgentPrice,onChange:e=>b({...n,quadAgentPrice:e.target.value})})}),t.jsx("td",{colSpan:2,className:"p-2 border-l border-slate-50 text-[10px] text-slate-400 text-center font-bold italic",children:"نفس أسعار الطفل والرضيع في الفئة الفردية"})]})]})]})]})})]}),t.jsxs("div",{className:"flex flex-col gap-3",children:[t.jsx("label",{className:"text-[11px] font-bold text-slate-500 uppercase tracking-widest px-2",children:"العملة"}),t.jsx("select",{className:"w-full p-4 bg-slate-50 border border-slate-200 rounded-xl font-bold text-slate-900 focus:border-indigo-600 outline-none shadow-sm transition-all h-[52px]",value:n.currencyCode,onChange:e=>{const l=(ke||[]).find(d=>d&&d.code===e.target.value);b({...n,currencyCode:e.target.value,exchangeRate:l?.rateToMain?.toString()||"1"})},children:(ke||[]).map(e=>t.jsxs("option",{value:e?.code,children:[e?.name," (",e?.code,")"]},e?.code))})]}),t.jsxs("div",{className:"flex flex-col gap-3",children:[t.jsxs("label",{className:"text-[11px] font-bold text-slate-500 uppercase tracking-widest px-2",children:["سعر الصرف (",D?.baseCurrency||"EGP",")"]}),t.jsx("input",{type:"number",step:"0.0001",className:`w-full p-4 border border-slate-200 rounded-xl font-bold text-slate-900 outline-none shadow-sm transition-all h-[52px] ${n.currencyCode===(D?.baseCurrency||"EGP")?"bg-slate-100":"bg-slate-50 focus:border-indigo-600"}`,value:n.currencyCode===(D?.baseCurrency||"EGP")?"1":n.exchangeRate,onChange:e=>b({...n,exchangeRate:e.target.value}),disabled:n.currencyCode===(D?.baseCurrency||"EGP")})]}),t.jsxs("div",{className:"space-y-2",children:[t.jsx("label",{className:"text-[10px] font-bold text-slate-400 uppercase",children:"تاريخ الانطلاق"}),t.jsx("input",{type:"date",className:"w-full p-5 bg-slate-50 border-2 rounded-2xl font-bold",value:n.date,onChange:e=>b({...n,date:e.target.value})})]})]}),(n.type==="HAJJ"||n.type==="UMRAH"||n.type==="INDIVIDUAL_UMRAH"||n.type==="GENERAL"||n.components.length>0||F)&&t.jsxs("div",{className:"space-y-6 pt-8 border-t border-slate-200",children:[t.jsxs("div",{className:"flex justify-between items-center",children:[t.jsxs("h4",{className:"text-xl font-bold text-slate-900 flex items-center gap-2",children:[t.jsx(Lt,{size:20,className:"text-indigo-600"})," مكونات البرنامج وتفاصيل التسعير"]}),t.jsxs("div",{className:"flex gap-4",children:[t.jsxs("div",{className:"bg-rose-50 px-4 py-2 rounded-xl border border-rose-100",children:[t.jsx("p",{className:"text-[9px] font-bold text-rose-400 uppercase",children:"إجمالي تكلفة المكونات"}),t.jsx("p",{className:"text-sm font-bold text-rose-600",children:N(kl)})]}),t.jsxs("div",{className:"bg-emerald-50 px-4 py-2 rounded-xl border border-emerald-100",children:[t.jsx("p",{className:"text-[9px] font-bold text-emerald-400 uppercase",children:"إجمالي بيع المكونات"}),t.jsx("p",{className:"text-sm font-bold text-emerald-600",children:N(ql)})]})]})]}),(n.components||[]).length>0&&t.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:(n.components||[]).map(e=>t.jsxs("div",{className:"bg-white p-6 rounded-2xl border border-slate-100 shadow-sm hover:border-indigo-200 transition-all group",children:[t.jsxs("div",{className:"flex justify-between items-start mb-4",children:[t.jsxs("div",{className:"flex-1",children:[t.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[t.jsx("p",{className:"font-bold text-slate-900 text-lg",children:e.name}),e.quantity&&e.quantity>1&&t.jsxs("span",{className:"text-[10px] font-bold px-2 py-0.5 rounded-md bg-indigo-100 text-indigo-700",children:["العدد: ",e.quantity]}),t.jsx("span",{className:`text-[8px] font-bold px-2 py-0.5 rounded-md ${e.pricingMode==="TOTAL"?"bg-amber-100 text-amber-700":"bg-blue-100 text-blue-700"}`,children:e.pricingMode==="TOTAL"?"إجمالي":"فردي"}),e.isCommissionable!==!1&&t.jsx("span",{className:"text-[8px] font-bold px-2 py-0.5 rounded-md bg-indigo-100 text-indigo-700",title:"خاضع لعمولة الموظف",children:"% عمولة"})]}),t.jsx("p",{className:"text-sm text-slate-600 font-bold",children:e.type==="FLIGHT"?"تذكرة طيران":e.type==="VISA"?"تأشيرة":e.type==="HOTEL"?"فندق":e.type==="INTERNAL_TRANSPORT"?"نقل داخلي":e.type==="SAUDI_TRANSPORT"?"نقل سعودي":e.type==="GUARANTEE_LETTER"?"خطاب ضمان":e.type==="GIFTS_AND_PRINTS"?"هدايا ومطبوعات":"مصروفات"}),e.details&&t.jsx("p",{className:"text-xs text-slate-500 mt-1",children:e.details}),e.supplierId&&t.jsxs("p",{className:"text-xs text-slate-500",children:["المورد: ",(O||[]).find(l=>l.id===e.supplierId)?.company]})]}),t.jsxs("div",{className:"flex flex-wrap gap-2 ml-4",children:[t.jsxs("button",{type:"button",onClick:()=>Ll(e),className:"flex items-center gap-2 px-4 py-2 bg-indigo-50 text-indigo-600 rounded-xl hover:bg-indigo-600 hover:text-white transition-all font-bold text-xs shadow-sm border border-indigo-100",children:[t.jsx(xt,{size:14})," تعديل البيانات"]}),F&&(e.isPosted||e.supplierId)&&t.jsxs(t.Fragment,{children:[t.jsxs("button",{type:"button",onClick:()=>Jt(F,e.id),className:"flex items-center gap-2 px-4 py-2 bg-amber-50 text-amber-600 rounded-xl hover:bg-amber-600 hover:text-white transition-all font-bold text-xs shadow-sm border border-amber-100",title:"عمل ارتداد (مرتجع) لعدد معين من الوحدات",children:[t.jsx(it,{size:14})," ارتداد"]}),t.jsxs("button",{type:"button",onClick:()=>Nl(F,e.id),className:"flex items-center gap-2 px-4 py-2 bg-rose-50 text-rose-600 rounded-xl hover:bg-rose-600 hover:text-white transition-all font-bold text-xs shadow-sm border border-rose-100",children:[t.jsx(Pt,{size:14})," إلغاء مالي (حذف)"]})]}),!e.isPosted&&t.jsxs("button",{type:"button",onClick:()=>{confirm("هل أنت متأكد من حذف هذا المكون من النموذج؟")&&b(l=>({...l,components:(l.components||[]).filter(d=>d.id!==e.id)}))},className:"flex items-center gap-2 px-4 py-2 bg-slate-50 text-slate-500 rounded-xl hover:bg-slate-600 hover:text-white transition-all font-bold text-xs shadow-sm border border-slate-200",children:[t.jsx(Pt,{size:14})," حذف المكون"]})]})]}),t.jsx("div",{className:"mt-4 pt-4 border-t border-slate-200",children:e.pricingMode==="TOTAL"?t.jsxs("div",{className:"flex justify-between text-sm font-bold",children:[t.jsxs("span",{className:"text-rose-600",children:["شراء:",We===e.id?t.jsx("input",{type:"number",step:"0.01",value:k?"****":Ct,onChange:l=>Qt(l.target.value),onBlur:gt,onKeyDown:l=>l.key==="Enter"?gt():l.key==="Escape"?Kt():null,className:"w-20 mx-2 px-2 py-1 text-xs bg-rose-50 border border-rose-200 rounded",autoFocus:!0}):t.jsx("span",{onClick:()=>!k&&Yt(e),className:"cursor-pointer hover:bg-rose-50 px-1 rounded",children:k?"****":N((e.originalPurchasePrice||0)*(e.exchangeRate||1))})]}),t.jsxs("span",{className:"text-emerald-600",children:["بيع:",We===e.id?t.jsx("input",{type:"number",step:"0.01",value:k?"****":Et,onChange:l=>zt(l.target.value),onBlur:gt,onKeyDown:l=>l.key==="Enter"?gt():l.key==="Escape"?Kt():null,className:"w-20 mx-2 px-2 py-1 text-xs bg-emerald-50 border border-emerald-200 rounded",disabled:e.type==="EXPENSE",autoFocus:!0}):t.jsx("span",{onClick:()=>!k&&Yt(e),className:"cursor-pointer hover:bg-emerald-50 px-1 rounded",children:k?"****":N((e.originalSellingPrice||0)*(e.exchangeRate||1))})]})]}):t.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 lg:grid-cols-7 gap-2 text-[8px] font-bold uppercase text-center",children:[t.jsxs("div",{className:"bg-white p-1 rounded border",children:[t.jsx("p",{className:"text-slate-400 mb-1 border-b",children:"بالغ"}),t.jsxs("p",{className:"text-rose-600",children:["ش: ",k?"****":N((e.originalAdultPurchasePrice||e.originalPurchasePrice||0)*(1/(e.quantity||1))*(e.exchangeRate||1))]}),t.jsxs("p",{className:"text-emerald-600",children:["ب: ",k?"****":N((e.originalAdultSellingPrice||e.originalSellingPrice||0)*(1/(e.quantity||1))*(e.exchangeRate||1))]})]}),t.jsxs("div",{className:"bg-white p-1 rounded border",children:[t.jsx("p",{className:"text-slate-400 mb-1 border-b",children:"سنجل"}),t.jsxs("p",{className:"text-rose-600",children:["ش: ",k?"****":N((e.originalSinglePurchasePrice||0)*(1/(e.quantity||1))*(e.exchangeRate||1))]}),t.jsxs("p",{className:"text-emerald-600",children:["ب: ",k?"****":N((e.originalSingleSellingPrice||0)*(1/(e.quantity||1))*(e.exchangeRate||1))]})]}),t.jsxs("div",{className:"bg-white p-1 rounded border",children:[t.jsx("p",{className:"text-slate-400 mb-1 border-b",children:"ثنائي"}),t.jsxs("p",{className:"text-rose-600",children:["ش: ",k?"****":N((e.originalDoublePurchasePrice||0)*(1/(e.quantity||1))*(e.exchangeRate||1))]}),t.jsxs("p",{className:"text-emerald-600",children:["ب: ",k?"****":N((e.originalDoubleSellingPrice||0)*(1/(e.quantity||1))*(e.exchangeRate||1))]})]}),t.jsxs("div",{className:"bg-white p-1 rounded border",children:[t.jsx("p",{className:"text-slate-400 mb-1 border-b",children:"ثلاثي"}),t.jsxs("p",{className:"text-rose-600",children:["ش: ",k?"****":N((e.originalTriplePurchasePrice||0)*(1/(e.quantity||1))*(e.exchangeRate||1))]}),t.jsxs("p",{className:"text-emerald-600",children:["ب: ",k?"****":N((e.originalTripleSellingPrice||0)*(1/(e.quantity||1))*(e.exchangeRate||1))]})]}),t.jsxs("div",{className:"bg-white p-1 rounded border",children:[t.jsx("p",{className:"text-slate-400 mb-1 border-b",children:"رباعي"}),t.jsxs("p",{className:"text-rose-600",children:["ش: ",k?"****":N((e.originalQuadPurchasePrice||0)*(1/(e.quantity||1))*(e.exchangeRate||1))]}),t.jsxs("p",{className:"text-emerald-600",children:["ب: ",k?"****":N((e.originalQuadSellingPrice||0)*(1/(e.quantity||1))*(e.exchangeRate||1))]})]}),t.jsxs("div",{className:"bg-white p-1 rounded border",children:[t.jsx("p",{className:"text-slate-400 mb-1 border-b",children:"طفل"}),t.jsxs("p",{className:"text-rose-600",children:["ش: ",k?"****":N((e.originalChildPurchasePrice||0)*(1/(e.quantity||1))*(e.exchangeRate||1))]}),t.jsxs("p",{className:"text-emerald-600",children:["ب: ",k?"****":N((e.originalChildSellingPrice||0)*(1/(e.quantity||1))*(e.exchangeRate||1))]})]}),t.jsxs("div",{className:"bg-white p-1 rounded border",children:[t.jsx("p",{className:"text-slate-400 mb-1 border-b",children:"رضيع"}),t.jsxs("p",{className:"text-rose-600",children:["ش: ",k?"****":N((e.originalInfantPurchasePrice||0)*(1/(e.quantity||1))*(e.exchangeRate||1))]}),t.jsxs("p",{className:"text-emerald-600",children:["ب: ",k?"****":N((e.originalInfantSellingPrice||0)*(1/(e.quantity||1))*(e.exchangeRate||1))]})]}),t.jsxs("div",{className:"col-span-full text-[8px] text-slate-400 mt-1",children:["العملة: ",e.currencyCode]})]})})]},e.id))}),t.jsxs("div",{className:"flex justify-center gap-4",children:[t.jsxs("button",{type:"button",onClick:()=>{It(null),y({...Gt,currencyCode:D.baseCurrency||"EGP"}),ot(!0)},className:"bg-indigo-600 text-white px-8 py-4 rounded-2xl font-bold flex items-center gap-3 shadow-lg hover:bg-indigo-700 transition-all transform hover:scale-105",children:[t.jsx(Se,{size:24})," إضافة مكون جديد"]}),F&&(n.components||[]).some(e=>e.supplierId)&&t.jsxs("button",{type:"button",onClick:Cl,className:"bg-amber-600 text-white px-8 py-4 rounded-2xl font-bold flex items-center gap-3 shadow-lg hover:bg-amber-700 transition-all transform hover:scale-105",children:[t.jsx(it,{size:24})," ارتداد مكون حالي"]})]}),bl&&t.jsxs("div",{id:"return-form-section",className:"bg-white p-10 rounded-3xl border border-slate-200 shadow-xl mt-6 animate-in slide-in-from-top duration-300",children:[t.jsxs("div",{className:"mb-10 flex justify-between items-center",children:[t.jsxs("div",{className:"flex items-center gap-5",children:[t.jsx("div",{className:"p-4 rounded-2xl bg-amber-600 text-white shadow-lg",children:t.jsx(it,{size:28})}),t.jsxs("div",{children:[t.jsx("h3",{className:"text-2xl font-bold text-slate-900",children:"تسجيل ارتداد مالي (مرتجع)"}),t.jsx("p",{className:"text-slate-400 font-bold text-xs mt-1 uppercase tracking-widest",children:"إرجاع مبلغ من مورد مقابل بند تم شراؤه مسبقاً"})]})]}),t.jsx("button",{onClick:()=>pt(!1),className:"w-10 h-10 flex items-center justify-center rounded-full bg-slate-50 text-slate-400 hover:bg-rose-50 hover:text-rose-600 transition-all",children:t.jsx(ze,{size:20})})]}),t.jsxs("form",{onSubmit:jl,className:"space-y-10",children:[t.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-8",children:[t.jsxs("div",{className:"flex flex-col gap-3",children:[t.jsx("label",{className:"text-[11px] font-bold text-slate-500 uppercase tracking-widest px-2",children:"اسم المكون"}),t.jsx("div",{className:"w-full p-4 bg-slate-100 border border-slate-200 rounded-xl font-bold text-slate-600 shadow-sm cursor-not-allowed",children:w.compName})]}),t.jsxs("div",{className:"flex flex-col gap-3",children:[t.jsx("label",{className:"text-[11px] font-bold text-slate-500 uppercase tracking-widest px-2",children:"جهة الارتداد (المورد)"}),t.jsx("div",{className:"w-full p-4 bg-slate-100 border border-slate-200 rounded-xl font-bold text-slate-600 shadow-sm cursor-not-allowed",children:w.supplierName})]}),t.jsxs("div",{className:"flex flex-col gap-3",children:[t.jsx("label",{className:"text-[11px] font-bold text-amber-600 uppercase tracking-widest px-2",children:"العدد / الكمية المراد ارتدادها"}),t.jsxs("div",{className:"relative",children:[t.jsx("input",{type:"number",min:"1",max:w.originalQuantity,required:!0,className:"w-full p-4 bg-slate-50 border border-slate-200 rounded-xl font-bold text-slate-900 focus:border-amber-600 outline-none shadow-sm transition-all",value:w.quantity,onChange:e=>{const l=e.target.value,d=parseInt(l||"0"),r=(A||[]).find(j=>j.id===w.programId)?.components.find(j=>j.id===w.componentId),g=(r?.originalPurchasePrice||0)/(r?.quantity||1),f=isNaN(d)?"0":(g*d).toString();ht({...w,quantity:l,amount:f})}}),t.jsxs("div",{className:"absolute left-4 top-1/2 -translate-y-1/2 text-[10px] font-black text-slate-400",children:["من أصل ",w.originalQuantity]})]})]}),t.jsxs("div",{className:"flex flex-col gap-3",children:[t.jsxs("label",{className:"text-[11px] font-bold text-indigo-600 uppercase tracking-widest px-2",children:["إجمالي مبلغ الارتداد (",w.currencyCode,")"]}),t.jsx("input",{type:"number",step:"0.01",required:!0,className:"w-full p-4 bg-indigo-50 border border-indigo-200 rounded-xl font-bold text-slate-900 focus:border-indigo-600 outline-none shadow-sm transition-all",value:w.amount,onChange:e=>ht({...w,amount:e.target.value})})]}),t.jsxs("div",{className:"flex flex-col gap-3",children:[t.jsxs("label",{className:"text-[11px] font-bold text-slate-500 uppercase tracking-widest px-2",children:["سعر الصرف (",D.baseCurrency,")"]}),t.jsx("input",{type:"number",step:"0.000001",required:!0,className:`w-full p-4 border border-slate-200 rounded-xl font-bold text-slate-900 focus:border-amber-600 outline-none shadow-sm transition-all ${w.currencyCode===D.baseCurrency?"bg-slate-100 cursor-not-allowed":"bg-slate-50"}`,value:w.currencyCode===D.baseCurrency?"1":w.exchangeRate,onChange:e=>ht({...w,exchangeRate:e.target.value}),disabled:w.currencyCode===D.baseCurrency})]})]}),t.jsxs("div",{className:"flex gap-4 pt-6 border-t border-slate-100",children:[t.jsxs("button",{type:"submit",className:"flex-1 bg-slate-900 text-white px-8 py-4 rounded-xl font-bold text-sm flex items-center justify-center gap-3 shadow-lg hover:bg-amber-600 transition-all active:scale-95",children:[t.jsx(ei,{size:18})," حفظ عملية الارتداد"]}),t.jsx("button",{type:"button",onClick:()=>pt(!1),className:"px-10 bg-slate-50 text-slate-400 py-4 rounded-xl font-bold text-sm hover:bg-rose-50 hover:text-rose-600 transition-all active:scale-95",children:"إلغاء"})]})]})]}),hl&&t.jsxs("div",{id:"component-form-section",className:"bg-white p-8 rounded-3xl border border-slate-200 shadow-xl mt-6 animate-in slide-in-from-top duration-300",children:[t.jsxs("div",{className:"mb-6 flex items-center gap-4",children:[t.jsx("div",{className:"w-2 h-8 bg-indigo-500 rounded-full"}),t.jsx("h5",{className:"text-xl font-bold text-slate-900",children:Pe?"تعديل مكون البرنامج":"إضافة مكون جديد للبرنامج"})]}),t.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[t.jsxs("div",{className:"space-y-3",children:[t.jsx("label",{className:"text-xs font-bold text-slate-400 uppercase tracking-widest px-1",children:"نوع المكون"}),t.jsxs("select",{className:"w-full p-4 bg-slate-50 border border-slate-200 rounded-xl font-bold text-slate-900 focus:border-indigo-600 outline-none transition-all",value:c.type,onChange:e=>y({...c,type:e.target.value}),children:[t.jsx("option",{value:"FLIGHT",children:"تذكرة طيران"}),t.jsx("option",{value:"VISA",children:"تأشيرة"}),t.jsx("option",{value:"HOTEL",children:"فندق"}),t.jsx("option",{value:"INTERNAL_TRANSPORT",children:"نقل داخلي"}),t.jsx("option",{value:"GUARANTEE_LETTER",children:"خطاب ضمان"}),t.jsx("option",{value:"GIFTS_AND_PRINTS",children:"هدايا ومطبوعات"}),n.type==="INDIVIDUAL_UMRAH"&&t.jsx("option",{value:"SAUDI_TRANSPORT",children:"نقل سعودي"}),n.type!=="INDIVIDUAL_UMRAH"&&t.jsx("option",{value:"EXPENSE",children:"مصروفات الرحلة"})]})]}),t.jsxs("div",{className:"space-y-3",children:[t.jsx("label",{className:"text-xs font-bold text-slate-400 uppercase tracking-widest px-1",children:"اسم المكون"}),t.jsx("input",{required:!0,className:"w-full p-4 bg-slate-50 border border-slate-200 rounded-xl font-bold text-slate-900 focus:border-indigo-600 outline-none transition-all",value:c.name,onChange:e=>y({...c,name:e.target.value}),placeholder:"مثال: تذكرة مصر للطيران"})]}),t.jsxs("div",{className:"space-y-3",children:[t.jsx("label",{className:"text-xs font-bold text-slate-400 uppercase tracking-widest px-1 text-indigo-600",children:"العدد / الكمية"}),t.jsx("input",{type:"number",min:"1",required:!0,className:"w-full p-4 bg-indigo-50 bg-opacity-50 border border-indigo-100 rounded-xl font-bold text-slate-900 focus:border-indigo-600 outline-none transition-all",value:c.quantity,onChange:e=>y({...c,quantity:e.target.value})})]}),t.jsxs("div",{className:"space-y-3",children:[t.jsx("label",{className:"text-xs font-bold text-slate-400 uppercase tracking-widest px-1",children:"طريقة التسعير"}),t.jsxs("div",{className:"flex bg-slate-100 p-1 rounded-xl gap-1",children:[t.jsx("button",{type:"button",onClick:()=>y({...c,pricingMode:"PER_PERSON"}),className:`flex-1 py-2 rounded-lg font-bold text-xs transition-all ${c.pricingMode==="PER_PERSON"?"bg-white shadow-sm text-indigo-600":"text-slate-400"}`,children:"بالفرد"}),t.jsx("button",{type:"button",onClick:()=>y({...c,pricingMode:"TOTAL"}),className:`flex-1 py-2 rounded-lg font-bold text-xs transition-all ${c.pricingMode==="TOTAL"?"bg-white shadow-sm text-indigo-600":"text-slate-400"}`,children:"إجمالي للمجموعة"})]})]}),t.jsxs("div",{className:"space-y-3",children:[t.jsxs("div",{className:"flex justify-between items-center",children:[t.jsx("label",{className:"text-sm font-bold text-slate-400 uppercase",children:"جهة الشراء (الموفر)"}),t.jsxs("div",{className:"flex bg-slate-100 p-1 rounded-lg gap-1",children:[t.jsx("button",{type:"button",onClick:()=>y({...c,supplierType:"SUPPLIER",supplierId:""}),className:`px-2 py-0.5 rounded text-[8px] font-bold transition-all ${c.supplierType==="SUPPLIER"?"bg-white shadow-sm text-indigo-600":"text-slate-400"}`,children:"مورد"}),t.jsx("button",{type:"button",onClick:()=>y({...c,supplierType:"CUSTOMER",supplierId:""}),className:`px-2 py-0.5 rounded text-[8px] font-bold transition-all ${c.supplierType==="CUSTOMER"?"bg-white shadow-sm text-indigo-600":"text-slate-400"}`,children:"عميل"}),t.jsx("button",{type:"button",onClick:()=>y({...c,supplierType:"TREASURY",supplierId:""}),className:`px-2 py-0.5 rounded text-[8px] font-bold transition-all ${c.supplierType==="TREASURY"?"bg-white shadow-sm text-indigo-600":"text-slate-400"}`,children:"خزينة"})]})]}),t.jsx(W,{options:c.supplierType==="SUPPLIER"?(O||[]).map(e=>{const l=_e[e.id],d=l?` (متبقي: ${l.total-l.used})`:"";return{id:e.id,name:e.company+(e.isSaudiWallet?" 🇸🇦 (محفظة)":"")+d,subtext:`الرصيد: ${se?"****":N(e.balance||0)}`}}):c.supplierType==="CUSTOMER"?(Q||[]).map(e=>({id:e.id,name:e.name,subtext:`الرصيد: ${se?"****":N(e.balance||0)}`})):(bt||[]).map(e=>({id:e.id,name:e.name,subtext:`الرصيد: ${se?"****":N(e.balance)}`})),value:c.supplierId,onChange:e=>y({...c,supplierId:e}),placeholder:`اختر ${c.supplierType==="SUPPLIER"?"المورد":c.supplierType==="CUSTOMER"?"العميل":"الخزينة"}`})]}),t.jsxs("div",{className:"space-y-3",children:[t.jsx("label",{className:"text-sm font-bold text-slate-400 uppercase",children:"العملة"}),t.jsx("select",{className:"w-full p-5 bg-slate-50 border-2 rounded-2xl font-bold text-slate-900",value:c.currencyCode,onChange:e=>{const l=(ke||[]).find(d=>d.code===e.target.value);y({...c,currencyCode:e.target.value,exchangeRate:l?.rateToMain.toString()||"1"})},children:(ke||[]).map(e=>t.jsxs("option",{value:e.code,children:[e.name," (",e.symbol,")"]},e.code))})]}),t.jsxs("div",{className:"space-y-3",children:[t.jsxs("label",{className:"text-sm font-bold text-slate-400 uppercase",children:["سعر الصرف (",D.baseCurrency,")"]}),t.jsx("input",{type:"number",step:"0.01",className:`w-full p-5 border-2 rounded-2xl font-bold text-slate-900 ${c.currencyCode===D.baseCurrency?"bg-slate-100":"bg-slate-50"}`,value:c.currencyCode===D.baseCurrency?"1":c.exchangeRate,onChange:e=>y({...c,exchangeRate:e.target.value}),disabled:c.currencyCode===D.baseCurrency})]}),t.jsxs("div",{className:"space-y-3",children:[t.jsx("label",{className:"text-sm font-bold text-slate-400 uppercase",children:"تفاصيل إضافية"}),t.jsx("input",{className:"w-full p-5 bg-slate-50 border-2 rounded-2xl font-bold text-slate-900",value:c.details,onChange:e=>y({...c,details:e.target.value}),placeholder:c.type==="FLIGHT"?"رقم PNR":c.type==="HOTEL"?"مكة / المدينة":c.type==="GUARANTEE_LETTER"?"جهة إصدار الخطاب":"تفاصيل أخرى"})]}),t.jsxs("div",{className:"space-y-3 p-5 bg-amber-50 rounded-2xl border-2 border-amber-100 md:col-span-2",children:[t.jsxs("div",{className:"flex items-center gap-4",children:[t.jsx("input",{type:"checkbox",id:"isCommissionable",className:"w-6 h-6 accent-indigo-600",checked:c.isCommissionable,onChange:e=>y({...c,isCommissionable:e.target.checked})}),t.jsx("label",{htmlFor:"isCommissionable",className:"font-bold text-slate-900 cursor-pointer",children:"تمكين عمولة الموظف على هذا المكون (تذكرة، تأشيرة، إلخ)"})]}),c.isCommissionable&&t.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 mt-4 pt-4 border-t border-amber-200 border-opacity-50",children:[t.jsxs("div",{className:"space-y-2",children:[t.jsx("label",{className:"text-xs font-bold text-amber-900 mr-2",children:"الموظف المستحق"}),t.jsxs("select",{className:"w-full p-3 bg-white border-2 border-amber-200 rounded-xl font-bold text-slate-900 text-xs",value:c.employeeId||"",onChange:e=>y({...c,employeeId:e.target.value}),children:[t.jsx("option",{value:"",children:"اختر الموظف..."}),(H||[]).map(e=>t.jsx("option",{value:e?.id,children:e?.name},e?.id))]})]}),t.jsxs("div",{className:"space-y-2",children:[t.jsx("label",{className:"text-xs font-bold text-amber-900 mr-2",children:"قيمة العمولة"}),t.jsx("input",{type:"number",className:"w-full p-3 bg-white border-2 border-amber-200 rounded-xl font-bold text-slate-900 text-xs",value:c.commissionAmount||"",onChange:e=>y({...c,commissionAmount:Number(e.target.value)}),placeholder:"المبلغ..."})]})]})]}),t.jsx("div",{className:"md:col-span-2 space-y-4 bg-slate-50 p-6 rounded-3xl border-2 border-slate-100",children:c.pricingMode==="PER_PERSON"?t.jsxs(t.Fragment,{children:[t.jsxs("div",{className:"flex justify-between items-center mb-2",children:[t.jsx("h4",{className:"font-bold text-slate-900 text-sm",children:"تفاصيل التسعير لكل فرد"}),t.jsx("div",{className:"flex bg-slate-200 p-1 rounded-2xl gap-1",children:[{id:"SINGLE",label:"فردي"},{id:"DOUBLE",label:"ثنائي"},{id:"TRIPLE",label:"ثلاثي"},{id:"QUAD",label:"رباعي"}].map(e=>t.jsx("button",{type:"button",onClick:()=>ol(e.id),className:`px-3 py-1.5 rounded-xl font-bold text-[10px] transition-all ${xe===e.id?"bg-white text-slate-900 shadow-sm":"text-slate-500 hover:text-slate-900"}`,children:e.label},e.id))})]}),t.jsx("div",{className:"overflow-x-auto",children:t.jsxs("table",{className:"w-full border-collapse bg-white rounded-2xl overflow-hidden shadow-sm border-2 border-slate-100",children:[t.jsx("thead",{children:t.jsxs("tr",{className:"bg-slate-50 border-b-2 border-slate-100",children:[t.jsx("th",{className:"p-3 text-center border-l-2 border-slate-100 font-bold text-slate-900 text-sm",children:"النوع"}),t.jsx("th",{className:"p-3 text-center border-l-2 border-slate-100 font-bold text-slate-900 text-sm",children:"بالغ"}),t.jsx("th",{className:"p-3 text-center border-l-2 border-slate-100 font-bold text-slate-900 text-sm",children:"طفل"}),t.jsx("th",{className:"p-3 text-center border-l-2 border-slate-100 font-bold text-slate-900 text-sm",children:"رضيع"})]})}),t.jsxs("tbody",{children:[t.jsxs("tr",{children:[t.jsx("td",{className:"p-3 font-bold text-rose-600 bg-rose-50 border-l-2 border-slate-100 text-center text-xs whitespace-nowrap",children:"سعر الشراء"}),xe==="SINGLE"&&t.jsxs(t.Fragment,{children:[t.jsx("td",{className:"p-1 border-l border-slate-100",children:t.jsx("input",{type:"number",step:"0.01",className:"w-full p-2 bg-transparent font-bold text-sm text-center text-rose-600 outline-none",value:c.singlePurchasePrice,onChange:e=>y({...c,singlePurchasePrice:e.target.value})})}),t.jsx("td",{className:"p-1 border-l border-slate-100",children:t.jsx("input",{type:"number",step:"0.01",className:"w-full p-2 bg-transparent font-bold text-sm text-center text-rose-600 outline-none",value:c.singleChildPurchasePrice,onChange:e=>y({...c,singleChildPurchasePrice:e.target.value})})}),t.jsx("td",{className:"p-1 border-l border-slate-100",children:t.jsx("input",{type:"number",step:"0.01",className:"w-full p-2 bg-transparent font-bold text-sm text-center text-rose-600 outline-none",value:c.singleInfantPurchasePrice,onChange:e=>y({...c,singleInfantPurchasePrice:e.target.value})})})]}),xe==="DOUBLE"&&t.jsxs(t.Fragment,{children:[t.jsx("td",{className:"p-1 border-l border-slate-100",children:t.jsx("input",{type:"number",step:"0.01",className:"w-full p-2 bg-transparent font-bold text-sm text-center text-rose-600 outline-none",value:c.doublePurchasePrice,onChange:e=>y({...c,doublePurchasePrice:e.target.value})})}),t.jsx("td",{className:"p-1 border-l border-slate-100",children:t.jsx("input",{type:"number",step:"0.01",className:"w-full p-2 bg-transparent font-bold text-sm text-center text-rose-600 outline-none",value:c.doubleChildPurchasePrice,onChange:e=>y({...c,doubleChildPurchasePrice:e.target.value})})}),t.jsx("td",{className:"p-1 border-l border-slate-100",children:t.jsx("input",{type:"number",step:"0.01",className:"w-full p-2 bg-transparent font-bold text-sm text-center text-rose-600 outline-none",value:c.doubleInfantPurchasePrice,onChange:e=>y({...c,doubleInfantPurchasePrice:e.target.value})})})]}),xe==="TRIPLE"&&t.jsxs(t.Fragment,{children:[t.jsx("td",{className:"p-1 border-l border-slate-100",children:t.jsx("input",{type:"number",step:"0.01",className:"w-full p-2 bg-transparent font-bold text-sm text-center text-rose-600 outline-none",value:c.triplePurchasePrice,onChange:e=>y({...c,triplePurchasePrice:e.target.value})})}),t.jsx("td",{className:"p-1 border-l border-slate-100",children:t.jsx("input",{type:"number",step:"0.01",className:"w-full p-2 bg-transparent font-bold text-sm text-center text-rose-600 outline-none",value:c.tripleChildPurchasePrice,onChange:e=>y({...c,tripleChildPurchasePrice:e.target.value})})}),t.jsx("td",{className:"p-1 border-l border-slate-100",children:t.jsx("input",{type:"number",step:"0.01",className:"w-full p-2 bg-transparent font-bold text-sm text-center text-rose-600 outline-none",value:c.tripleInfantPurchasePrice,onChange:e=>y({...c,tripleInfantPurchasePrice:e.target.value})})})]}),xe==="QUAD"&&t.jsxs(t.Fragment,{children:[t.jsx("td",{className:"p-1 border-l border-slate-100",children:t.jsx("input",{type:"number",step:"0.01",className:"w-full p-2 bg-transparent font-bold text-sm text-center text-rose-600 outline-none",value:c.quadPurchasePrice,onChange:e=>y({...c,quadPurchasePrice:e.target.value})})}),t.jsx("td",{className:"p-1 border-l border-slate-100",children:t.jsx("input",{type:"number",step:"0.01",className:"w-full p-2 bg-transparent font-bold text-sm text-center text-rose-600 outline-none",value:c.quadChildPurchasePrice,onChange:e=>y({...c,quadChildPurchasePrice:e.target.value})})}),t.jsx("td",{className:"p-1 border-l border-slate-100",children:t.jsx("input",{type:"number",step:"0.01",className:"w-full p-2 bg-transparent font-bold text-sm text-center text-rose-600 outline-none",value:c.quadInfantPurchasePrice,onChange:e=>y({...c,quadInfantPurchasePrice:e.target.value})})})]})]}),t.jsxs("tr",{children:[t.jsx("td",{className:"p-3 font-bold text-emerald-600 bg-emerald-50 border-l-2 border-slate-100 text-center text-xs whitespace-nowrap",children:"سعر البيع"}),xe==="SINGLE"&&t.jsxs(t.Fragment,{children:[t.jsx("td",{className:"p-1 border-l border-slate-100",children:t.jsx("input",{type:"number",step:"0.01",className:"w-full p-2 bg-transparent font-bold text-sm text-center text-emerald-600 outline-none",value:c.singleSellingPrice,onChange:e=>y({...c,singleSellingPrice:e.target.value})})}),t.jsx("td",{className:"p-1 border-l border-slate-100",children:t.jsx("input",{type:"number",step:"0.01",className:"w-full p-2 bg-transparent font-bold text-sm text-center text-emerald-600 outline-none",value:c.singleChildSellingPrice,onChange:e=>y({...c,singleChildSellingPrice:e.target.value})})}),t.jsx("td",{className:"p-1 border-l border-slate-100",children:t.jsx("input",{type:"number",step:"0.01",className:"w-full p-2 bg-transparent font-bold text-sm text-center text-emerald-600 outline-none",value:c.singleInfantSellingPrice,onChange:e=>y({...c,singleInfantSellingPrice:e.target.value})})})]}),xe==="DOUBLE"&&t.jsxs(t.Fragment,{children:[t.jsx("td",{className:"p-1 border-l border-slate-100",children:t.jsx("input",{type:"number",step:"0.01",className:"w-full p-2 bg-transparent font-bold text-sm text-center text-emerald-600 outline-none",value:c.doubleSellingPrice,onChange:e=>y({...c,doubleSellingPrice:e.target.value})})}),t.jsx("td",{className:"p-1 border-l border-slate-100",children:t.jsx("input",{type:"number",step:"0.01",className:"w-full p-2 bg-transparent font-bold text-sm text-center text-emerald-600 outline-none",value:c.doubleChildSellingPrice,onChange:e=>y({...c,doubleChildSellingPrice:e.target.value})})}),t.jsx("td",{className:"p-1 border-l border-slate-100",children:t.jsx("input",{type:"number",step:"0.01",className:"w-full p-2 bg-transparent font-bold text-sm text-center text-emerald-600 outline-none",value:c.doubleInfantSellingPrice,onChange:e=>y({...c,doubleInfantSellingPrice:e.target.value})})})]}),xe==="TRIPLE"&&t.jsxs(t.Fragment,{children:[t.jsx("td",{className:"p-1 border-l border-slate-100",children:t.jsx("input",{type:"number",step:"0.01",className:"w-full p-2 bg-transparent font-bold text-sm text-center text-emerald-600 outline-none",value:c.tripleSellingPrice,onChange:e=>y({...c,tripleSellingPrice:e.target.value})})}),t.jsx("td",{className:"p-1 border-l border-slate-100",children:t.jsx("input",{type:"number",step:"0.01",className:"w-full p-2 bg-transparent font-bold text-sm text-center text-emerald-600 outline-none",value:c.tripleChildSellingPrice,onChange:e=>y({...c,tripleChildSellingPrice:e.target.value})})}),t.jsx("td",{className:"p-1 border-l border-slate-100",children:t.jsx("input",{type:"number",step:"0.01",className:"w-full p-2 bg-transparent font-bold text-sm text-center text-emerald-600 outline-none",value:c.tripleInfantSellingPrice,onChange:e=>y({...c,tripleInfantSellingPrice:e.target.value})})})]}),xe==="QUAD"&&t.jsxs(t.Fragment,{children:[t.jsx("td",{className:"p-1 border-l border-slate-100",children:t.jsx("input",{type:"number",step:"0.01",className:"w-full p-2 bg-transparent font-bold text-sm text-center text-emerald-600 outline-none",value:c.quadSellingPrice,onChange:e=>y({...c,quadSellingPrice:e.target.value})})}),t.jsx("td",{className:"p-1 border-l border-slate-100",children:t.jsx("input",{type:"number",step:"0.01",className:"w-full p-2 bg-transparent font-bold text-sm text-center text-emerald-600 outline-none",value:c.quadChildSellingPrice,onChange:e=>y({...c,quadChildSellingPrice:e.target.value})})}),t.jsx("td",{className:"p-1 border-l border-slate-100",children:t.jsx("input",{type:"number",step:"0.01",className:"w-full p-2 bg-transparent font-bold text-sm text-center text-emerald-600 outline-none",value:c.quadInfantSellingPrice,onChange:e=>y({...c,quadInfantSellingPrice:e.target.value})})})]})]})]})]})})]}):t.jsxs("div",{className:"col-span-full grid grid-cols-1 md:grid-cols-2 gap-6 w-full",children:[t.jsxs("div",{className:"space-y-3",children:[t.jsx("label",{className:"text-[10px] font-bold text-rose-500 uppercase",children:"إجمالي تكلفة الشراء للمجموعة"}),t.jsx("input",{type:"number",step:"0.01",required:!0,className:"w-full p-4 bg-white border-2 rounded-xl font-bold text-center text-rose-600 text-xl",value:c.purchasePrice,onChange:e=>y({...c,purchasePrice:e.target.value})})]}),t.jsxs("div",{className:"space-y-3",children:[t.jsx("label",{className:"text-[10px] font-bold text-emerald-600 uppercase",children:"إجمالي سعر البيع للمجموعة"}),t.jsx("input",{type:"number",step:"0.01",className:"w-full p-4 bg-white border-2 rounded-xl font-bold text-center text-emerald-600 text-xl",value:c.sellingPrice,onChange:e=>y({...c,sellingPrice:e.target.value})})]}),t.jsx("div",{className:"flex items-center text-xs text-slate-400 font-bold p-4 bg-slate-50 rounded-xl border border-slate-100 mt-3",children:"ℹ️ سيتم تقسيم هذا المبلغ بالتساوي على جميع أفراد التسكين تلقائياً."})]})})]}),t.jsxs("div",{className:"flex justify-end gap-6 pt-8 border-t border-slate-200 mt-8",children:[t.jsx("button",{type:"button",onClick:()=>ot(!1),className:"px-8 py-4 font-bold text-slate-400 hover:text-red-500 transition-colors",children:"إلغاء"}),t.jsx("button",{type:"button",onClick:Rl,className:"bg-slate-900 text-emerald-400 px-16 py-5 rounded-3xl font-bold text-xl shadow-2xl hover:bg-emerald-600 hover:text-white transition-all transform hover:scale-105",children:Pe?"حفظ التعديلات":"إضافة المكون"})]})]})]}),t.jsxs("div",{className:"flex justify-end gap-6 pt-10 border-t",children:[t.jsx("button",{type:"button",onClick:()=>Ee(!1),className:"px-10 py-4 font-bold text-slate-400 hover:text-red-500 transition-colors",children:"إلغاء"}),t.jsx("button",{type:"submit",className:"bg-slate-900 text-emerald-400 px-24 py-5 rounded-3xl font-bold text-2xl shadow-2xl hover:bg-emerald-600 hover:text-white transition-all transform hover:scale-105",children:F?"حفظ التعديلات":"حفظ البرنامج الجديد"})]})]})]}),t.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8",children:Ul.map(e=>{const l=(T||[]).filter(d=>d&&d.programId===e.id&&!d.isVoided).length;return t.jsxs("div",{className:"bg-white rounded-3xl shadow-sm border border-slate-100 overflow-hidden group hover:shadow-xl transition-all cursor-pointer",onClick:()=>Xt(e),children:[t.jsxs("div",{className:"p-8 bg-slate-900 text-white relative",children:[t.jsx("div",{className:"absolute top-4 left-4 bg-indigo-500 text-white px-3 py-1 rounded-full text-[10px] font-bold uppercase tracking-widest",children:e.type}),t.jsx("h4",{className:"text-xl font-bold mb-1",children:e.name}),e.masterTripId&&t.jsxs("div",{className:"flex items-center gap-1.5 mb-2",children:[t.jsx(nt,{size:14,className:"text-emerald-400"}),t.jsxs("span",{className:"text-[10px] font-bold text-emerald-100 bg-emerald-900 bg-opacity-40 px-2 py-0.5 rounded-lg",children:["الرحلة الأم: ",(Ce||[]).find(d=>d&&d.id===e.masterTripId)?.name||"---"]})]}),t.jsxs("p",{className:"text-slate-400 font-bold text-xs flex items-center gap-1.5 mt-2 opacity-80",children:[t.jsx(ti,{size:12})," ",(O||[]).find(d=>d&&d.id===e.supplierId)?.company||"---"]})]}),t.jsxs("div",{className:"p-8 space-y-6",children:[t.jsxs("div",{className:"flex justify-between border-b border-slate-50 pb-4",children:[t.jsxs("div",{children:[t.jsx("p",{className:"text-[10px] font-bold text-slate-400 uppercase tracking-widest mb-1",children:"سعر الفرد"}),t.jsx("p",{className:"text-lg font-bold text-slate-900",children:k?"****":N(e.adultSellingPrice||e.sellingPrice||0)})]}),t.jsxs("div",{className:"text-left",children:[t.jsx("p",{className:"text-[10px] font-bold text-slate-400 uppercase tracking-widest mb-1",children:"عدد الحجوزات"}),t.jsxs("p",{className:"text-lg font-bold text-emerald-600",children:[l," أفراد"]})]})]}),t.jsxs("div",{className:"flex justify-between items-center",children:[t.jsxs("div",{children:[t.jsx("p",{className:"text-[10px] font-bold text-slate-400 uppercase tracking-widest mb-1",children:"تاريخ الرحلة"}),t.jsxs("div",{className:"flex items-center gap-2 text-slate-600",children:[t.jsx(tl,{size:14}),t.jsx("span",{className:"text-sm font-bold",children:e.date})]})]}),t.jsxs("div",{className:"flex gap-2",onClick:d=>d.stopPropagation(),children:[B.role==="ADMIN"&&e.customerId&&t.jsxs("button",{onClick:()=>El(e),className:"p-2.5 bg-emerald-50 text-emerald-600 rounded-xl hover:bg-emerald-600 hover:text-white transition-all shadow-sm flex items-center gap-2 px-4",title:"ترحيل الفواتير للحسابات",children:[t.jsx(mt,{size:16}),t.jsx("span",{className:"text-xs font-bold",children:"ترحيل الحسابات"})]}),t.jsx("button",{onClick:()=>Bt(e.id),className:"p-2.5 bg-slate-50 text-slate-600 rounded-xl hover:bg-emerald-600 hover:text-white transition-all shadow-sm",title:"كشف التسكين",children:t.jsx(Wt,{size:16})}),B.role==="ADMIN"&&t.jsxs(t.Fragment,{children:[t.jsx("button",{onClick:()=>Xt(e),className:"p-2.5 bg-slate-50 text-slate-600 rounded-xl hover:bg-slate-900 hover:text-white transition-all shadow-sm",children:t.jsx(xt,{size:16})}),t.jsx("button",{onClick:()=>rl(e.id),className:"p-2.5 bg-rose-50 text-rose-600 rounded-xl hover:bg-rose-600 hover:text-white transition-all shadow-sm",children:t.jsx(Pt,{size:16})})]})]})]})]})]},e.id)})})]}),ge==="BOOKINGS"&&t.jsxs("div",{className:"space-y-6",children:[t.jsxs("div",{className:"flex justify-between items-center bg-white p-6 rounded-3xl border border-slate-100 shadow-sm",children:[t.jsxs("div",{className:"flex items-center gap-5",children:[t.jsx("div",{className:"w-12 h-12 bg-emerald-50 text-emerald-600 rounded-2xl flex items-center justify-center",children:t.jsx(lt,{size:24})}),t.jsxs("div",{children:[t.jsx("h3",{className:"text-xl font-bold text-slate-900 tracking-tight",children:"تسكين وحجوزات العملاء"}),t.jsx("p",{className:"text-slate-400 font-bold text-[11px] uppercase tracking-widest",children:"إدارة غرف وإقامات المعتمرين"})]})]}),t.jsxs("div",{className:"flex items-center gap-4",children:[Te.length>0&&B.role==="ADMIN"&&t.jsxs("button",{onClick:Gl,className:"bg-rose-500 text-white px-8 py-3 rounded-xl font-bold text-sm flex items-center gap-3 shadow-lg hover:bg-rose-600 transition-all active:scale-95 animate-in zoom-in",children:[t.jsx(ll,{size:18})," حذف (",Te.length,")"]}),t.jsxs("button",{onClick:()=>Ye(!0),className:"bg-slate-900 text-white px-8 py-3 rounded-xl font-bold text-sm flex items-center gap-3 shadow-lg hover:bg-emerald-600 transition-all active:scale-95",children:[t.jsx(Se,{size:18})," تسكين جديد"]})]})]}),ul&&t.jsx("div",{className:"bg-white p-10 rounded-3xl border border-slate-200 shadow-xl animate-in fade-in zoom-in duration-300",children:t.jsxs("form",{onSubmit:Al,className:"space-y-10",children:[t.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-8",children:[t.jsxs("div",{className:"flex flex-col gap-3",children:[t.jsx("label",{className:"text-[11px] font-bold text-slate-500 uppercase tracking-widest px-2",children:"نوع الحجز"}),t.jsxs("select",{className:"w-full p-4 bg-white border border-slate-200 rounded-xl font-bold text-slate-900 focus:border-slate-900 outline-none shadow-sm h-[52px]",value:a.bookingType,onChange:e=>{const l=e.target.value,d=(A||[]).find(p=>p.id===a.programId);R({...a,bookingType:l,customSellingPrice:l==="SUPERVISOR"?"0":l==="AGENT"?(d?.adultAgentPrice||d?.adultSellingPrice||d?.sellingPrice||0).toString():(d?.adultSellingPrice||d?.sellingPrice||0).toString()})},children:[t.jsx("option",{value:"DIRECT",children:"عميل مباشر"}),t.jsx("option",{value:"AGENT",children:"عن طريق مندوب"}),t.jsx("option",{value:"SUPERVISOR",children:"مشرف رحلة"})]})]}),t.jsxs("div",{className:"flex flex-col gap-3",children:[t.jsx("label",{className:"text-[11px] font-bold text-slate-500 uppercase tracking-widest px-2",children:"اختر الرحلة المتاحة"}),t.jsx(W,{options:(A||[]).map(e=>({id:e.id,name:e.name,subtext:`بتاريخ: ${e.date}`})),value:a.programId,onChange:e=>{const l=(A||[]).find(p=>p.id===e),d=l?.isAgent?"AGENT":a.bookingType;R({...a,programId:e,bookingType:d,customSellingPrice:d==="SUPERVISOR"?"0":d==="AGENT"?(l?.adultAgentPrice||l?.adultSellingPrice||l?.sellingPrice||0).toString():(l?.adultSellingPrice||l?.sellingPrice||0).toString()})},placeholder:"اختر الرحلة"})]}),t.jsxs("div",{className:"flex flex-col gap-3",children:[t.jsx("label",{className:"text-[11px] font-bold text-slate-500 uppercase tracking-widest px-2",children:a.bookingType==="AGENT"?"المندوب (كعميل)":"العميل"}),t.jsx(W,{options:(Q||[]).map(e=>({id:e.id,name:e.name,subtext:`الرصيد: ${se?"****":N(ft.customers[e.id]||0)}`})),value:a.bookingType==="AGENT"?a.agentId:a.customerId,onChange:e=>R({...a,[a.bookingType==="AGENT"?"agentId":"customerId"]:e}),placeholder:a.bookingType==="AGENT"?"اختر المندوب":"اختر العميل"})]}),t.jsxs("div",{className:"flex flex-col gap-3",children:[t.jsx("label",{className:"text-[11px] font-bold text-slate-500 uppercase tracking-widest px-2 flex items-center gap-2",children:"الموظف المسؤول"}),t.jsx(W,{options:(H||[]).map(e=>({id:e.id,name:e.name,subtext:e.position})),value:a.employeeId,onChange:e=>{const l=(H||[]).find(d=>d.id===e);R({...a,employeeId:e,employeeCommissionRate:l?l.commissionRate.toString():a.employeeCommissionRate})},placeholder:"الموظف المسؤول"})]})]}),t.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-10 p-10 bg-slate-50 rounded-3xl border border-slate-100",children:[t.jsxs("div",{className:"space-y-6",children:[t.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[t.jsxs("div",{className:"flex flex-col gap-3",children:[t.jsx("label",{className:"text-[11px] font-bold text-slate-500 uppercase tracking-widest px-2",children:"تفاصيل التسكين (الفنادق)"}),t.jsx("input",{required:!0,className:"w-full p-4 bg-white border border-slate-200 rounded-xl font-bold text-slate-900 focus:border-indigo-600 outline-none shadow-sm",placeholder:"فندق موفنبيك",value:a.accommodation,onChange:e=>R({...a,accommodation:e.target.value})})]}),t.jsxs("div",{className:"flex flex-col gap-3",children:[t.jsx("label",{className:"text-[11px] font-bold text-slate-500 uppercase tracking-widest px-2",children:"أسماء المعتمرين (اختياري)"}),t.jsx("input",{className:"w-full p-4 bg-white border border-slate-200 rounded-xl font-bold text-slate-900 focus:border-indigo-600 outline-none shadow-sm",placeholder:"أحمد، محمد، ...",value:a.names,onChange:e=>R({...a,names:e.target.value})})]})]}),t.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:t.jsxs("div",{className:"flex flex-col gap-3",children:[t.jsx("label",{className:"text-[11px] font-bold text-slate-500 uppercase tracking-widest px-2",children:"نوع الغرفة"}),t.jsxs("select",{className:"w-full p-4 bg-white border border-slate-200 rounded-xl font-bold text-slate-900 focus:border-slate-900 outline-none shadow-sm",value:a.roomType,onChange:e=>R({...a,roomType:e.target.value}),children:[t.jsx("option",{value:"DEFAULT",children:"افتراضي (سعر البالغ)"}),t.jsx("option",{value:"SINGLE",children:"غرفة سنجل"}),t.jsx("option",{value:"DOUBLE",children:"غرفة ثنائية"}),t.jsx("option",{value:"TRIPLE",children:"غرفة ثلاثية"}),t.jsx("option",{value:"QUAD",children:"غرفة رباعية"})]})]})}),t.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-8",children:[t.jsxs("div",{className:"space-y-4",children:[t.jsxs("label",{className:"text-base font-bold text-slate-900 uppercase flex items-center gap-2 tracking-wide",children:[t.jsx(Kl,{size:20,className:"text-blue-600"})," المسئول عن التسكين"]}),t.jsx(W,{options:(H||[]).map(e=>({id:e?.id,name:e?.name,subtext:e?.position})),value:a.accommodationEmployeeId,onChange:e=>R({...a,accommodationEmployeeId:e}),placeholder:"المسؤول عن التسكين"})]}),t.jsxs("div",{className:"space-y-4",children:[t.jsxs("label",{className:"text-base font-bold text-amber-600 uppercase flex items-center gap-2 tracking-wide",children:[t.jsx(li,{size:20})," نسبة العمولة %"]}),t.jsx("input",{type:"number",step:"0.1",required:!0,className:"w-full p-6 bg-white border-2 border-slate-300 rounded-3xl font-bold text-3xl text-center text-slate-900 focus:border-amber-500 outline-none shadow-sm",value:a.employeeCommissionRate,onChange:e=>R({...a,employeeCommissionRate:e.target.value})})]})]}),t.jsxs("div",{className:"grid grid-cols-4 gap-6",children:[t.jsxs("div",{className:"space-y-3",children:[t.jsx("label",{className:"text-xs font-bold text-slate-500 uppercase",children:"بالغ"}),t.jsx("input",{type:"number",min:"0",className:"w-full p-5 bg-white border border-slate-200 rounded-2xl font-bold text-center text-xl shadow-sm focus:border-indigo-600 outline-none",value:a.adultCount,onChange:e=>R({...a,adultCount:e.target.value})})]}),t.jsxs("div",{className:"space-y-3",children:[t.jsx("label",{className:"text-xs font-bold text-slate-500 uppercase",children:"طفل"}),t.jsx("input",{type:"number",min:"0",className:"w-full p-5 bg-white border border-slate-200 rounded-2xl font-bold text-center text-xl shadow-sm focus:border-indigo-600 outline-none",value:a.childCount,onChange:e=>R({...a,childCount:e.target.value})})]}),t.jsxs("div",{className:"space-y-3",children:[t.jsx("label",{className:"text-xs font-bold text-slate-500 uppercase",children:"رضيع"}),t.jsx("input",{type:"number",min:"0",className:"w-full p-5 bg-white border border-slate-200 rounded-2xl font-bold text-center text-xl shadow-sm focus:border-indigo-600 outline-none",value:a.infantCount,onChange:e=>R({...a,infantCount:e.target.value})})]}),t.jsxs("div",{className:"space-y-3",children:[t.jsx("label",{className:"text-xs font-bold text-rose-500 uppercase",children:"المشرفين"}),t.jsx("input",{type:"number",min:"0",className:"w-full p-5 bg-white border border-rose-100 rounded-2xl font-bold text-center text-rose-700 text-xl shadow-sm focus:border-rose-500 outline-none",value:a.supervisorCount,onChange:e=>R({...a,supervisorCount:e.target.value})})]})]}),t.jsxs("div",{className:"space-y-4",children:[t.jsxs("label",{className:"text-base font-bold text-slate-900 uppercase flex items-center gap-2 tracking-wide",children:[t.jsx(Wl,{size:20,className:"text-rose-600"})," اسم مشرف الرحلة"]}),t.jsx("input",{className:"w-full p-6 bg-white border-2 border-rose-100 rounded-3xl font-bold text-xl text-slate-900 focus:border-rose-600 outline-none shadow-sm",placeholder:"اكتب اسم المشرف هنا",value:a.supervisorName,onChange:e=>R({...a,supervisorName:e.target.value})})]})]}),t.jsxs("div",{className:"grid grid-cols-1 gap-8",children:[t.jsxs("div",{className:"space-y-4",children:[t.jsx("label",{className:"text-base font-bold text-slate-900 uppercase tracking-wide",children:"تاريخ الحجز"}),t.jsx("input",{type:"date",className:"w-full p-6 bg-white border-2 border-slate-200 rounded-3xl font-bold text-xl text-slate-900 focus:border-indigo-600 outline-none shadow-sm",value:a.date,onChange:e=>R({...a,date:e.target.value})})]}),t.jsxs("div",{className:"space-y-4",children:[t.jsxs("label",{className:"text-base font-bold text-emerald-700 uppercase flex items-center gap-2 tracking-wide",children:[t.jsx(mt,{size:20})," سعر البيع (تعديل يدوي)"]}),t.jsx("input",{type:"number",className:"w-full p-8 bg-white border-4 border-emerald-200 rounded-3xl font-bold text-4xl text-center text-emerald-700 focus:border-indigo-500 outline-none shadow-xl",value:a.customSellingPrice,onChange:e=>R({...a,customSellingPrice:e.target.value}),placeholder:"اترك فارغاً للسعر الافتراضي"})]}),t.jsxs("div",{className:"space-y-4",children:[t.jsxs("label",{className:"text-base font-bold text-rose-600 uppercase flex items-center gap-2 tracking-wide",children:[t.jsx(ii,{size:20})," الخصم للعميل"]}),t.jsx("input",{type:"number",className:"w-full p-8 bg-white border-4 border-rose-200 rounded-3xl font-bold text-4xl text-center text-rose-600 focus:border-rose-500 outline-none shadow-xl",value:a.discount,onChange:e=>R({...a,discount:e.target.value})})]}),(()=>{const e=(A||[]).find(l=>l.id===a.programId);if(e?.type==="INDIVIDUAL_UMRAH"){const l=parseInt(a.adultCount||"0"),d=parseInt(a.childCount||"0"),p=parseInt(a.infantCount||"0"),r=a.roomType==="SINGLE"?e.singlePurchasePrice||e.adultPurchasePrice||e.purchasePrice||0:a.roomType==="DOUBLE"?e.doublePurchasePrice||e.adultPurchasePrice||e.purchasePrice||0:a.roomType==="TRIPLE"?e.triplePurchasePrice||e.adultPurchasePrice||e.purchasePrice||0:a.roomType==="QUAD"?e.quadPurchasePrice||e.adultPurchasePrice||e.purchasePrice||0:e.adultPurchasePrice||e.purchasePrice||0,g=a.roomType==="SINGLE"?e.singleChildPurchasePrice||e.childPurchasePrice||0:a.roomType==="DOUBLE"?e.doubleChildPurchasePrice||e.childPurchasePrice||0:a.roomType==="TRIPLE"?e.tripleChildPurchasePrice||e.childPurchasePrice||0:a.roomType==="QUAD"?e.quadChildPurchasePrice||e.childPurchasePrice||0:e.childPurchasePrice||0,f=a.roomType==="SINGLE"?e.singleInfantPurchasePrice||e.infantPurchasePrice||0:a.roomType==="DOUBLE"?e.doubleInfantPurchasePrice||e.infantPurchasePrice||0:a.roomType==="TRIPLE"?e.tripleInfantPurchasePrice||e.infantPurchasePrice||0:a.roomType==="QUAD"?e.quadInfantPurchasePrice||e.infantPurchasePrice||0:e.infantPurchasePrice||0,j=l*r+d*g+p*f,m=parseFloat(a.customSellingPrice||"0")-parseFloat(a.discount||"0")-j,E=parseFloat(a.employeeCommissionRate||"0"),v=m>0?m*(E*.01):0;return t.jsxs("div",{className:"md:col-span-1 space-y-4 bg-emerald-50 bg-opacity-50 p-6 rounded-3xl border-2 border-emerald-100 shadow-sm animate-in fade-in slide-in-from-top-4 duration-500",children:[t.jsx("div",{className:"flex items-center justify-between mb-4",children:t.jsxs("div",{className:"flex items-center gap-3",children:[t.jsx("div",{className:"w-10 h-10 bg-emerald-600 rounded-xl flex items-center justify-center text-white",children:t.jsx(ni,{size:20})}),t.jsx("h4",{className:"text-lg font-black text-emerald-900",children:"حاسبة الربح والعمولة"})]})}),t.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[t.jsxs("div",{className:`p-4 rounded-2xl border shadow-sm transition-all ${m>=0?"bg-white border-emerald-100":"bg-rose-50 border-rose-200 animate-pulse"}`,children:[t.jsxs("div",{className:"flex items-center justify-between mb-1",children:[t.jsx("p",{className:"text-[10px] font-bold text-slate-400 uppercase",children:"صافي الربح"}),m<0&&t.jsx(Zl,{size:14,className:"text-rose-600"})]}),t.jsx("p",{className:`text-xl font-black ${m>=0?"text-emerald-600":"text-rose-600"}`,children:N(m)}),m<0&&t.jsxs("div",{className:"mt-2 flex items-center gap-1 text-[9px] font-bold text-rose-700 bg-white bg-opacity-50 p-1 rounded border border-rose-100",children:[t.jsx(Zt,{size:10}),"تنبيه: العملية تحقق خسارة!"]})]}),t.jsxs("div",{className:"bg-white p-4 rounded-2xl border border-emerald-100 shadow-sm",children:[t.jsx("p",{className:"text-[10px] font-bold text-slate-400 uppercase mb-1",children:"العمولة المستحقة"}),t.jsx("p",{className:"text-xl font-black text-amber-600",children:N(v)})]})]}),t.jsxs("div",{className:"flex items-center gap-3 bg-white p-4 rounded-2xl border border-emerald-100 shadow-sm",children:[t.jsx("input",{type:"checkbox",id:"applyCommissionUmrah",className:"w-5 h-5 accent-indigo-500 rounded cursor-pointer",checked:a.applyCommission,onChange:U=>R({...a,applyCommission:U.target.checked})}),t.jsx("label",{htmlFor:"applyCommissionUmrah",className:"text-xs font-bold text-slate-700 cursor-pointer",children:"ترحيل العمولة لحساب الموظف تلقائياً"})]})]})}return null})(),_t&&t.jsxs("div",{className:"space-y-4",children:[t.jsxs("label",{className:"text-base font-bold text-slate-700 uppercase flex items-center gap-2 tracking-wide",children:[t.jsx(nt,{size:20,className:"text-slate-600"})," مركز التكلفة"]}),t.jsxs("select",{className:"w-full p-6 bg-white border-2 border-slate-200 rounded-3xl font-bold text-xl text-slate-900 focus:border-slate-500 outline-none shadow-sm",value:a.costCenterId,onChange:e=>R({...a,costCenterId:e.target.value}),children:[t.jsx("option",{value:"",children:"بدون مركز تكلفة"}),$t.filter(e=>e.isActive).map(e=>t.jsx("option",{value:e.id,children:e.name},e.id))]})]})]})]}),t.jsxs("div",{className:"flex justify-end gap-6 border-t border-slate-100 pt-8",children:[t.jsx("button",{type:"button",onClick:()=>Ye(!1),className:"px-12 py-5 font-bold text-slate-400 hover:text-red-500 transition-colors text-xl",children:"إلغاء"}),t.jsx("button",{type:"submit",className:"bg-slate-900 text-emerald-400 px-24 py-6 rounded-3xl font-bold text-3xl shadow-2xl hover:bg-emerald-700 hover:text-white transition-all transform hover:scale-105",children:"إتمام الترحيل المالي"})]})]})}),t.jsx("div",{className:"bg-white rounded-3xl shadow-xl border border-slate-200 overflow-hidden",children:t.jsx("div",{className:"overflow-x-auto",children:t.jsxs("table",{className:"w-full text-right",children:[t.jsx("thead",{children:t.jsxs("tr",{className:"bg-slate-900 text-slate-200 border-b border-slate-800",children:[t.jsx("th",{className:"px-10 py-8 w-12 text-center",children:t.jsx("input",{type:"checkbox",className:"w-5 h-5 accent-indigo-500 rounded cursor-pointer",checked:et.length>0&&Te.length===et.length,onChange:Dl})}),t.jsx("th",{className:"px-10 py-8 text-xs font-bold uppercase tracking-[0.2em]",children:"تفاصيل الرحلة والبرنامج"}),t.jsx("th",{className:"px-10 py-8 text-xs font-bold uppercase tracking-[0.2em]",children:"المعتمر / العميل"}),t.jsx("th",{className:"px-10 py-8 text-xs font-bold uppercase tracking-[0.2em] text-center",children:"نوع الغرفة والعدد"}),t.jsx("th",{className:"px-10 py-8 text-xs font-bold uppercase tracking-[0.2em] text-center",children:"المسؤول عن التنفيذ"}),t.jsx("th",{className:"px-10 py-8 text-xs font-bold uppercase tracking-[0.2em] text-center",children:"المسؤول عن التسكين"}),t.jsx("th",{className:"px-10 py-8 text-xs font-bold uppercase tracking-[0.2em] text-center",children:"القيمة النهائية"}),t.jsx("th",{className:"px-10 py-8 text-xs font-bold uppercase tracking-[0.2em] text-center",children:"الإجراءات"})]})}),t.jsx("tbody",{className:"divide-y divide-slate-100 font-bold",children:et.map(e=>t.jsxs("tr",{id:`booking-${e.id}`,className:`hover:bg-slate-50 transition-all group ${Pl===e.id?"ring-4 ring-indigo-500 border-indigo-500 bg-indigo-50/30 scale-[1.002] z-10 shadow-2xl":""}`,children:[t.jsx("td",{className:"px-10 py-8 text-center",children:t.jsx("input",{type:"checkbox",className:"w-5 h-5 accent-indigo-500 rounded cursor-pointer",checked:Te.includes(e.id),onChange:()=>Fl(e.id)})}),t.jsx("td",{className:"px-10 py-8",children:t.jsxs("div",{className:"flex flex-col gap-2",children:[e.masterTripId&&t.jsx("span",{className:"text-[10px] font-bold text-emerald-700 bg-emerald-50 px-3 py-1 rounded-lg w-fit border border-emerald-100",children:(Ce||[]).find(l=>l&&l.id===e.masterTripId)?.name||"رحلة غير محددة"}),t.jsx("p",{className:"text-slate-900 font-bold text-lg leading-tight",children:(e.description||"").split(" - ")[0]}),e.refNo&&t.jsxs("button",{onClick:()=>{navigator.clipboard.writeText(e.refNo);const l=document.getElementById(`ref-hu-${e.id}`);if(l){const d=l.innerText;l.innerText="تم النسخ",setTimeout(()=>{l.innerText=d},1e3)}},id:`ref-hu-${e.id}`,className:"text-[11px] text-emerald-600 font-bold uppercase tracking-widest bg-emerald-50 px-3 py-1 rounded-lg w-fit border border-emerald-100 hover:bg-emerald-100 transition-all",title:"اضغط للنسخ والبحث",children:["Ref: #",e.refNo]}),!e.refNo&&t.jsxs("span",{className:"text-[11px] text-emerald-600 font-bold uppercase tracking-widest bg-emerald-50 px-3 py-1 rounded-lg w-fit border border-emerald-100",children:["Ref: #",e.id.slice(-6).toUpperCase()]})]})}),t.jsx("td",{className:"px-10 py-8",children:t.jsxs("div",{className:"flex items-center gap-4",children:[t.jsx("div",{className:"w-12 h-12 bg-slate-900 text-emerald-400 rounded-xl flex items-center justify-center font-bold text-sm shadow-sm",children:(Q||[]).find(l=>l&&l.id===e.relatedEntityId)?.name?.charAt(0)||"?"}),t.jsx("p",{className:"text-slate-900 font-bold text-lg",children:(Q||[]).find(l=>l&&l.id===e.relatedEntityId)?.name||"---"})]})}),t.jsx("td",{className:"px-10 py-8 text-center",children:t.jsxs("div",{className:"flex flex-col items-center gap-2",children:[t.jsx("span",{className:`px-4 py-1.5 rounded-xl text-xs font-bold shadow-sm ${e.roomType==="SINGLE"?"bg-rose-100 text-rose-700 border border-rose-200":e.roomType==="DOUBLE"?"bg-blue-100 text-blue-700 border border-blue-200":e.roomType==="TRIPLE"?"bg-amber-100 text-amber-700 border border-amber-200":e.roomType==="QUAD"?"bg-emerald-100 text-emerald-700 border border-emerald-200":"bg-slate-100 text-slate-700 border border-slate-200"}`,children:e.roomType==="SINGLE"?"سنجل":e.roomType==="DOUBLE"?"ثنائي":e.roomType==="TRIPLE"?"ثلاثي":e.roomType==="QUAD"?"رباعي":"افتراضي"}),t.jsxs("span",{className:"text-xs font-bold text-slate-500 bg-slate-50 px-3 py-1 rounded-lg",children:[e.adultCount," بالغ | ",e.childCount," طفل | ",e.infantCount," رضيع",e.supervisorCount>0&&` | ${e.supervisorCount} مشرف`]})]})}),t.jsx("td",{className:"px-10 py-8",children:t.jsxs("div",{className:"flex flex-col items-center gap-2",children:[t.jsx("span",{className:"text-slate-900 text-base font-bold",children:(H||[]).find(l=>l&&l.id===e.employeeId)?.name||"---"}),t.jsxs("span",{className:"text-[10px] font-bold px-3 py-1 bg-amber-100 text-amber-800 rounded-lg uppercase tracking-wider border border-amber-200",children:["عمولة: ",se?"****":e.employeeCommissionRate||0,"%"]})]})}),t.jsx("td",{className:"px-10 py-8 text-center",children:t.jsx("span",{className:"text-slate-900 text-base font-bold bg-slate-50 px-4 py-2 rounded-xl border border-slate-100",children:(H||[]).find(l=>l&&l.id===e.accommodationEmployeeId)?.name||"---"})}),t.jsx("td",{className:"px-10 py-8 text-center",children:t.jsxs("div",{className:"flex flex-col items-center bg-slate-50 p-4 rounded-2xl border border-slate-100",children:[t.jsx("p",{className:"text-2xl font-bold text-slate-900",children:se?"****":N(e.amountInBase||((e.sellingPrice||0)-(e.discount||0))*(e.exchangeRate||1))}),e.discount>0&&t.jsxs("p",{className:"text-[11px] text-rose-600 font-bold mt-1 bg-rose-50 px-2 py-0.5 rounded border border-rose-100",children:["خصم: ",se?"****":N((e.discount||0)*(e.exchangeRate||1))]})]})}),t.jsx("td",{className:"px-8 py-5",children:t.jsxs("div",{className:"flex justify-center gap-2 opacity-0 group-hover:opacity-100 transition-opacity",children:[t.jsx("button",{onClick:()=>wl(e),className:"p-2.5 text-slate-400 hover:text-emerald-600 hover:bg-emerald-50 rounded-xl transition-all",title:"تعديل الحجز",children:t.jsx(xt,{size:18})}),B.role==="ADMIN"&&t.jsx("button",{onClick:()=>qt(e.id),className:"p-2.5 text-slate-400 hover:text-rose-600 hover:bg-rose-50 rounded-xl transition-all",title:"حذف الحجز",children:t.jsx(ll,{size:18})})]})})]},e.id))})]})})})]}),ge==="MASTER_TRIPS"&&t.jsxs("div",{className:"space-y-8 animate-in zoom-in-95 duration-500",children:[t.jsxs("div",{className:"flex justify-between items-center bg-white p-8 rounded-3xl border border-slate-100 shadow-sm",children:[t.jsxs("div",{className:"flex items-center gap-6",children:[t.jsx("div",{className:"w-16 h-16 bg-emerald-50 text-emerald-600 rounded-2xl flex items-center justify-center",children:t.jsx(nt,{size:32})}),t.jsxs("div",{children:[t.jsx("h3",{className:"text-2xl font-bold text-slate-900 tracking-tight",children:"إدارة الرحلات المجمعة"}),t.jsxs("div",{className:"flex items-center gap-4 mt-1",children:[t.jsx("p",{className:"text-slate-400 font-bold text-sm uppercase tracking-widest",children:"تنظيم وتصنيف المجموعات والبرامج"}),t.jsx("button",{onClick:()=>xl(!$e),className:`text-[10px] font-bold px-3 py-1 rounded-full border transition-all ${$e?"bg-rose-50 border-rose-200 text-rose-600":"bg-slate-50 border-slate-200 text-slate-400"}`,children:$e?"إخفاء الملغي":"عرض الرحلات الملغية"})]})]})]}),t.jsxs("button",{onClick:()=>{jt(null),we({name:"",date:new Date().toISOString().split("T")[0],type:"UMRAH",details:"",components:[]}),Me(!0)},className:"bg-slate-900 text-white px-8 py-3 rounded-xl font-bold text-sm flex items-center gap-3 shadow-lg hover:bg-emerald-600 transition-all active:scale-95",children:[t.jsx(Se,{size:18})," تعريف رحلة مجمعة جديدة"]})]}),t.jsx("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6",children:(Ce||[]).filter(e=>e&&($e?!0:!e.isVoided)).map(e=>{const l=(A||[]).filter(p=>p&&p.masterTripId===e.id),d=(T||[]).filter(p=>p&&(l||[]).some(r=>r&&r.id===p.programId)&&!p.isVoided).reduce((p,r)=>p+(r?.adultCount||0)+(r?.childCount||0),0);return t.jsxs("div",{className:`bg-white p-8 rounded-3xl border shadow-sm hover:border-indigo-500 transition-all group relative overflow-hidden ${e.isVoided?"border-rose-200 opacity-75 grayscale-[0.5]":"border-slate-200"}`,children:[t.jsx("div",{className:"absolute top-0 right-0 w-24 h-24 bg-slate-50 rounded-bl-3xl -mr-10 -mt-10 group-hover:bg-emerald-600 transition-colors duration-500"}),t.jsxs("div",{className:"relative z-10",children:[t.jsxs("div",{className:"flex justify-between items-start mb-6",children:[t.jsx("div",{className:`px-4 py-1 rounded-full text-[10px] font-bold ${e.isVoided?"bg-rose-100 text-rose-700":e.type==="HAJJ"?"bg-amber-100 text-amber-700":e.type==="UMRAH"?"bg-emerald-100 text-emerald-700":"bg-slate-100 text-slate-700"}`,children:e.isVoided?"ملغية / محذوفة":e.type==="HAJJ"?"حج":e.type==="UMRAH"?"عمرة":"عام"}),t.jsx("div",{className:"flex gap-2",children:e.isVoided?t.jsx("button",{onClick:()=>sl(e.id),className:"p-2 text-emerald-600 hover:bg-emerald-50 rounded-lg transition-colors",title:"استعادة",children:t.jsx(si,{size:16})}):t.jsxs(t.Fragment,{children:[t.jsx("button",{onClick:()=>Sl(e),className:"p-2 text-slate-400 hover:text-emerald-600 transition-colors",children:t.jsx(xt,{size:16})}),t.jsx("button",{onClick:()=>nl(e.id),className:"p-2 text-slate-400 hover:text-rose-600 transition-colors",children:t.jsx(Pt,{size:16})})]})})]}),t.jsx("h4",{className:"text-xl font-bold text-slate-900 mb-2 group-hover:text-emerald-600 transition-colors",children:e.name}),t.jsxs("div",{className:"flex items-center gap-2 text-slate-400 text-xs font-bold mb-6",children:[t.jsx(tl,{size:14}),e.date]}),t.jsxs("div",{className:"grid grid-cols-2 gap-4 border-t border-slate-100 pt-6",children:[t.jsxs("div",{children:[t.jsx("p",{className:"text-[10px] font-bold text-slate-400 uppercase tracking-widest mb-1",children:"البرامج"}),t.jsx("p",{className:"text-lg font-bold text-slate-900",children:l.length})]}),t.jsxs("div",{children:[t.jsx("p",{className:"text-[10px] font-bold text-slate-400 uppercase tracking-widest mb-1",children:"إجمالي المعتمرين"}),t.jsx("p",{className:"text-lg font-bold text-emerald-600",children:d})]})]}),t.jsxs("div",{className:"mt-6 space-y-2",children:[t.jsx("p",{className:"text-[10px] font-bold text-slate-400 uppercase tracking-widest border-b border-slate-50 pb-1",children:"البرامج المندرجـــة"}),l.length>0?t.jsx("div",{className:"max-h-32 overflow-y-auto space-y-1 pr-1 custom-scrollbar",children:(l||[]).map(p=>t.jsxs("div",{className:"flex justify-between items-center text-[11px] font-bold text-slate-700 bg-slate-50 p-2 rounded-lg border border-slate-100 hover:border-emerald-200 transition-colors",children:[t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsx(Dt,{size:12,className:"text-slate-400"}),t.jsx("span",{className:"truncate max-w-[120px]",children:p?.name||"-"})]}),t.jsx("span",{className:"text-emerald-600 text-[9px] bg-white px-2 py-0.5 rounded border border-slate-200 font-bold",children:N(p?.sellingPrice||0)})]},p?.id))}):t.jsx("p",{className:"text-[10px] text-slate-300 italic py-2",children:"لا توجد برامج مضافة بعد"})]}),t.jsxs("button",{onClick:()=>{Ke(null),b({...st,masterTripId:e.id,type:e.type||"UMRAH",date:e.date,components:e.components||[]}),Ee(!0),at("PROGRAMS")},className:"mt-6 w-full py-3 bg-emerald-50 text-emerald-700 rounded-xl font-bold text-xs flex items-center justify-center gap-2 hover:bg-emerald-600 hover:text-white transition-all border border-emerald-100 shadow-sm",children:[t.jsx(Se,{size:14})," إضافة برنامج لهذه المجموعة"]}),t.jsxs("button",{onClick:()=>al?.(e.id),className:"mt-2 w-full py-3 bg-indigo-50 text-indigo-700 rounded-xl font-bold text-xs flex items-center justify-center gap-2 hover:bg-indigo-600 hover:text-white transition-all border border-indigo-100 shadow-sm",children:[t.jsx(lt,{size:14})," إدارة كشوف التسكين"]}),e.details&&t.jsxs("p",{className:"mt-4 text-[10px] text-slate-400 font-bold line-clamp-1 italic",children:['"',e.details,'"']})]})]},e.id)})}),(Ce||[]).filter(e=>e&&($e?!0:!e.isVoided)).length===0&&t.jsxs("div",{className:"bg-white p-20 rounded-3xl border-4 border-dashed border-slate-200 text-center",children:[t.jsx(nt,{size:64,className:"mx-auto text-slate-200 mb-6"}),t.jsx("h4",{className:"text-2xl font-bold text-slate-400",children:"لا توجد رحلات مجمعة حالياً"}),t.jsx("p",{className:"text-slate-300 font-bold mt-2",children:$e?"جرب إخفاء الرحلات الملغية":"ابدأ بتعريف رحلة أم لربط البرامج والرحلات بها"})]})]}),ge==="VISA_MANAGEMENT"&&t.jsx("div",{className:"space-y-8 animate-in zoom-in-95 duration-500",children:t.jsxs("div",{className:"bg-white p-8 rounded-3xl border border-slate-200 shadow-sm overflow-hidden",children:[t.jsxs("h3",{className:"text-xl font-bold text-slate-900 mb-6 flex items-center gap-3",children:[t.jsx("div",{className:"p-2 bg-emerald-50 text-emerald-600 rounded-lg",children:t.jsx(Ut,{size:20})}),"متابعة إصدار التأشيرات"]}),t.jsx("div",{className:"overflow-x-auto rounded-2xl border border-slate-100",children:t.jsxs("table",{className:"w-full text-right",children:[t.jsx("thead",{children:t.jsxs("tr",{className:"bg-slate-900 text-white",children:[t.jsx("th",{className:"px-8 py-5 text-[11px] font-bold uppercase tracking-widest",children:"العميل"}),t.jsx("th",{className:"px-8 py-5 text-[11px] font-bold uppercase tracking-widest",children:"البرنامج / المكون"}),t.jsx("th",{className:"px-8 py-5 text-[11px] font-bold uppercase tracking-widest text-center",children:"عدد المعتمرين"}),t.jsx("th",{className:"px-8 py-5 text-[11px] font-bold uppercase tracking-widest text-center",children:"تم الإصدار"}),t.jsx("th",{className:"px-8 py-5 text-[11px] font-bold uppercase tracking-widest",children:"الحالة التشغيلية"}),t.jsx("th",{className:"px-8 py-5 text-[11px] font-bold uppercase tracking-widest text-center",children:"التقدم"})]})}),t.jsx("tbody",{className:"divide-y divide-slate-100",children:(T||[]).filter(e=>e&&e.visaStatus&&!e.isVoided).map(e=>{const l=(e?.adultCount||0)+(e?.childCount||0);return t.jsxs("tr",{className:"hover:bg-slate-50 transition-all",children:[t.jsx("td",{className:"px-8 py-5 font-bold text-slate-900",children:(Q||[]).find(d=>d&&d.id===e?.relatedEntityId)?.name||"---"}),t.jsx("td",{className:"px-8 py-5 font-bold text-emerald-600 text-xs",children:e?.description||"---"}),t.jsx("td",{className:"px-8 py-5 text-center font-bold text-slate-900",children:l}),t.jsx("td",{className:"px-8 py-5 text-center",children:t.jsx("input",{type:"number",max:l,min:0,className:"w-16 p-2 bg-slate-50 border border-slate-200 rounded-lg text-center font-bold text-emerald-600 focus:border-indigo-500 outline-none",value:e.visaIssuedCount||0,onChange:d=>{const p=parseInt(d.target.value||"0");je(e.id,{...e,visaIssuedCount:p})}})}),t.jsx("td",{className:"px-8 py-5",children:t.jsxs("select",{className:`px-4 py-1.5 rounded-full text-[10px] font-bold border-none outline-none ${e.visaStatus==="ISSUED"?"bg-emerald-100 text-emerald-700":e.visaStatus==="IN_PROCESS"?"bg-amber-100 text-amber-700":e.visaStatus==="CANCELLED"?"bg-rose-100 text-rose-700":"bg-slate-100 text-slate-700"}`,value:e.visaStatus,onChange:d=>{je(e.id,{...e,visaStatus:d.target.value})},children:[t.jsx("option",{value:"PENDING",children:"قيد الانتظار"}),t.jsx("option",{value:"IN_PROCESS",children:"تحت التنفيذ"}),t.jsx("option",{value:"ISSUED",children:"تم الإصدار ✅"}),t.jsx("option",{value:"CANCELLED",children:"ملغى ❌"})]})}),t.jsx("td",{className:"px-8 py-5 text-center",children:t.jsxs("div",{className:"w-32 mx-auto",children:[t.jsx("div",{className:"w-full bg-slate-100 h-2 rounded-full overflow-hidden",children:t.jsx("div",{className:"bg-indigo-500 h-full transition-all duration-500",style:{width:`${Math.min(100,(e.visaIssuedCount||0)*(1/(l||1))*100)}%`}})}),t.jsxs("p",{className:"text-[9px] font-bold text-slate-400 mt-1",children:[Math.round((e.visaIssuedCount||0)*(1/(l||1))*100),"% مكتمل"]})]})})]},e?.id)})})]})})]})}),ge==="GUARANTEES"&&t.jsx("div",{className:"space-y-8 animate-in zoom-in-95 duration-500",children:t.jsxs("div",{className:"bg-white p-8 rounded-3xl border border-slate-200 shadow-sm overflow-hidden",children:[t.jsxs("h3",{className:"text-xl font-bold text-slate-900 mb-6 flex items-center gap-3",children:[t.jsx("div",{className:"p-2 bg-amber-50 text-amber-600 rounded-lg",children:t.jsx(tt,{size:20})}),"سجل خطابات الضمان والوكلاء (LG)"]}),t.jsx("div",{className:"overflow-x-auto rounded-2xl border border-slate-100",children:t.jsxs("table",{className:"w-full text-right",children:[t.jsx("thead",{children:t.jsxs("tr",{className:"bg-slate-900 text-white",children:[t.jsx("th",{className:"px-8 py-5 text-[11px] font-bold uppercase tracking-widest",children:"التاريخ"}),t.jsx("th",{className:"px-8 py-5 text-[11px] font-bold uppercase tracking-widest",children:"الوكيل المودع لديه"}),t.jsx("th",{className:"px-8 py-5 text-[11px] font-bold uppercase tracking-widest",children:"البرنامج / الرحلة"}),t.jsx("th",{className:"px-8 py-5 text-[11px] font-bold uppercase tracking-widest",children:"المبلغ"}),t.jsx("th",{className:"px-8 py-5 text-[11px] font-bold uppercase tracking-widest",children:"الحالة"}),t.jsx("th",{className:"px-8 py-5 text-[11px] font-bold uppercase tracking-widest text-center",children:"إجراءات"})]})}),t.jsx("tbody",{className:"divide-y divide-slate-100 font-bold",children:(T||[]).filter(e=>e.category==="GUARANTEE_LETTER"&&!e.isVoided).map(e=>{const l=(T||[]).some(p=>p.parentTransactionId===e.id&&!p.isVoided);return e.type==="INCOME"?null:t.jsxs("tr",{className:`hover:bg-slate-50 transition-all ${l?"opacity-50":""}`,children:[t.jsx("td",{className:"px-8 py-5 font-bold text-slate-500 text-xs",children:e.date||"-"}),t.jsx("td",{className:"px-8 py-5 font-bold text-slate-900",children:(O||[]).find(p=>p&&p.id===e.relatedEntityId)?.company||"---"}),t.jsx("td",{className:"px-8 py-5 font-bold text-emerald-600 text-xs",children:(A||[]).find(p=>p&&p.id===e.programId)?.name||"عام / غير محدد"}),t.jsx("td",{className:"px-8 py-5 font-bold text-lg text-slate-900",children:N(e.amount||0)}),t.jsx("td",{className:"px-8 py-5",children:t.jsx("span",{className:`px-4 py-1.5 rounded-full text-[10px] font-bold ${l?"bg-emerald-100 text-emerald-700":"bg-amber-100 text-amber-700"}`,children:l?"تم الاسترداد ✅":"قائم لدى الوكيل ⏳"})}),t.jsx("td",{className:"px-8 py-5 text-center",children:!l&&t.jsx("button",{onClick:()=>Tl(e),className:"bg-indigo-500 text-white px-4 py-2 rounded-xl text-[10px] font-bold hover:bg-emerald-600 transition-all",children:"تأكيد الاسترداد"})})]},e.id)})})]})})]})}),gl&&t.jsx("div",{className:"fixed inset-0 bg-slate-900 bg-opacity-60 backdrop-blur-md z-[120] flex items-center justify-center p-4",children:t.jsxs("div",{className:"bg-white w-full max-w-xl rounded-3xl shadow-2xl overflow-hidden border border-slate-200 animate-in zoom-in-95 duration-300",children:[t.jsxs("div",{className:"p-8 bg-slate-50 border-b border-slate-100 flex justify-between items-center",children:[t.jsxs("div",{className:"flex items-center gap-4",children:[t.jsx("div",{className:"w-12 h-12 bg-slate-900 text-emerald-400 rounded-xl flex items-center justify-center shadow-lg",children:t.jsx(Ut,{size:28})}),t.jsxs("div",{children:[t.jsx("h3",{className:"text-xl font-bold text-slate-900",children:Ze?"تعديل الرحلة الأم":"تعريف رحلة أم جديدة"}),t.jsx("p",{className:"text-slate-400 font-bold text-[10px] uppercase tracking-widest",children:"Create Group Trip * (1 / Master) Trip"})]})]}),t.jsx("button",{onClick:()=>Me(!1),className:"w-12 h-12 bg-white text-slate-400 rounded-xl flex items-center justify-center hover:text-rose-500 transition-all shadow-sm border border-slate-100",children:t.jsx(ze,{size:24})})]}),t.jsxs("form",{onSubmit:fl,className:"p-10 space-y-8",children:[t.jsxs("div",{className:"space-y-6",children:[t.jsxs("div",{className:"space-y-3",children:[t.jsx("label",{className:"text-[11px] font-bold text-slate-500 uppercase tracking-widest px-2",children:"اسم الرحلة (المجموعة)"}),t.jsx("input",{required:!0,className:"w-full p-5 bg-slate-50 border border-slate-200 rounded-2xl font-bold text-xl text-slate-900 focus:border-indigo-600 outline-none transition-all shadow-sm",placeholder:"مثال: عمرة رجب - 22 يناير",value:re.name,onChange:e=>we({...re,name:e.target.value})})]}),t.jsxs("div",{className:"grid grid-cols-2 gap-6",children:[t.jsxs("div",{className:"space-y-3",children:[t.jsx("label",{className:"text-[11px] font-bold text-slate-500 uppercase tracking-widest px-2",children:"تاريخ البداية"}),t.jsx("input",{type:"date",required:!0,className:"w-full p-5 bg-slate-50 border border-slate-200 rounded-2xl font-bold focus:border-indigo-600 outline-none shadow-sm",value:re.date,onChange:e=>we({...re,date:e.target.value})})]}),t.jsxs("div",{className:"space-y-3",children:[t.jsx("label",{className:"text-[11px] font-bold text-slate-500 uppercase tracking-widest px-2",children:"نوع الرحلة"}),t.jsxs("select",{className:"w-full p-5 bg-slate-50 border border-slate-200 rounded-2xl font-bold focus:border-slate-900 outline-none shadow-sm",value:re.type,onChange:e=>we({...re,type:e.target.value}),children:[t.jsx("option",{value:"UMRAH",children:"عمرة"}),t.jsx("option",{value:"HAJJ",children:"حج"}),t.jsx("option",{value:"GENERAL",children:"سياحة عامة"})]})]})]}),t.jsxs("div",{className:"space-y-3",children:[t.jsx("label",{className:"text-[11px] font-bold text-slate-500 uppercase tracking-widest px-2",children:"تفاصيل إضافية"}),t.jsx("textarea",{className:"w-full p-5 bg-slate-50 border border-slate-200 rounded-2xl font-bold focus:border-indigo-600 outline-none min-h-[100px] shadow-sm",value:re.details,onChange:e=>we({...re,details:e.target.value}),placeholder:"أي ملاحظات عامة عن الرحلة..."})]})]}),t.jsxs("div",{className:"flex justify-end gap-6 pt-10 border-t border-slate-100",children:[t.jsx("button",{type:"button",onClick:()=>Me(!1),className:"px-10 py-5 font-bold text-slate-400 hover:text-rose-600 transition-colors",children:"إلغاء"}),t.jsx("button",{type:"submit",className:"bg-slate-900 text-emerald-400 px-16 py-5 rounded-2xl font-bold text-xl shadow-xl hover:bg-emerald-600 hover:text-white transition-all transform active:scale-95",children:"تأكيد التعريف"})]})]})]})}),pl&&t.jsx("div",{className:"fixed inset-0 bg-slate-900 bg-opacity-60 backdrop-blur-md z-[110] flex items-center justify-center p-4",children:t.jsxs("div",{className:"bg-white w-full max-w-2xl rounded-3xl shadow-2xl overflow-hidden border-b-8 border-amber-500 animate-in zoom-in-95 duration-300",children:[t.jsxs("div",{className:"p-8 bg-slate-50 border-b border-slate-100 flex justify-between items-center",children:[t.jsxs("div",{className:"flex items-center gap-4",children:[t.jsx("div",{className:"w-12 h-12 bg-amber-500 rounded-2xl flex items-center justify-center text-white shadow-lg shadow-amber-200",children:t.jsx(tt,{size:28})}),t.jsxs("div",{children:[t.jsx("h3",{className:"text-xl font-bold text-slate-900",children:"دفع خطاب ضمان (LG)"}),t.jsx("p",{className:"text-slate-400 font-bold text-[10px] uppercase",children:"Record New Guarantee Deposit"})]})]}),t.jsx("button",{onClick:()=>dt(!1),className:"w-12 h-12 bg-white text-slate-400 rounded-2xl flex items-center justify-center hover:text-rose-500 hover:rotate-90 transition-all shadow-sm border border-slate-100",children:t.jsx(ze,{size:24})})]}),t.jsxs("form",{onSubmit:vl,className:"p-10 space-y-8",children:[t.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-8",children:[t.jsxs("div",{className:"space-y-3",children:[t.jsx("label",{className:"text-[11px] font-bold text-slate-400 uppercase tracking-widest",children:"الوكيل / المورد"}),t.jsx(W,{options:(O||[]).map(e=>({id:e?.id,name:e?.company,subtext:`رصيد: ${N(e?.balance||0)}`})),value:C.supplierId,onChange:e=>ce({...C,supplierId:e}),placeholder:"اختر الوكيل..."})]}),t.jsxs("div",{className:"space-y-3",children:[t.jsx("label",{className:"text-[11px] font-bold text-slate-400 uppercase tracking-widest",children:"البرنامج (اختياري)"}),t.jsx(W,{options:(A||[]).map(e=>({id:e?.id,name:e?.name,subtext:e?.date})),value:C.programId,onChange:e=>ce({...C,programId:e}),placeholder:"اختر الرحلة..."})]}),t.jsxs("div",{className:"space-y-3",children:[t.jsx("label",{className:"text-[11px] font-bold text-slate-400 uppercase tracking-widest",children:"المبلغ"}),t.jsxs("div",{className:"flex gap-2",children:[t.jsx("input",{type:"number",required:!0,className:"flex-1 p-5 bg-slate-50 border-2 border-slate-100 rounded-2xl font-bold text-2xl text-amber-600 focus:border-amber-500 outline-none transition-all",value:C.amount,onChange:e=>ce({...C,amount:e.target.value})}),t.jsx("select",{className:"w-32 p-5 bg-slate-50 border-2 border-slate-100 rounded-2xl font-bold text-slate-900 focus:border-amber-500 outline-none transition-all",value:C.currencyCode,onChange:e=>{const l=e.target.value,d=(ke||[]).find(p=>p?.code===l)?.rateToMain||1;ce({...C,currencyCode:l,exchangeRate:d.toString()})},children:(ke||[]).map(e=>t.jsx("option",{value:e?.code,children:e?.code},e?.code))})]})]}),t.jsxs("div",{className:"space-y-3",children:[t.jsxs("label",{className:"text-[11px] font-bold text-slate-400 uppercase tracking-widest",children:["سعر الصرف (",D?.baseCurrency||"EGP",")"]}),t.jsx("input",{type:"number",step:"any",disabled:C.currencyCode===(D?.baseCurrency||"EGP"),className:"w-full p-5 bg-slate-50 border-2 border-slate-100 rounded-2xl font-bold text-xl text-slate-900 focus:border-amber-500 outline-none transition-all disabled:opacity-50",value:C.currencyCode===(D?.baseCurrency||"EGP")?"1":C.exchangeRate,onChange:e=>ce({...C,exchangeRate:e.target.value})})]}),t.jsxs("div",{className:"space-y-3",children:[t.jsx("label",{className:"text-[11px] font-bold text-slate-400 uppercase tracking-widest",children:"الدفع من (الخزينة / البنك)"}),t.jsx(W,{options:(bt||[]).map(e=>({id:e?.id,name:e?.name,subtext:`الرصيد: ${N(e?.balance||0)}`})),value:C.treasuryId,onChange:e=>ce({...C,treasuryId:e}),placeholder:"اختر الخزينة..."})]}),_t&&t.jsxs("div",{className:"space-y-3",children:[t.jsx("label",{className:"text-[11px] font-bold text-slate-400 uppercase tracking-widest",children:"مركز التكلفة (اختياري)"}),t.jsx(W,{options:($t||[]).filter(e=>e?.isActive).map(e=>({id:e?.id,name:e?.name})),value:C.costCenterId,onChange:e=>ce({...C,costCenterId:e}),placeholder:"اختر مركز التكلفة..."})]}),t.jsxs("div",{className:"space-y-3",children:[t.jsx("label",{className:"text-[11px] font-bold text-slate-400 uppercase tracking-widest",children:"التاريخ"}),t.jsx("input",{type:"date",className:"w-full p-5 bg-slate-50 border-2 border-slate-100 rounded-2xl font-bold focus:border-amber-500 outline-none",value:C.date,onChange:e=>ce({...C,date:e.target.value})})]}),t.jsxs("div",{className:"space-y-3",children:[t.jsx("label",{className:"text-[11px] font-bold text-slate-400 uppercase tracking-widest",children:"ملاحظات"}),t.jsx("input",{className:"w-full p-5 bg-slate-50 border-2 border-slate-100 rounded-2xl font-bold focus:border-amber-500 outline-none",value:C.details,onChange:e=>ce({...C,details:e.target.value}),placeholder:"رقم الشيك أو تفاصيل إضافية"})]})]}),t.jsxs("div",{className:"flex justify-end gap-6 pt-10 border-t border-slate-100 mt-8",children:[t.jsx("button",{type:"button",onClick:()=>dt(!1),className:"px-10 py-5 font-bold text-slate-400 hover:text-rose-500 transition-colors",children:"إلغاء"}),t.jsx("button",{type:"submit",className:"bg-amber-500 text-white px-20 py-5 rounded-3xl font-bold text-xl shadow-2xl hover:bg-amber-600 transition-all transform hover:scale-105",children:"تأكيد دفع خطاب الضمان"})]})]})]})}),ve&&t.jsx("div",{className:"fixed inset-0 bg-slate-900 bg-opacity-40 backdrop-blur-md z-[100] flex items-center justify-center p-4 md:p-10",children:t.jsxs("div",{className:"bg-white w-full max-w-5xl max-h-[90vh] rounded-3xl shadow-2xl overflow-hidden flex flex-col border-4 border-indigo-500",children:[t.jsxs("div",{className:"p-8 bg-slate-50 border-b flex justify-between items-center no-print",children:[t.jsxs("div",{className:"flex items-center gap-4",children:[t.jsx("div",{className:"w-12 h-12 bg-emerald-600 rounded-xl flex items-center justify-center text-white shadow-lg",children:t.jsx(Wt,{size:24})}),t.jsxs("div",{children:[t.jsx("h3",{className:"text-xl font-bold text-slate-900",children:"كشف تسكين المعتمرين"}),t.jsx("p",{className:"text-xs text-slate-500 font-bold",children:(A||[]).find(e=>e.id===ve)?.name})]})]}),t.jsxs("div",{className:"flex gap-4",children:[t.jsxs("button",{onClick:yl,className:"bg-slate-900 text-emerald-400 px-6 py-3 rounded-xl font-bold flex items-center gap-2 hover:bg-emerald-600 hover:text-white transition-all",children:[t.jsx(ri,{size:18})," طباعة الكشف"]}),t.jsx("button",{onClick:()=>Bt(null),className:"p-3 bg-white border-2 text-slate-400 rounded-xl hover:text-red-500 transition-colors",children:t.jsx(ze,{size:24})})]})]}),t.jsx("div",{id:"rooming-list-to-print",className:"flex-1 overflow-y-auto p-10 print:p-0",children:t.jsxs("div",{className:"space-y-10",children:[t.jsxs("div",{className:"hidden print:block text-center border-b-4 border-slate-900 pb-6 mb-10",children:[t.jsx("h2",{className:"text-3xl font-bold text-slate-900 mb-2",children:(A||[]).find(e=>e.id===ve)?.name}),t.jsx("p",{className:"text-lg font-bold text-slate-600",children:"كشف تسكين الغرف والمنافست"}),t.jsxs("p",{className:"text-sm font-bold text-emerald-600 mt-2",children:["تاريخ الرحلة: ",(A||[]).find(e=>e.id===ve)?.date]})]}),(T||[]).some(e=>e.programId===ve&&["FLIGHT","FLIGHT_REFUND","FLIGHT_REISSUE"].includes(e.category)&&!e.isVoided)&&t.jsxs("div",{className:"space-y-4",children:[t.jsxs("div",{className:"flex items-center gap-3 bg-sky-50 p-4 rounded-2xl border-r-8 border-sky-600 no-print",children:[t.jsx(el,{size:24,className:"text-sky-600"}),t.jsx("h4",{className:"text-lg font-bold text-slate-900",children:"تذاكر الطيران الصادرة لهذا البرنامج"})]}),t.jsx("div",{className:"overflow-x-auto rounded-2xl border-2 border-sky-100",children:t.jsxs("table",{className:"w-full text-right bg-white",children:[t.jsx("thead",{className:"bg-sky-600 text-white text-xs uppercase",children:t.jsxs("tr",{children:[t.jsx("th",{className:"px-6 py-4 font-bold",children:"PNR / البيان"}),t.jsx("th",{className:"px-6 py-4 font-bold",children:"اسم العميل"}),t.jsx("th",{className:"px-6 py-4 font-bold text-center",children:"الحالة"})]})}),t.jsx("tbody",{className:"divide-y divide-sky-100",children:T.filter(e=>e.programId===ve&&["FLIGHT","FLIGHT_REFUND","FLIGHT_REISSUE"].includes(e.category)&&!e.isVoided).map(e=>t.jsxs("tr",{className:"hover:bg-sky-50 transition-colors",children:[t.jsx("td",{className:"px-6 py-4",children:t.jsxs("div",{className:"flex flex-col",children:[t.jsx("span",{className:"font-bold text-slate-900 uppercase",children:e.pnr||"---"}),t.jsx("span",{className:"text-[10px] text-slate-400 font-bold",children:e.description})]})}),t.jsx("td",{className:"px-6 py-4 font-bold text-slate-700",children:(Q||[]).find(l=>l?.id===e?.relatedEntityId)?.name||"---"}),t.jsx("td",{className:"px-6 py-4 text-center",children:t.jsx("span",{className:`px-3 py-1 rounded-lg text-[9px] font-bold ${e.category==="FLIGHT_REFUND"?"bg-rose-100 text-rose-600":e.category==="FLIGHT_REISSUE"?"bg-amber-100 text-amber-600":"bg-emerald-100 text-emerald-600"}`,children:e.category==="FLIGHT_REFUND"?"مسترجع":e.category==="FLIGHT_REISSUE"?"إعادة إصدار":"مؤكد"})})]},e.id))})]})})]}),Object.entries((T||[]).filter(e=>e&&e.programId===ve&&!e.isVoided&&e.type==="INCOME").reduce((e,l)=>{const d=l.accommodation||"تسكين غير محدد";return e[d]||(e[d]=[]),e[d].push(l),e},{})).map(([e,l])=>t.jsxs("div",{className:"space-y-4",children:[t.jsxs("div",{className:"flex items-center gap-3 bg-slate-50 p-4 rounded-2xl border-r-8 border-slate-900",children:[t.jsx(lt,{className:"text-emerald-600",size:24}),t.jsx("h4",{className:"text-lg font-bold text-slate-900",children:e}),t.jsxs("span",{className:"mr-auto bg-white px-4 py-1 rounded-full text-xs font-bold text-emerald-600 border border-emerald-100",children:["عدد الأفراد: ",l.reduce((d,p)=>d+(p.adultCount||0)+(p.childCount||0)+(p.infantCount||0)+(p.supervisorCount||0),0)]})]}),t.jsxs("table",{className:"w-full border-collapse border border-slate-200",children:[t.jsx("thead",{children:t.jsxs("tr",{className:"bg-slate-100 text-slate-600",children:[t.jsx("th",{className:"border p-3 text-right text-xs font-bold",children:"اسم المعتمر / العميل"}),t.jsx("th",{className:"border p-3 text-center text-xs font-bold w-24",children:"نوع الغرفة"}),t.jsx("th",{className:"border p-3 text-center text-xs font-bold w-14",children:"بالغ"}),t.jsx("th",{className:"border p-3 text-center text-xs font-bold w-14",children:"طفل"}),t.jsx("th",{className:"border p-3 text-center text-xs font-bold w-14",children:"رضيع"}),t.jsx("th",{className:"border p-3 text-center text-xs font-bold w-14 text-rose-600",children:"مشرف"}),t.jsx("th",{className:"border p-3 text-right text-xs font-bold",children:"الموظف المسؤول"})]})}),t.jsx("tbody",{children:l.map(d=>t.jsxs("tr",{className:"border-b hover:bg-slate-50 transition-colors",children:[t.jsx("td",{className:"border p-3 font-bold text-slate-900",children:(Q||[]).find(p=>p?.id===d?.relatedEntityId)?.name||"---"}),t.jsx("td",{className:"border p-3 text-center text-[10px] font-bold",children:d.roomType==="SINGLE"?"سنجل":d.roomType==="DOUBLE"?"ثنائي":d.roomType==="TRIPLE"?"ثلاثي":d.roomType==="QUAD"?"رباعي":"---"}),t.jsx("td",{className:"border p-3 text-center font-bold",children:d.adultCount||0}),t.jsx("td",{className:"border p-3 text-center font-bold",children:d.childCount||0}),t.jsx("td",{className:"border p-3 text-center font-bold",children:d.infantCount||0}),t.jsx("td",{className:"border p-3 text-center font-bold text-rose-600",children:t.jsxs("div",{className:"flex flex-col",children:[t.jsx("span",{children:d.supervisorCount||0}),d.supervisorName&&t.jsx("span",{className:"text-[8px] mt-0.5 text-rose-600",children:d.supervisorName})]})}),t.jsx("td",{className:"border p-3 text-sm font-bold text-slate-500",children:(H||[]).find(p=>p?.id===(d.accommodationEmployeeId||d.employeeId))?.name||"---"})]},d.id))})]})]},e))]})})]})}),ml&&t.jsx("div",{className:"fixed inset-0 z-[100] flex items-center justify-center p-4 bg-slate-900/60 backdrop-blur-sm animate-in fade-in duration-300",children:t.jsxs("div",{className:"bg-white w-full max-w-2xl rounded-3xl shadow-2xl overflow-hidden animate-in zoom-in duration-300",children:[t.jsxs("div",{className:"bg-slate-900 p-6 flex justify-between items-center",children:[t.jsxs("div",{className:"flex items-center gap-4 text-white",children:[t.jsx("div",{className:"p-3 bg-amber-500 rounded-xl",children:t.jsx(it,{size:24})}),t.jsxs("div",{children:[t.jsx("h3",{className:"text-xl font-bold",children:"اختيار المكون للارتداد المالي"}),t.jsx("p",{className:"text-slate-400 text-xs font-bold uppercase tracking-widest mt-0.5",children:"يرجى اختيار البند الذي ترغب في عمل ارتداد له"})]})]}),t.jsx("button",{onClick:()=>ut(!1),className:"w-10 h-10 flex items-center justify-center rounded-full bg-white/10 text-white hover:bg-rose-500 transition-all",children:t.jsx(ze,{size:20})})]}),t.jsx("div",{className:"p-6 max-h-[60vh] overflow-y-auto space-y-3",children:(()=>{const l=(T||[]).filter(d=>d.programId===F&&d.supplierId&&!d.isVoided&&(d.type==="EXPENSE"||d.isPurchaseOnly||d.category==="REFUND_SERVICE")).sort((d,p)=>new Date(p.date||0).getTime()-new Date(d.date||0).getTime()).map(d=>{const p=(O||[]).find(g=>g.id===d.supplierId),r=d.category==="REFUND_SERVICE";return t.jsxs("button",{onClick:()=>{ut(!1),Jt(F,d.componentId||"",d.id)},className:`w-full flex items-center justify-between p-5 ${r?"bg-rose-50 border-rose-100 opacity-60":"bg-slate-50 border-slate-200"} hover:bg-indigo-50 border hover:border-indigo-200 rounded-2xl transition-all group`,children:[t.jsxs("div",{className:"flex items-center gap-4",children:[t.jsx("div",{className:`p-3 rounded-xl shadow-sm ${r?"bg-rose-100 text-rose-600":"bg-white text-slate-500 group-hover:bg-indigo-600 group-hover:text-white"} transition-all`,children:d.category==="HOTEL"?t.jsx(lt,{size:20}):d.category==="FLIGHT"||d.category==="FLIGHT_TICKET"?t.jsx(el,{size:20}):d.category==="VISA"?t.jsx(tt,{size:20}):d.category==="REFUND_SERVICE"?t.jsx(it,{size:20}):t.jsx(Dt,{size:20})}),t.jsxs("div",{className:"text-right",children:[t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsx("h4",{className:"font-bold text-slate-900 group-hover:text-indigo-600 transition-all text-right",children:d.description?.replace("شراء مكون:","")?.split("-")?.[0]?.trim()||d.description||"مكون غير معروف"}),r&&t.jsx("span",{className:"text-[8px] bg-rose-200 text-rose-700 px-1 rounded font-bold",children:"ارتداد سابق"})]}),t.jsxs("div",{className:"flex flex-col text-right",children:[t.jsxs("p",{className:"text-xs font-bold text-slate-400 mt-0.5",children:["المورد: ",t.jsx("span",{className:"text-slate-600",children:p?.company||"---"})]}),t.jsxs("p",{className:"text-[10px] text-slate-400 font-bold",children:[d.date," | ",N(d.amount*d.exchangeRate)]})]})]})]}),t.jsx(ai,{className:"text-slate-300 group-hover:text-indigo-600 transition-all",size:20})]},d.id)});return l.length>0?l:t.jsxs("div",{className:"text-center py-10",children:[t.jsx(Zt,{size:48,className:"mx-auto text-slate-200 mb-4"}),t.jsx("p",{className:"text-slate-400 font-bold",children:"لا توجد عمليات شراء مسجلة لهذا البرنامج"})]})})()}),t.jsx("div",{className:"p-6 bg-slate-50 border-t border-slate-100 flex justify-end",children:t.jsx("button",{onClick:()=>ut(!1),className:"px-6 py-2 rounded-xl font-bold text-slate-500 hover:bg-slate-200 transition-all",children:"إغلاق"})})]})})]})};export{Ti as default};
