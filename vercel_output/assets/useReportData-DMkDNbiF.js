import{c as v,r as M,k}from"./index-C_wh12VC.js";const H=[["path",{d:"M21 12c.552 0 1.005-.449.95-.998a10 10 0 0 0-8.953-8.951c-.55-.055-.998.398-.998.95v8a1 1 0 0 0 1 1z",key:"pzmjnu"}],["path",{d:"M21.21 15.89A10 10 0 1 1 8 2.83",key:"k2fpak"}]],V=v("chart-pie",H);const G=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["circle",{cx:"12",cy:"12",r:"6",key:"1vlfrh"}],["circle",{cx:"12",cy:"12",r:"2",key:"1c9p78"}]],j=v("target",G),B=(a,d,m)=>{const n=a?.openingBalance||0,N=a?.openingBalanceInBase||0;return n!==0&&a?.openingBalanceCurrency===d?N/(n||1):(m||[]).find(r=>r.code===d)?.rateToMain||1},F=(a,d,m,n,N)=>M.useMemo(()=>{const r=(d||[]).find(o=>o.id===m);if(!r)return null;const c=(a||[]).filter(o=>o&&!o.isVoided&&o.costCenterId===r.id&&o.date>=n&&o.date<=N),A=c.filter(o=>o&&(o.type==="INCOME"||o.type==="REVENUE_ONLY")).reduce((o,b)=>o+Number(b.amountInBase||0),0),T=c.filter(o=>o&&(o.type==="EXPENSE"||o.type==="PURCHASE_ONLY")).reduce((o,b)=>o+Number(b.amountInBase||0),0)+c.filter(o=>o&&o.type==="INCOME").reduce((o,b)=>o+Number(b.purchasePriceInBase||b.purchasePrice||0),0),C=c.filter(o=>o&&(o.type==="INCOME"||o.type==="REVENUE_ONLY")).reduce((o,b)=>o+Number(b.adultCount||0)+Number(b.childCount||0)+Number(b.infantCount||0)+Number(b.supervisorCount||0)||1,0),i=c.filter(o=>o&&(o.type==="INCOME"||o.type==="REVENUE_ONLY")).reduce((o,b)=>o+Number(b.supervisorCount||0),0),u={};return c.forEach(o=>{const b=o.programId||"GENERAL",h=o.programName||(b==="GENERAL"?"عمليات عامة":b);u[b]||(u[b]={id:b,name:h,revenue:0,cost:0,bookings:0,supervisors:0});const f=Number(o.amountInBase||0);o.type==="INCOME"||o.type==="REVENUE_ONLY"?(u[b].revenue+=f,u[b].cost+=Number(o.purchasePriceInBase||o.purchasePrice||0),u[b].bookings+=Number(o.adultCount||0)+Number(o.childCount||0)+Number(o.infantCount||0)+Number(o.supervisorCount||0)||1,u[b].supervisors+=Number(o.supervisorCount||0)):(o.type==="EXPENSE"||o.type==="PURCHASE_ONLY")&&(u[b].cost+=f)}),{revenue:A,cost:T,profit:A-T,bookings:C,supervisors:i,programs:Object.values(u)}},[a,d,n,N]),x=(a,d)=>M.useMemo(()=>{const m={};return(a||[]).forEach(n=>{m[n.id]={id:n.id,name:n.name,type:n.type,revenue:0,cost:0,bookings:0,revenueBreakdown:{bookings:0,flight:0,other:0},costBreakdown:{purchase:0,expenses:0,flights:0}}}),(d||[]).forEach(n=>{if(n&&n.programId){m[n.programId]||(m[n.programId]={id:n.programId,name:n.programName||n.programId,type:"UNKNOWN",revenue:0,cost:0,bookings:0,revenueBreakdown:{bookings:0,flight:0,other:0},costBreakdown:{purchase:0,expenses:0,flights:0}});const N=Number(n.amountInBase||0);if(n.type==="INCOME"||n.type==="REVENUE_ONLY"){if(m[n.programId].revenue+=N,n.category==="HAJJ_UMRAH"?m[n.programId].revenueBreakdown.bookings+=N:n.category==="FLIGHT"||n.category==="FLIGHT_REFUND"||n.category==="FLIGHT_REISSUE"?m[n.programId].revenueBreakdown.flight+=N:m[n.programId].revenueBreakdown.other+=N,n.type==="INCOME"&&!n.isSaleOnly){const r=Number(n.purchasePriceInBase||n.purchasePrice||0);m[n.programId].cost+=r,m[n.programId].costBreakdown.purchase+=r}m[n.programId].bookings+=Number(n.adultCount||0)+Number(n.childCount||0)+Number(n.infantCount||0)+Number(n.supervisorCount||0)||1}else(n.type==="EXPENSE"||n.type==="PURCHASE_ONLY")&&(m[n.programId].cost+=N,n.category==="EXPENSE_GEN"||n.category==="DOUBTFUL_DEBT"?m[n.programId].costBreakdown.expenses+=N:n.category==="FLIGHT"||n.category==="FLIGHT_REFUND"||n.category==="FLIGHT_REISSUE"?m[n.programId].costBreakdown.flights+=N:m[n.programId].costBreakdown.purchase+=N)}}),Object.values(m).filter(n=>n.revenue>0||n.cost>0)},[a,d]),$=(a,d,m,n,N,r,c,A,T,C=[])=>M.useMemo(()=>{const i={},u=new Map,o=new Map,b=new Map,h=new Set,f=new Set;return(C||[]).forEach(e=>{if(e&&e.journalEntryId){u.has(e.journalEntryId)||u.set(e.journalEntryId,new Set);let t=e.type||"NORMAL";e.isSaleOnly&&(t="REVENUE_ONLY"),e.isPurchaseOnly&&(t="PURCHASE_ONLY"),u.get(e.journalEntryId).add(t),e.programId&&(o.set(e.journalEntryId,e.programId),e.isPurchaseOnly&&h.add(e.programId)),e.masterTripId&&b.set(e.journalEntryId,e.masterTripId),e.isPurchaseOnly&&e.category&&f.add(e.category)}}),(d||[]).forEach(e=>{const t=e.openingBalanceCurrency||"EGP",E=B(e,t,c),R=Number(e.openingBalanceInBase||0),s=(Number(e.openingBalanceInBase||0)||Number(e.openingBalance||0)*E)/E;i[`CUSTOMER-${e.id}`]={id:e.id,name:e.name,type:"CUSTOMER",debit:R>0?R:0,credit:R<0?Math.abs(R):0,periodDebit:0,periodCredit:0,balanceInAccountCurrency:s}}),(m||[]).forEach(e=>{const t=e.openingBalanceCurrency||"EGP",E=B(e,t,c),R=Number(e.openingBalanceInBase||0),s=(Number(e.openingBalanceInBase||0)||Number(e.openingBalance||0)*E)/E;i[`SUPPLIER-${e.id}`]={id:e.id,name:e.company||e.name,type:"SUPPLIER",debit:R<0?Math.abs(R):0,credit:R>0?R:0,periodDebit:0,periodCredit:0,balanceInAccountCurrency:s}}),(n||[]).forEach(e=>{const t=Number(e.openingBalance||0);i[`PARTNER-${e.id}`]={id:e.id,name:e.name,type:"PARTNER",debit:t<0?Math.abs(t):0,credit:t>0?t:0,periodDebit:0,periodCredit:0,balanceInAccountCurrency:t}}),(N||[]).forEach(e=>{const t=Number(e.openingBalance||0),E=Number(e.openingAdvances||0);t!==0&&(i[`LIABILITY-${e.id}`]={id:e.id,name:`مستحقات: ${e.name}`,type:"LIABILITY",debit:t<0?Math.abs(t):0,credit:t>0?t:0,periodDebit:0,periodCredit:0,balanceInAccountCurrency:t}),E!==0&&(i[`EMPLOYEE_ADVANCE-${e.id}`]={id:e.id,name:`سلف: ${e.name}`,type:"EMPLOYEE_ADVANCE",debit:E>0?E:0,credit:E<0?Math.abs(E):0,periodDebit:0,periodCredit:0,balanceInAccountCurrency:E})}),(r||[]).forEach(e=>{const t=Number(e.openingBalance||0);i[`TREASURY-${e.id}`]={id:e.id,name:e.name,type:"TREASURY",debit:t>0?t:0,credit:t<0?Math.abs(t):0,periodDebit:0,periodCredit:0,balanceInAccountCurrency:t}}),(a||[]).forEach(e=>{if(e.date<=T){const t=u.get(e.id)||new Set(["NORMAL"]),E=t.has("PURCHASE_ONLY"),R=t.has("REVENUE_ONLY");o.get(e.id),!E&&!R&&((e.lines||[]).some(s=>s.accountId==="FLIGHT_COST"),(e.lines||[]).some(s=>s.accountId==="HAJJ_UMRAH_COST")),(e.lines||[]).forEach(s=>{const l=`${s.accountType}-${s.accountId}`;i[l]||(i[l]={id:s.accountId,name:s.accountName||s.accountId,type:s.accountType,debit:0,credit:0,periodDebit:0,periodCredit:0,balanceInAccountCurrency:0}),i[l].debit+=Number(s.debit||0),i[l].credit+=Number(s.credit||0);const p=s.accountType==="CUSTOMER"?d.find(I=>I.id===s.accountId):s.accountType==="SUPPLIER"?m.find(I=>I.id===s.accountId):s.accountType==="PARTNER"?n.find(I=>I.id===s.accountId):s.accountType==="LIABILITY"||s.accountType==="EMPLOYEE_ADVANCE"?N.find(I=>I.id===s.accountId):s.accountType==="TREASURY"?r.find(I=>I.id===s.accountId):null;if(p){const I=p.openingBalanceCurrency||"EGP",g=B(p,I,c),y=s.currencyCode===I&&s.originalAmount?Number(s.debit)>0?Math.abs(Number(s.originalAmount)):-Math.abs(Number(s.originalAmount)):(Number(s.debit||0)-Number(s.credit||0))/g;["CUSTOMER","TREASURY","EMPLOYEE_ADVANCE","ASSET"].includes(s.accountType)?i[l].balanceInAccountCurrency+=y:i[l].balanceInAccountCurrency-=y}e.date>=A&&(i[l].periodDebit+=Number(s.debit||0),i[l].periodCredit+=Number(s.credit||0))})}}),Object.values(i).filter(e=>e.debit!==0||e.credit!==0)},[a,d,m,n,N,r,c,A,T,C]),X=(a,d=[])=>M.useMemo(()=>{const m=["SALARY","RENT","OFFICE","EXPENSE_GEN","MARKETING","COMMISSION_EXP","UTILITIES","MAINTENANCE","INTERNET","HOSPITALITY","STATIONERY","FEES","TAXES","INSURANCE","رواتب","أجور","إيجار","كهرباء","مياه","غاز","هاتف","اتصالات","دعاية","إعلان","مكتبية","مطبوعات","بوفيه","ضيافة","نثريات","أخرى","صيانة","عمولات موظفين","بريد","انترنت"];let n=0,N=0,r=0,c=0,A=0,T=0,C=0;(d||[]).forEach(h=>{const f=h.lines||[],t=f.filter(E=>E.accountType==="REVENUE").map(E=>Number(E.credit||0)).filter(E=>E>0);f.forEach(E=>{const R=Number(E.credit||0)-Number(E.debit||0),s=Number(E.debit||0)-Number(E.credit||0),l=(E.accountId||"").toUpperCase(),p=E.accountName||"";if(!(l.includes("CUSTOMER")||l.includes("SUPPLIER")||l.includes("TREASURY")||l.includes("PARTNER")||l.includes("CASH")||l.includes("SETTLEMENT")||p.includes("تسوية")||p.includes("نقدية"))){if(E.accountType==="REVENUE")l.includes("FLIGHT")||p.includes("طيران")?n+=R:l.includes("HAJJ")||l.includes("UMRAH")||p.includes("حج")||p.includes("عمرة")?N+=R:r+=R;else if(E.accountType==="EXPENSE")if(m.some(y=>l.includes(y.toUpperCase())||p.includes(y)))C+=s;else{if(t.some(L=>Math.abs(L-s)<.1))return;l.includes("FLIGHT")||p.includes("طيران")?c+=s:l.includes("HAJJ")||l.includes("UMRAH")||p.includes("حج")||p.includes("عمرة")?A+=s:T+=s}}})});const i=n+N+r;let u=c+A+T;const o=i-u,b=o-C;return{totalRevenues:i,totalDirectCosts:u,grossProfit:o,adminExpenses:C,netProfit:b,totalSales:i,totalCost:u+C,expenses:C,flightRevenue:n,hajjUmrahRevenue:N,serviceRevenue:r,flightCost:c,hajjUmrahCost:A,serviceCost:T,operatingProfit:b}},[a,d]),J=a=>M.useMemo(()=>{const d=a.filter(r=>["TREASURY","CUSTOMER","EMPLOYEE_ADVANCE","ASSET"].includes(r.type)).reduce((r,c)=>r+(Number(c.debit||0)-Number(c.credit||0)),0),m=a.filter(r=>["SUPPLIER","LIABILITY"].includes(r.type)).reduce((r,c)=>r+(Number(c.credit||0)-Number(c.debit||0)),0),n=a.filter(r=>["PARTNER","EQUITY"].includes(r.type)).reduce((r,c)=>r+(Number(c.credit||0)-Number(c.debit||0)),0),N=a.reduce((r,c)=>c.type==="REVENUE"?r+(Number(c.credit||0)-Number(c.debit||0)):c.type==="EXPENSE"?r-(Number(c.debit||0)-Number(c.credit||0)):r,0);return{assets:d,liabilities:m,partnersEquity:n,currentNetProfit:N,totalEquity:n+N}},[a]),q=(a,d,m)=>M.useMemo(()=>{const n={};(a||[]).forEach(r=>{n[r.id]={id:r.id,name:r.name,type:r.type,revenue:0,cost:0,bookings:0,programs:[]}});const N=new Map;return(m||[]).forEach(r=>{r.journalEntryId&&r.masterTripId&&N.set(r.journalEntryId,r.masterTripId)}),(d||[]).forEach(r=>{const c=N.get(r.id);if(c&&n[c]){const A=r.lines.find(i=>i.accountId==="HAJJ_UMRAH_REVENUE"),T=r.lines.find(i=>i.accountId==="HAJJ_UMRAH_COST"),C=A&&T&&Math.abs(Number(A.credit||0)-Number(T.debit||0))<.1;r.lines.forEach(i=>{if(i.accountType==="REVENUE")n[c].revenue+=Number(i.credit||0)-Number(i.debit||0);else if(i.accountType==="EXPENSE"&&!["SALARY","RENT","OFFICE"].includes(i.accountId)){if(i.accountId==="HAJJ_UMRAH_COST"&&C)return;n[c].cost+=Number(i.debit||0)-Number(i.credit||0)}else i.accountType==="ASSET"&&i.accountId==="ASSET_GUARANTEES"&&(n[c].cost+=Number(i.debit||0)-Number(i.credit||0))})}}),(m||[]).forEach(r=>{r&&r.masterTripId&&n[r.masterTripId]&&((r.type==="INCOME"||r.type==="REVENUE_ONLY")&&(n[r.masterTripId].bookings+=Number((r.adultCount||0)+(r.childCount||0)+(r.infantCount||0)+(r.supervisorCount||0)||1)),r.programId&&!n[r.masterTripId].programs.includes(r.programId)&&n[r.masterTripId].programs.push(r.programId))}),Object.values(n).filter(r=>r.revenue>0||r.cost>0)},[a,d,m]),z=(a,d,m,n,N)=>M.useMemo(()=>{const r=new Date(N),c=(A,T)=>(A||[]).map(C=>{const u=n[`${T}-${C.id}`]?.base||0,o={current:0,30:0,60:0,over90:0,total:u};if(u<=0)return{...C,...o};const b=(m||[]).filter(f=>f.date<=N&&f.lines&&f.lines.some(e=>e.accountId===C.id&&e.accountType===T)).map(f=>{const e=f.lines.find(t=>t.accountId===C.id&&t.accountType===T);return{date:new Date(f.date),amount:e?Number(T==="CUSTOMER"?e.debit||0:e.credit||0):0}}).filter(f=>f.amount>0).sort((f,e)=>e.date.getTime()-f.date.getTime());let h=u;return b.forEach(f=>{if(h<=0)return;const e=Math.floor((r.getTime()-f.date.getTime())/(1e3*60*60*24)),t=Math.min(f.amount,h);e<=30?o.current+=t:e<=60?o[30]+=t:e<=90?o[60]+=t:o.over90+=t,h-=t}),h>0&&(o.over90+=h),{...C,...o}}).filter(C=>(C.total||0)>0);return{customers:c(a,"CUSTOMER"),suppliers:c(d,"SUPPLIER")}},[a,d,m,n,N]),K=(a,d,m,n)=>M.useMemo(()=>{const N=[{name:"الطيران",profit:a.flightRevenue-a.flightCost},{name:"الحج والعمرة",profit:a.hajjUmrahRevenue-a.hajjUmrahCost},{name:"الخدمات العامة",profit:a.serviceRevenue-a.serviceCost}],r=(d||[]).filter(c=>n.role==="ADMIN"||k(c.name,n.name)).map(c=>{const A=(m||[]).filter(i=>i&&i.employeeId===c.id),T=A.reduce((i,u)=>i+Number(u.amountInBase||(u.sellingPrice||0)*(u.exchangeRate||1)),0),C=A.reduce((i,u)=>{if(u.commissionAmount&&u.commissionAmount>0)return i+Number(u.commissionAmount);if(u.applyCommission===!1)return i;const o=Number(u.employeeCommissionRate&&u.employeeCommissionRate!==0?u.employeeCommissionRate:d.find(E=>E.id===u.employeeId)?.commissionRate||0);if(!o)return i;const b=Number(u.exchangeRate||1),h=(Number(u.sellingPrice||0)-Number(u.discount||0))*b,f=Number(u.purchasePrice||(u.type==="PURCHASE_ONLY"||u.isPurchaseOnly?u.amount:0)||0)*b;let e=0;const t=h-f;return t>0?e=t*(o/100):f>0&&(u.type==="PURCHASE_ONLY"||u.isPurchaseOnly)&&(e=f*(o/100)),i+e},0);return{id:c.id,name:c.name,volume:T,commission:C}}).sort((c,A)=>A.volume-c.volume);return{profitByService:N,employeePerf:r}},[a,d,m,n]),Q=(a,d,m,n,N,r,c,A,T,C,i,u,o=[])=>{const b=()=>{if(!d)return 0;if(a==="TREASURY_REPORT"){const g=(i||[]).find(L=>L.id===d);if(!g)return 0;let y=0;return(m||[]).forEach(L=>{L.date<n&&(L.lines||[]).forEach(O=>{O.accountId===d&&O.accountType==="TREASURY"&&(y+=Number(O.debit||0)-Number(O.credit||0))})}),Number(g.openingBalance||0)+y}const h=a==="CUSTOMER_LEDGER",f=a==="EMPLOYEE_LEDGER",e=a==="PARTNER_LEDGER",t=a==="EMPLOYEE_ADVANCE",E=h?"CUSTOMER":f?"LIABILITY":e?"PARTNER":t?"EMPLOYEE_ADVANCE":"SUPPLIER",R=h?(c||[]).find(g=>g.id===d):f||t?(T||[]).find(g=>g.id===d):e?(C||[]).find(g=>g.id===d):(A||[]).find(g=>g.id===d);if(!R)return 0;const s=R.openingBalanceCurrency||"EGP",l=B(R,s,u);let p=0;(m||[]).forEach(g=>{g&&g.date<n&&(g.lines||[]).forEach(y=>{if(y&&y.accountId===d&&y.accountType===E){const L=y.currencyCode===s&&y.originalAmount?Number(y.originalAmount):Number(y.debit||y.credit)/l;Number(y.debit)>0?p+=L:p-=L}})});let I=0;return E==="CUSTOMER"||E==="SUPPLIER"?I=Number(R.openingBalanceInBase||R.openingBalance||0)/l:E==="PARTNER"||E==="LIABILITY"?I=Number(R.openingBalance||0)/l:E==="EMPLOYEE_ADVANCE"&&(I=Number(R.openingAdvances||0)/l),E==="CUSTOMER"||E==="EMPLOYEE_ADVANCE"?I+p:I-p};return M.useMemo(()=>{if(!d)return{entries:[],openingBalance:0};const h=b(),f=a==="TREASURY_REPORT",e=[];if(f)(m||[]).forEach(p=>{if(p&&p.date>=n&&p.date<=N){const I=(p.lines||[]).find(g=>g.accountId===d&&g.accountType==="TREASURY");if(I){if(r){const g=r.toLowerCase();if(!((p.description||"").toLowerCase().includes(g)||(p.refNo||"").toLowerCase().includes(g)))return}e.push({date:p.date||"",description:p.description||"",refNo:p.refNo||"",debit:Number(I.debit||0),credit:Number(I.credit||0),id:p.id,type:Number(I.debit||0)>0?"INCOME":"EXPENSE",costCenterId:I.costCenterId,programId:I.programId})}}});else{const p=a==="CUSTOMER_LEDGER",I=a==="EMPLOYEE_LEDGER",g=a==="PARTNER_LEDGER",y=a==="EMPLOYEE_ADVANCE",L=p?"CUSTOMER":I?"LIABILITY":g?"PARTNER":y?"EMPLOYEE_ADVANCE":"SUPPLIER",O=p?(c||[]).find(P=>P.id===d):I||y?(T||[]).find(P=>P.id===d):g?(C||[]).find(P=>P.id===d):(A||[]).find(P=>P.id===d),_=O?.openingBalanceCurrency||"EGP",D=B(O,_,u);(m||[]).forEach(P=>{if(P&&P.date>=n&&P.date<=N){const S=(P.lines||[]).find(U=>U.accountId===d&&U.accountType===L);if(S){if(r){const Y=r.toLowerCase();if(!((P.description||"").toLowerCase().includes(Y)||(P.refNo||"").toLowerCase().includes(Y)))return}const U=S.currencyCode===_&&S.originalAmount?Number(S.originalAmount):Number(S.debit||S.credit)/D;e.push({date:P.date||"",description:P.description||"",refNo:P.refNo||"",debit:Number(S.debit)>0?U:0,credit:Number(S.credit)>0?U:0,id:P.id,type:Number(S.debit)>0?"DEBIT":"CREDIT",costCenterId:S.costCenterId,programId:S.programId})}}})}const t=e.sort((p,I)=>(p?.date||"").localeCompare(I?.date||""));let E=h;const R=a==="CUSTOMER_LEDGER",s=a==="EMPLOYEE_ADVANCE";return{entries:t.map(p=>(f||R||s?E+=p.debit-p.credit:E+=p.credit-p.debit,{...p,runningBalance:E})),openingBalance:h}},[m,d,n,N,a,r,u,c,A,T,C,i,o])};export{V as C,j as T,X as a,J as b,x as c,F as d,q as e,z as f,K as g,Q as h,$ as u};
