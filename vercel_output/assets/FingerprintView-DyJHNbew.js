import{c as g,r as o,j as e,o as X,V as Z,f as ee,H as I,m as te,U as $,w as se}from"./index-C_wh12VC.js";import{D as ae}from"./download-CBXj3I91.js";const re=[["rect",{width:"18",height:"18",x:"3",y:"4",rx:"2",key:"1hopcy"}],["path",{d:"M16 2v4",key:"4m81vk"}],["path",{d:"M3 10h18",key:"8toen8"}],["path",{d:"M8 2v4",key:"1cmpym"}],["path",{d:"M17 14h-6",key:"bkmgh3"}],["path",{d:"M13 18H7",key:"bb0bb7"}],["path",{d:"M7 14h.01",key:"1qa3f1"}],["path",{d:"M17 18h.01",key:"1bdyru"}]],ne=g("calendar-range",re);const ie=[["rect",{width:"7",height:"7",x:"3",y:"3",rx:"1",key:"1g98yp"}],["rect",{width:"7",height:"7",x:"3",y:"14",rx:"1",key:"1bb6yr"}],["path",{d:"M14 4h7",key:"3xa0d5"}],["path",{d:"M14 9h7",key:"1icrd9"}],["path",{d:"M14 15h7",key:"1mj8o2"}],["path",{d:"M14 20h7",key:"11slyb"}]],le=g("layout-list",ie);const ce=[["path",{d:"M5 5a2 2 0 0 1 3.008-1.728l11.997 6.998a2 2 0 0 1 .003 3.458l-12 7A2 2 0 0 1 5 19z",key:"10ikf1"}]],de=g("play",ce);const oe=[["path",{d:"M12 20h.01",key:"zekei9"}],["path",{d:"M8.5 16.429a5 5 0 0 1 7 0",key:"1bycff"}],["path",{d:"M5 12.859a10 10 0 0 1 5.17-2.69",key:"1dl1wf"}],["path",{d:"M19 12.859a10 10 0 0 0-2.007-1.523",key:"4k23kn"}],["path",{d:"M2 8.82a15 15 0 0 1 4.177-2.643",key:"1grhjp"}],["path",{d:"M22 8.82a15 15 0 0 0-11.288-3.764",key:"z3jwby"}],["path",{d:"m2 2 20 20",key:"1ooewy"}]],xe=g("wifi-off",oe);const pe=[["path",{d:"M12 20h.01",key:"zekei9"}],["path",{d:"M2 8.82a15 15 0 0 1 20 0",key:"dnpr2z"}],["path",{d:"M5 12.859a10 10 0 0 1 14 0",key:"1x1e6c"}],["path",{d:"M8.5 16.429a5 5 0 0 1 7 0",key:"1bycff"}]],A=g("wifi",pe),f=typeof window<"u"&&!!window.process&&window.process.type==="renderer",me=()=>{try{if(f&&window.require)return window.require("electron").ipcRenderer}catch{}return null},l=me(),fe=({logs:v,setLogs:w,employees:M,shifts:G})=>{const[b,O]=o.useState({ip:"192.168.1.201",port:4370}),[c,N]=o.useState("DISCONNECTED"),[F,W]=o.useState([]),[k,j]=o.useState(!1),[u,C]=o.useState(!1),[p,z]=o.useState("SUMMARY"),[m,L]=o.useState({from:new Date(new Date().setDate(new Date().getDate()-30)).toISOString().split("T")[0],to:new Date().toISOString().split("T")[0]}),[T,P]=o.useState("");o.useEffect(()=>{if(l){const t=(s,a)=>{w(r=>r.some(i=>i.deviceUserId==a.deviceUserId&&i.recordTime===a.recordTime)?r:[a,...r])};return l.on("fp-realtime-log",t),()=>{l.removeListener("fp-realtime-log",t)}}},[w]);const H=async()=>{if(!l)return;N("CONNECTING");const t=await l.invoke("fp-connect",b);t.success?N("CONNECTED"):(N("DISCONNECTED"),alert("فشل الاتصال: "+t.error))},B=async()=>{l&&(await l.invoke("fp-disconnect"),N("DISCONNECTED"),C(!1))},V=async()=>{if(!l||c!=="CONNECTED")return;j(!0);const t=await l.invoke("fp-get-logs");if(t.success){const s=await l.invoke("db-load");s.success&&s.data.attendanceLogs&&w(s.data.attendanceLogs)}else alert("خطأ في سحب السجلات: "+t.error);j(!1)},q=async()=>{if(!l||c!=="CONNECTED")return;j(!0);const t=await l.invoke("fp-get-users");t.success?W(t.data):alert("خطأ في سحب المستخدمين: "+t.error),j(!1)},Y=()=>{!l||c!=="CONNECTED"||(u?C(!1):(l.send("fp-setup-realtime"),C(!0)))},E=t=>{if(!t)return"---";const s=(M||[]).find(r=>r?.fingerprintId===t.toString());if(s)return s.name||"---";const a=(F||[]).find(r=>r?.uid==t);return a?a.name||"---":"موظف "+t},R=(v||[]).filter(t=>{if(!t?.recordTime)return!1;try{const s=new Date(t.recordTime).toISOString().split("T")[0],a=E(t.deviceUserId),r=s>=(m?.from||"")&&s<=(m?.to||""),n=(a||"").toLowerCase().includes((T||"").toLowerCase())||(t.deviceUserId||"").toString().includes(T||"");return r&&n}catch{return!1}}),U=[...R||[]].sort((t,s)=>{const a=t?.recordTime?new Date(t.recordTime).getTime():0;return(s?.recordTime?new Date(s.recordTime).getTime():0)-a}),y=()=>{const t={};return(R||[]).forEach(s=>{if(!(!s?.recordTime||!s?.deviceUserId))try{const a=new Date(s.recordTime);if(isNaN(a.getTime()))return;const r=a.toLocaleDateString("en-CA"),n=`${s.deviceUserId}_${r}`;if(!t[n]){const i=(M||[]).find(x=>x?.fingerprintId===s.deviceUserId.toString()),d=i&&i.shiftId?(G||[]).find(x=>x?.id===i.shiftId):null;t[n]={userId:s.deviceUserId,userName:E(s.deviceUserId),date:r,times:[],ip:s.ip,shift:d}}t[n].times.push(a)}catch{}}),Object.values(t||{}).sort((s,a)=>{const r=s?.date?new Date(s.date).getTime():0,n=a?.date?new Date(a.date).getTime():0;return n!==r?n-r:(a?.userId||"").toString().localeCompare((s?.userId||"").toString())})},K=()=>{let t="\uFEFF";t+=`الموظف,رقم البصمة,التاريخ,تسجيل الحضور,تسجيل الخروج,الجهاز
`,(y()||[]).forEach(i=>{const d=(i.times||[]).sort((D,S)=>D-S);if(d.length===0)return;const x=d[0].toLocaleTimeString("ar-EG"),h=d.length>1?d[d.length-1].toLocaleTimeString("ar-EG"):"---";t+=`"${i.userName}","${i.userId}","${i.date}","${x}","${h}","${i.ip}"
`});const a=new Blob([t],{type:"text/csv;charset=utf-8;"}),r=document.createElement("a"),n=URL.createObjectURL(a);r.setAttribute("href",n),r.setAttribute("download",`attendance_report_${new Date().toISOString().split("T")[0]}.csv`),r.style.visibility="hidden",document.body.appendChild(r),r.click(),document.body.removeChild(r)};return e.jsxs("div",{className:"p-6 space-y-6 animate-in fade-in duration-500 text-right",dir:"rtl",children:[!f&&e.jsxs("div",{className:"bg-amber-50 border border-amber-200 p-4 rounded-2xl flex items-center gap-4 text-amber-800 shadow-sm",children:[e.jsx(X,{className:"text-amber-500 shrink-0",size:24}),e.jsxs("div",{children:[e.jsx("p",{className:"font-black text-sm",children:"تنبيه: أنت تستخدم نسخة الويب"}),e.jsx("p",{className:"text-xs font-bold opacity-80",children:"الاتصال المباشر بجهاز البصمة (K14 Pro) يتطلب تشغيل البرنامج من خلال تطبيق سطح المكتب."})]})]}),e.jsxs("div",{className:"flex items-center justify-between bg-white p-6 rounded-3xl border border-slate-200 shadow-sm",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"w-12 h-12 bg-indigo-50 text-indigo-600 rounded-2xl flex items-center justify-center",children:e.jsx(Z,{size:28})}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-xl font-black text-slate-900",children:"إدارة جهاز البصمة"}),e.jsx("p",{className:"text-sm font-bold text-slate-500",children:"التحكم في جهاز K14 Pro وسحب بيانات الحضور"})]})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs("div",{className:`flex items-center gap-2 px-4 py-2 rounded-xl border ${c==="CONNECTED"?"bg-indigo-50 border-indigo-100 text-indigo-600":c==="CONNECTING"?"bg-amber-50 border-amber-100 text-amber-600":"bg-slate-50 border-slate-100 text-slate-400"}`,children:[c==="CONNECTED"?e.jsx(A,{size:18}):e.jsx(xe,{size:18}),e.jsx("span",{className:"text-xs font-black",children:c==="CONNECTED"?"متصل بالجهاز":c==="CONNECTING"?"جاري الاتصال...":"غير متصل"})]}),c==="CONNECTED"?e.jsx("button",{onClick:B,className:"px-4 py-2 bg-rose-50 text-rose-600 rounded-xl font-bold text-xs hover:bg-rose-100 transition-colors",children:"قطع الاتصال"}):e.jsx("button",{onClick:H,disabled:c==="CONNECTING"||!f,className:`px-6 py-2 rounded-xl font-bold text-xs transition-colors disabled:opacity-50 ${f?"bg-slate-900 text-white hover:bg-slate-800":"bg-slate-200 text-slate-400 cursor-not-allowed"}`,children:f?"اتصال الآن":"غير متاح بالمتصفح"})]})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"bg-white p-6 rounded-3xl border border-slate-200 shadow-sm",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-6",children:[e.jsx(ee,{size:18,className:"text-slate-400"}),e.jsx("h3",{className:"text-sm font-black text-slate-800",children:"إعدادات الاتصال"})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-[10px] font-black text-slate-400 uppercase mb-1 mr-1",children:"عنوان IP الجهاز"}),e.jsx("input",{type:"text",value:b.ip,onChange:t=>O({...b,ip:t.target.value}),className:"w-full bg-slate-50 border-none rounded-xl px-4 py-3 text-sm font-bold text-slate-900 focus:ring-2 focus:ring-indigo-500 transition-all"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-[10px] font-black text-slate-400 uppercase mb-1 mr-1",children:"المنفذ (Port)"}),e.jsx("input",{type:"number",value:b.port,onChange:t=>O({...b,port:parseInt(t.target.value)}),className:"w-full bg-slate-50 border-none rounded-xl px-4 py-3 text-sm font-bold text-slate-900 focus:ring-2 focus:ring-indigo-500 transition-all"})]})]})]}),e.jsxs("div",{className:"bg-white p-6 rounded-3xl border border-slate-200 shadow-sm",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-6",children:[e.jsx(de,{size:18,className:"text-slate-400"}),e.jsx("h3",{className:"text-sm font-black text-slate-800",children:"عمليات سريعة"})]}),e.jsxs("div",{className:"grid grid-cols-1 gap-3",children:[e.jsxs("button",{onClick:V,disabled:c!=="CONNECTED"||k,className:"flex items-center justify-between p-4 bg-slate-50 rounded-2xl hover:bg-indigo-50 hover:text-indigo-600 transition-all group disabled:opacity-50",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 bg-white rounded-xl flex items-center justify-center border border-slate-200 shadow-sm group-hover:border-indigo-100",children:e.jsx(I,{size:18})}),e.jsxs("div",{className:"text-right",children:[e.jsx("p",{className:"text-xs font-black",children:"سحب السجلات"}),e.jsx("p",{className:"text-[10px] font-bold text-slate-400",children:"تحميل حركات الحضور"})]})]}),e.jsx(te,{size:16,className:k?"animate-spin":""})]}),e.jsxs("button",{onClick:q,disabled:c!=="CONNECTED"||k,className:"flex items-center justify-between p-4 bg-slate-50 rounded-2xl hover:bg-indigo-50 hover:text-indigo-600 transition-all group disabled:opacity-50",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 bg-white rounded-xl flex items-center justify-center border border-slate-200 shadow-sm group-hover:border-indigo-100",children:e.jsx($,{size:18})}),e.jsxs("div",{className:"text-right",children:[e.jsx("p",{className:"text-xs font-black",children:"المستخدمين"}),e.jsx("p",{className:"text-[10px] font-bold text-slate-400",children:"قائمة الأسماء على الجهاز"})]})]}),e.jsx(se,{size:16})]}),e.jsxs("button",{onClick:Y,disabled:c!=="CONNECTED",className:`flex items-center justify-between p-4 rounded-2xl transition-all group disabled:opacity-50 ${u?"bg-amber-50 text-amber-600":"bg-slate-50 hover:bg-amber-50 hover:text-amber-600"}`,children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 bg-white rounded-xl flex items-center justify-center border border-slate-200 shadow-sm group-hover:border-amber-100",children:e.jsx(A,{size:18,className:u?"animate-pulse":""})}),e.jsxs("div",{className:"text-right",children:[e.jsx("p",{className:"text-xs font-black",children:"المراقبة اللحظية"}),e.jsx("p",{className:"text-[10px] font-bold text-slate-400",children:u?"قيد التشغيل الآن":"تشغيل المراقبة المباشرة"})]})]}),e.jsx("div",{className:`w-2 h-2 rounded-full ${u?"bg-amber-500 animate-ping":"bg-slate-300"}`})]})]})]})]}),e.jsx("div",{className:"lg:col-span-2 space-y-6",children:e.jsxs("div",{className:"bg-white rounded-3xl border border-slate-200 shadow-sm overflow-hidden",children:[e.jsxs("div",{className:"p-6 border-b border-slate-100 flex items-center justify-between bg-slate-50/50",children:[e.jsxs("div",{className:"flex items-center gap-6",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 bg-white rounded-xl flex items-center justify-center border border-slate-200 shadow-sm",children:e.jsx(I,{size:20,className:"text-slate-400"})}),e.jsx("h3",{className:"text-sm font-black text-slate-800",children:"حركات الحضور"})]}),e.jsxs("div",{className:"flex items-center gap-2 bg-white px-4 py-1.5 rounded-xl border border-slate-200 shadow-sm",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("label",{className:"text-[9px] font-black text-slate-400",children:"من"}),e.jsx("input",{type:"date",value:m.from,onChange:t=>L({...m,from:t.target.value}),className:"text-[10px] font-bold border-none p-0 focus:ring-0 cursor-pointer"})]}),e.jsx("div",{className:"w-px h-4 bg-slate-200 mx-1"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("label",{className:"text-[9px] font-black text-slate-400",children:"إلى"}),e.jsx("input",{type:"date",value:m.to,onChange:t=>L({...m,to:t.target.value}),className:"text-[10px] font-bold border-none p-0 focus:ring-0 cursor-pointer"})]})]}),e.jsxs("div",{className:"flex bg-white p-1 rounded-xl border border-slate-200 shadow-sm",children:[e.jsxs("button",{onClick:()=>z("SUMMARY"),className:`px-4 py-1.5 rounded-lg text-[10px] font-black transition-all flex items-center gap-2 ${p==="SUMMARY"?"bg-indigo-600 text-white":"text-slate-400 hover:text-slate-600"}`,children:[e.jsx(ne,{size:14})," ملخص الحضور والاصراف"]}),e.jsxs("button",{onClick:()=>z("RAW"),className:`px-4 py-1.5 rounded-lg text-[10px] font-black transition-all flex items-center gap-2 ${p==="RAW"?"bg-indigo-600 text-white":"text-slate-400 hover:text-slate-600"}`,children:[e.jsx(le,{size:14})," الحركات الخام"]})]}),e.jsxs("div",{className:"relative group",children:[e.jsx($,{className:"absolute right-4 top-1/2 -translate-y-1/2 text-slate-400 group-focus-within:text-indigo-600 transition-colors",size:14}),e.jsx("input",{type:"text",placeholder:"بحث باسم الموظف أو الرقم...",value:T,onChange:t=>P(t.target.value),className:"pr-10 pl-4 py-1.5 bg-white border border-slate-200 rounded-xl focus:border-indigo-600 outline-none font-bold text-[10px] shadow-sm transition-all placeholder:text-slate-400 w-48"})]})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs("button",{onClick:K,className:"flex items-center gap-2 bg-indigo-600 text-white px-4 py-2 rounded-xl text-xs font-black hover:bg-indigo-700 transition-all shadow-sm",children:[e.jsx(ae,{size:16})," تصدير إكسل (CSV)"]}),e.jsxs("span",{className:"text-[10px] font-black bg-white px-3 py-1 rounded-full border border-slate-200 text-slate-500",children:[p==="RAW"?(v||[]).length:(y()||[]).length," ",p==="RAW"?"حركة":"يوم عمل"]})]})]}),e.jsx("div",{className:"max-h-[600px] overflow-y-auto custom-scrollbar",children:e.jsxs("table",{className:"w-full text-right",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"bg-white text-slate-400 border-b border-slate-100",children:[e.jsx("th",{className:"px-6 py-4 text-[10px] font-black uppercase tracking-widest",children:"المستخدم"}),e.jsx("th",{className:"px-6 py-4 text-[10px] font-black uppercase tracking-widest",children:"رقم البصمة"}),p==="RAW"?e.jsxs(e.Fragment,{children:[e.jsx("th",{className:"px-6 py-4 text-[10px] font-black uppercase tracking-widest text-center",children:"التاريخ والوقت"}),e.jsx("th",{className:"px-6 py-4 text-[10px] font-black uppercase tracking-widest text-left",children:"الجهاز"})]}):e.jsxs(e.Fragment,{children:[e.jsx("th",{className:"px-6 py-4 text-[10px] font-black uppercase tracking-widest text-center",children:"التاريخ"}),e.jsx("th",{className:"px-6 py-4 text-[10px] font-black uppercase tracking-widest text-center",children:"تسجيل الحضور"}),e.jsx("th",{className:"px-6 py-4 text-[10px] font-black uppercase tracking-widest text-center",children:"تسجيل الخروج"}),e.jsx("th",{className:"px-6 py-4 text-[10px] font-black uppercase tracking-widest text-left",children:"الحالة"})]})]})}),e.jsx("tbody",{className:"divide-y divide-slate-50",children:p==="RAW"?(U||[]).length>0?(U||[]).map((t,s)=>e.jsxs("tr",{className:"hover:bg-slate-50/50 transition-colors group",children:[e.jsx("td",{className:"px-6 py-4",children:e.jsx("span",{className:"text-xs font-black text-slate-900",children:E(t.deviceUserId)})}),e.jsx("td",{className:"px-6 py-4",children:e.jsxs("span",{className:"text-[10px] font-bold bg-slate-100 text-slate-600 px-2 py-1 rounded-md",children:["ID: ",t.deviceUserId]})}),e.jsx("td",{className:"px-6 py-4 text-center",children:e.jsx("span",{className:"text-xs font-bold text-slate-500",children:new Date(t.recordTime||0).toLocaleString("ar-EG")})}),e.jsx("td",{className:"px-6 py-4 text-left",children:e.jsx("span",{className:"text-[10px] font-bold text-slate-400",children:t.ip})})]},s)):e.jsx(_,{}):(y()||[]).length>0?(y()||[]).map((t,s)=>{const a=(t.times||[]).sort((x,h)=>x-h);if(a.length===0)return null;const r=a[0],n=a.length>1?a[a.length-1]:null;let i=n?"مكتمل":"حضور فقط",d=n?"bg-indigo-500":"bg-amber-500";if(t?.shift){const h=(t.shift.startTime||"00:00").split(":"),D=parseInt(h[0])||0,S=parseInt(h[1])||0,Q=r.getHours(),J=r.getMinutes();Q*60+J-(D*60+S)>(t.shift.gracePeriod||0)&&(i="تأخير",d="bg-rose-500")}return e.jsxs("tr",{className:"hover:bg-slate-50/50 transition-colors group",children:[e.jsx("td",{className:"px-6 py-4",children:e.jsx("span",{className:"text-xs font-black text-slate-900",children:t.userName})}),e.jsx("td",{className:"px-6 py-4",children:e.jsxs("span",{className:"text-[10px] font-bold bg-slate-100 text-slate-600 px-2 py-1 rounded-md",children:["ID: ",t.userId]})}),e.jsx("td",{className:"px-6 py-4 text-center",children:e.jsx("span",{className:"text-xs font-bold text-slate-500",children:t.date})}),e.jsx("td",{className:"px-6 py-4 text-center",children:e.jsx("span",{className:"text-xs font-black text-indigo-600 bg-indigo-50 px-3 py-1 rounded-lg",children:r.toLocaleTimeString("ar-EG",{hour:"2-digit",minute:"2-digit"})})}),e.jsx("td",{className:"px-6 py-4 text-center",children:n?e.jsx("span",{className:"text-xs font-black text-indigo-600 bg-indigo-50 px-3 py-1 rounded-lg",children:n.toLocaleTimeString("ar-EG",{hour:"2-digit",minute:"2-digit"})}):e.jsx("span",{className:"text-[10px] font-bold text-slate-300 italic",children:"لا يوجد خروج"})}),e.jsx("td",{className:"px-6 py-4 text-left",children:e.jsx("span",{className:`text-[9px] font-black px-2 py-0.5 rounded-full text-white ${d}`,children:i})})]},s)}):e.jsx(_,{})})]})})]})})]})]})},_=()=>e.jsx("tr",{children:e.jsx("td",{colSpan:6,className:"px-6 py-20 text-center",children:e.jsxs("div",{className:"flex flex-col items-center gap-3",children:[e.jsx("div",{className:"w-16 h-16 bg-slate-50 rounded-2xl flex items-center justify-center text-slate-200",children:e.jsx(I,{size:32})}),e.jsx("p",{className:"text-slate-400 font-bold text-sm",children:"لا توجد سجلات لعرضها حالياً"})]})})});export{fe as default};
