import{c as Z,r as d,k as Pe,j as t,P as re,m as B,o as Se,X as Te,i as S,l as ke,B as Fe,h as oe}from"./index-D5SAcJeb.js";import{B as ie}from"./ban-Cmi2X8G8.js";import{P as Ue}from"./plus-BF-0wA7Y.js";import{P as Ae}from"./percent-BheMet7L.js";import{A as Le}from"./award-C3CFWn7Q.js";import{C as $e}from"./calendar-D1O96ZoP.js";import{L as ne}from"./layers-CL93vmD0.js";import{C as De}from"./calculator-DtoQFCRR.js";import{P as Me}from"./pen-D_z02ClP.js";const ze=[["path",{d:"M6 22a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h8a2.4 2.4 0 0 1 1.704.706l3.588 3.588A2.4 2.4 0 0 1 20 8v12a2 2 0 0 1-2 2z",key:"1oefj6"}],["path",{d:"M14 2v5a1 1 0 0 0 1 1h5",key:"wfsgrz"}],["path",{d:"M12 12v6",key:"3ahymv"}],["path",{d:"m15 15-3-3-3 3",key:"15xj92"}]],Ge=Z("file-up",ze);const He=[["path",{d:"M2 9a3 3 0 0 1 0 6v2a2 2 0 0 0 2 2h16a2 2 0 0 0 2-2v-2a3 3 0 0 1 0-6V7a2 2 0 0 0-2-2H4a2 2 0 0 0-2 2Z",key:"qn84l0"}],["path",{d:"M13 5v2",key:"dyzc3o"}],["path",{d:"M13 17v2",key:"1ont0d"}],["path",{d:"M13 11v2",key:"1wjjxi"}]],K=Z("ticket",He);const We=[["path",{d:"M9 14 4 9l5-5",key:"102s5s"}],["path",{d:"M4 9h10.5a5.5 5.5 0 0 1 5.5 5.5a5.5 5.5 0 0 1-5.5 5.5H11",key:"f3b9sd"}]],de=Z("undo-2",We),Je=({transactions:C,journalEntries:q,addTransaction:ce,updateTransaction:pe,deleteTransaction:V,customers:h,suppliers:M,treasuries:me,currencies:T,employees:f,programs:z,masterTrips:ue,currentUser:g,searchTerm:G="",formatCurrency:x,costCenters:xe,enableCostCenters:ge,initialEditingId:H,onClearInitialEdit:X,settings:k})=>{const b=g?.permissions?.includes("HIDE_FINANCIAL_AMOUNTS"),F=g?.role==="BOOKING_EMPLOYEE",Y=b||F,W=d.useMemo(()=>{const e={},a={};return(h||[]).forEach(l=>{l?.id&&(e[l.id]=l.openingBalanceInBase||0)}),(M||[]).forEach(l=>{l?.id&&(a[l.id]=l.openingBalanceInBase||0)}),(q||[]).forEach(l=>{(l?.lines||[]).forEach(r=>{r&&(r.accountType==="CUSTOMER"&&r.accountId&&e[r.accountId]!==void 0?e[r.accountId]+=(r.debit||0)-(r.credit||0):r.accountType==="SUPPLIER"&&r.accountId&&a[r.accountId]!==void 0&&(a[r.accountId]+=(r.credit||0)-(r.debit||0)))})}),{customers:e,suppliers:a}},[h,M,q]),[be,N]=d.useState(!1),[y,U]=d.useState([]),[he,A]=d.useState(!1),[_,O]=d.useState(""),[i,j]=d.useState("NEW"),[u,J]=d.useState(null),[c,L]=d.useState(null),[fe,Q]=d.useState(null),ee=d.useRef(null),Ne=e=>{const a=e.target.files?.[0];if(!a)return;const l=new FileReader;l.onload=r=>{const m=r.target?.result||"";ye(m)},l.readAsText(a),e.target&&(e.target.value="")},ye=e=>{if(!e)return;const a=e.split("\r").join("").split(`
`);let l="",r="",m=0,I=0,D=0,R="EGP",E="",w="",v=[];for(const n of a)if(n){if(n.startsWith("M1")&&(l=n.substring(2,8).trim()),n.startsWith("T-K")&&(r=n.substring(3,5).trim()),n.startsWith("K-T")&&(w=n.substring(3).trim()),n.startsWith("T-")&&!n.startsWith("T-K")){const P=n.match(/[A-Z]{3}/g);P&&P.forEach(p=>{p&&!v.includes(p)&&v.push(p)})}if(n.startsWith("N-")&&!E&&(E=n.substring(2).trim().split(" ").filter(Boolean).join(" ")),n.startsWith("K-F")){const p=n.substring(3).trim().match(/([A-Z]{3})?\s*([0-9.]+)/);p&&(p[1]&&(R=p[1]),I=parseFloat(p[2]))}if(n.startsWith("K-FT")){const p=n.substring(4).trim().match(/([A-Z]{3})?\s*([0-9.]+)/);p&&(m=parseFloat(p[2]))}if(n.startsWith("K-TX")){const p=n.substring(4).trim().match(/([A-Z]{3})?\s*([0-9.]+)/);p&&(D+=parseFloat(p[2]))}}if(m===0&&I>0&&(m=I+D),!l){const n=e.match(/M1([A-Z0-9]{6})/);n&&(l=n[1])}if(!r){const n=e.match(/T-K([A-Z0-9]{2})/);n&&(r=n[1])}const le=e.match(/AMD\s+([A-Z0-9]{6})/);le&&(l=le[1]),l||r||w?(o({...s,pnr:l||s.pnr,ticketNumber:w||s.ticketNumber,passengerName:E||s.passengerName,route:v.join("-")||s.route,airlineCode:r||s.airlineCode,purchasePrice:m>0?m.toString():s.purchasePrice,sellingPrice:m>0?(m+100).toString():s.sellingPrice,currencyCode:R}),j("NEW"),N(!0)):alert("تعذر قراءة بيانات تذكرة صالحة من الملف. يرجى التأكد أنه ملف AIR الخاص بـ Amadeus.")};d.useEffect(()=>{if(H){const e=(C||[]).find(a=>a?.id===H);e&&(Q(e.id),setTimeout(()=>{const a=document.getElementById(`flight-${e.id}`);a&&(a.scrollIntoView({behavior:"smooth",block:"center"}),setTimeout(()=>Q(null),3e3))},500)),X?.()}},[H,C,X]);const te=()=>{const e=(_||"").toLowerCase(),a=(C||[]).find(l=>l&&l.pnr?.toLowerCase()===e&&["FLIGHT","FLIGHT_REFUND","FLIGHT_REISSUE"].includes(l.category));a?(ae(a),A(!1),O("")):confirm("لم يتم العثور على تذكرة بهذا الرقم في سجلات السنة الحالية. هل تريد فتح نموذج استرجاع يدوي (لتذكرة قديمة)؟")&&(se(_),A(!1),O(""))},se=e=>{L(null),j("REFUND"),o({customerId:"",supplierId:"",supplierType:"SUPPLIER",employeeId:"",pnr:(e||"").toUpperCase(),ticketNumber:"",passengerName:"",route:"",airlineCode:"",currencyCode:"EGP",exchangeRate:"1",purchasePrice:"",sellingPrice:"",discount:"0",employeeCommissionRate:"",commissionAmount:"",applyCommission:!0,date:new Date().toISOString().split("T")[0],programId:"",componentId:"",masterTripId:"",costCenterId:""}),N(!0)},[s,o]=d.useState({customerId:"",supplierId:"",supplierType:"SUPPLIER",employeeId:"",pnr:"",ticketNumber:"",passengerName:"",route:"",airlineCode:"",currencyCode:"EGP",exchangeRate:"1",purchasePrice:"",sellingPrice:"",discount:"0",employeeCommissionRate:"",commissionAmount:"",applyCommission:!0,date:new Date().toISOString().split("T")[0],programId:"",componentId:"",masterTripId:"",costCenterId:""});d.useEffect(()=>{if(!u&&i==="NEW"){const e=(T||[]).find(a=>a?.code===s.currencyCode);e&&o(a=>({...a,exchangeRate:(e.rateToMain||1).toString()}))}},[s.currencyCode,T,u,i]),d.useEffect(()=>{if(F&&!s.employeeId&&!u&&g?.employeeId)o(e=>({...e,employeeId:g.employeeId||""}));else if(F&&!s.employeeId&&!u){const e=(f||[]).find(a=>a&&Pe(a.name||"",g?.name||""));e&&o(a=>({...a,employeeId:e.id}))}},[F,g,f,s.employeeId,u]),d.useEffect(()=>{if(s.employeeId&&!u&&!s.employeeCommissionRate){const e=(f||[]).find(a=>a?.id===s.employeeId);e&&o(a=>({...a,employeeCommissionRate:(e.commissionRate||0).toString()}))}},[s.employeeId,f,u]);const je=e=>{J(e.id),j("NEW"),o({customerId:e.relatedEntityId||"",supplierId:e.supplierId||"",supplierType:e.supplierType||"SUPPLIER",employeeId:e.employeeId||"",pnr:e.pnr||"",ticketNumber:e.ticketNumber||"",passengerName:e.passengerName||"",route:e.route||"",airlineCode:e.airlineCode||"",currencyCode:e.currencyCode||"EGP",exchangeRate:(e.exchangeRate||1).toString(),purchasePrice:(e.purchasePrice||0).toString(),sellingPrice:(e.sellingPrice||0).toString(),discount:(e.discount||0).toString(),employeeCommissionRate:(e.employeeCommissionRate||0).toString(),commissionAmount:e.commissionAmount?.toString()||"",applyCommission:e.applyCommission??!0,date:e.date,programId:e.programId||"",componentId:e.componentId||"",masterTripId:e.masterTripId||"",costCenterId:e.costCenterId||""}),N(!0)},ae=e=>{L(e),j("REFUND"),o({...s,customerId:e.relatedEntityId||"",supplierId:e.supplierId||"",supplierType:e.supplierType||"SUPPLIER",pnr:e.pnr||"",ticketNumber:e.ticketNumber||"",passengerName:e.passengerName||"",route:e.route||"",airlineCode:e.airlineCode||"",purchasePrice:e.purchasePrice?.toString()||"",sellingPrice:e.sellingPrice?.toString()||"",discount:(e.discount||0).toString(),employeeId:e.employeeId||"",employeeCommissionRate:"0",commissionAmount:"",applyCommission:!0,programId:e.programId||"",masterTripId:e.masterTripId||"",costCenterId:e.costCenterId||""}),N(!0)},Ie=e=>{L(e),j("REISSUE"),o({...s,customerId:e.relatedEntityId||"",supplierId:e.supplierId||"",supplierType:e.supplierType||"SUPPLIER",pnr:e.pnr||"",ticketNumber:e.ticketNumber||"",passengerName:e.passengerName||"",route:e.route||"",airlineCode:e.airlineCode||"",purchasePrice:"",sellingPrice:"",discount:"0",employeeId:e.employeeId||"",employeeCommissionRate:e.employeeCommissionRate?.toString()||"0",commissionAmount:"",applyCommission:!0,programId:e.programId||"",masterTripId:e.masterTripId||"",costCenterId:e.costCenterId||""}),N(!0)},ve=e=>{e.preventDefault();let a="",l="FLIGHT";const r=(s.pnr||"").trim().toUpperCase();i==="REFUND"?(a=`استرجاع (Refund) - PNR: ${r} - ${c?`الأصل: ${c.id}`:"تذكرة قديمة"}`,l="FLIGHT_REFUND"):i==="REISSUE"?(a=`إعادة إصدار (Reissue) - PNR: ${r} - الأصل: ${c?.id||"غير معروف"}`,l="FLIGHT_REISSUE"):(a=`حجز طيران - PNR: ${r} (${s.airlineCode||""})`,l="FLIGHT");const m=parseFloat(s.exchangeRate||"1")||1,I=parseFloat(s.sellingPrice||"0")||0,D=parseFloat(s.purchasePrice||"0")||0,R=parseFloat(s.discount||"0")||0,E=parseFloat(s.employeeCommissionRate||"0")||0,w=parseFloat(s.commissionAmount||"0")||0,v={description:a,amount:0,currencyCode:s.currencyCode||k?.baseCurrency||"EGP",exchangeRate:m,type:"INCOME",category:l,date:s.date||new Date().toISOString().split("T")[0],relatedEntityId:s.customerId,relatedEntityType:"CUSTOMER",supplierId:s.supplierId,supplierType:s.supplierType,employeeId:s.employeeId,employeeCommissionRate:E,commissionAmount:w,applyCommission:!!s.applyCommission,pnr:r,ticketNumber:s.ticketNumber,passengerName:s.passengerName,route:s.route,airlineCode:s.airlineCode,purchasePrice:D,sellingPrice:I,discount:R,parentTransactionId:c?.id,amountInBase:(I-R)*m,programId:s.programId||void 0,componentId:s.componentId||void 0,masterTripId:s.masterTripId||void 0,costCenterId:s.costCenterId||void 0};u?pe(u,v):ce(v),Ce()},Ce=()=>{N(!1),J(null),L(null),j("NEW"),o({customerId:"",supplierId:"",supplierType:"SUPPLIER",employeeId:"",pnr:"",ticketNumber:"",passengerName:"",route:"",airlineCode:"",currencyCode:k?.baseCurrency||"EGP",exchangeRate:"1",purchasePrice:"",sellingPrice:"",discount:"0",employeeCommissionRate:"",commissionAmount:"",applyCommission:!0,date:new Date().toISOString().split("T")[0],programId:"",componentId:"",masterTripId:"",costCenterId:""})},Re=()=>{const e=$||[];y.length===e.length?U([]):U(e.map(a=>a?.id).filter(Boolean))},Ee=e=>{U(a=>a.includes(e)?a.filter(l=>l!==e):[...a,e])},we=()=>{confirm(`هل أنت متأكد من حذف ${y.length} من العمليات المحددة؟`)&&(y.forEach(e=>e&&V(e)),U([]))},$=d.useMemo(()=>(C||[]).filter(e=>e&&["FLIGHT","FLIGHT_REFUND","FLIGHT_REISSUE"].includes(e.category)).filter(e=>{if(!G)return!0;const a=G.toLowerCase(),l=(h||[]).find(r=>r&&r.id===e.relatedEntityId);return(e.description||"").toLowerCase().includes(a)||(e.refNo||"").toLowerCase().includes(a)||(e.pnr||"").toLowerCase().includes(a)||(l?.name||"").toLowerCase().includes(a)}).sort((e,a)=>(a?.date||"").localeCompare(e?.date||"")),[C,G,h]);return t.jsxs("div",{className:"space-y-10 animate-in fade-in slide-in-from-bottom-6 duration-1000",children:[t.jsxs("div",{className:"flex flex-col lg:flex-row justify-between items-center bg-white p-10 rounded-3xl shadow-sm border border-slate-100 relative overflow-hidden group",children:[t.jsx("div",{className:"absolute top-0 right-0 w-80 h-80 bg-indigo-500 bg-opacity-5 rounded-full blur-[100px] -mr-40 -mt-40"}),t.jsxs("div",{className:"flex items-center gap-8 relative z-10",children:[t.jsx("div",{className:"w-20 h-20 bg-indigo-600 rounded-2xl flex items-center justify-center shadow-lg transform -rotate-3 group-hover:rotate-0 transition-all duration-500",children:t.jsx(re,{size:40,className:"text-white"})}),t.jsxs("div",{children:[t.jsx("h2",{className:"text-3xl lg:text-4xl font-bold text-slate-900 tracking-tight",children:"تذاكر الطيران"}),t.jsx("p",{className:"text-indigo-600 font-bold text-sm uppercase tracking-widest mt-1",children:"إدارة الحجوزات والاسترجاع"})]})]}),t.jsxs("div",{className:"flex flex-wrap justify-center gap-4 mt-8 lg:mt-0 relative z-10",children:[t.jsx("input",{type:"file",ref:ee,onChange:Ne,accept:".air,.txt",className:"hidden"}),t.jsxs("button",{onClick:()=>ee.current?.click(),className:"bg-indigo-50 text-indigo-700 px-8 py-4 rounded-2xl font-bold text-lg flex items-center gap-3 hover:bg-indigo-100 transition-all active:scale-95 border border-indigo-100 shadow-sm",children:[t.jsx(Ge,{size:24})," استيراد AIR"]}),y.length>0&&g.role==="ADMIN"&&t.jsxs("button",{onClick:we,className:"bg-rose-500 text-white px-8 py-4 rounded-2xl font-bold text-lg flex items-center gap-3 shadow-lg hover:bg-rose-600 transition-all active:scale-95 h-fit animate-in zoom-in",children:[t.jsx(ie,{size:24})," حذف (",y.length,")"]}),t.jsxs("div",{className:"flex flex-col gap-2",children:[t.jsxs("button",{onClick:()=>A(!0),className:"bg-slate-100 text-slate-900 px-8 py-4 rounded-2xl font-bold text-lg flex items-center gap-3 hover:bg-slate-200 transition-all active:scale-95",children:[t.jsx(B,{size:24,className:"text-rose-600"})," استرجاع تذكرة قديمة"]}),t.jsxs("button",{onClick:()=>se(""),className:"text-slate-400 text-[10px] font-bold flex items-center justify-center gap-2 hover:text-rose-600 transition-all",children:[t.jsx(Se,{size:12})," إضافة يدوية مباشرة بدون بحث"]})]}),t.jsxs("button",{onClick:()=>{j("NEW"),N(!0)},className:"bg-indigo-600 text-white px-10 py-4 rounded-2xl font-bold text-lg flex items-center gap-3 shadow-lg hover:bg-indigo-700 transition-all active:scale-95 h-fit",children:[t.jsx(Ue,{size:28})," إصدار تذكرة جديدة"]})]})]}),he&&t.jsxs("div",{className:"bg-white p-10 rounded-3xl border border-indigo-200 shadow-xl animate-in zoom-in duration-300",children:[t.jsxs("div",{className:"flex justify-between items-center mb-8",children:[t.jsxs("h3",{className:"text-2xl font-bold text-slate-900 flex items-center gap-3",children:[t.jsx(K,{className:"text-indigo-600",size:28})," البحث عن تذكرة برقم الـ PNR"]}),t.jsx("button",{onClick:()=>A(!1),className:"p-2 bg-slate-50 rounded-full hover:bg-slate-100 transition-all text-slate-400",children:t.jsx(Te,{size:20})})]}),t.jsxs("div",{className:"flex flex-col md:flex-row gap-4",children:[t.jsx("input",{className:"flex-1 p-5 bg-slate-50 border border-slate-200 focus:border-indigo-600 rounded-2xl font-bold text-2xl text-center uppercase outline-none transition-all placeholder:text-slate-300",placeholder:"PNR CODE",value:_,onChange:e=>O(e.target.value),onKeyDown:e=>e.key==="Enter"&&te()}),t.jsx("button",{onClick:te,className:"bg-slate-900 text-white px-10 py-5 rounded-2xl font-bold text-lg hover:bg-slate-800 transition-all active:scale-95",children:"بحث وجلب البيانات"})]})]}),be&&t.jsxs("div",{className:`bg-white p-10 rounded-3xl border shadow-xl animate-in zoom-in duration-200 ${i==="REFUND"?"border-rose-200 bg-rose-50 bg-opacity-10":i==="REISSUE"?"border-indigo-200 bg-indigo-50 bg-opacity-10":"border-slate-100"}`,children:[t.jsxs("div",{className:"mb-8 flex items-center justify-between",children:[t.jsxs("div",{className:"flex items-center gap-4",children:[t.jsx("div",{className:`w-1.5 h-8 rounded-full ${i==="REFUND"?"bg-rose-500":"bg-indigo-600"}`}),t.jsx("h3",{className:"text-xl font-bold text-slate-900",children:i==="REFUND"?"عملية استرجاع (Refund)":i==="REISSUE"?"إعادة إصدار (Reissue)":u?"تعديل بيانات الحجز":"إصدار حجز طيران جديد"})]}),c&&t.jsxs("div",{className:"bg-slate-50 px-4 py-1.5 rounded-xl border border-slate-100",children:[t.jsx("p",{className:"text-[9px] font-bold text-slate-400 uppercase tracking-tighter",children:"مرتبط بالحجز الأصلي"}),t.jsxs("p",{className:"text-xs font-bold text-slate-700",children:["PNR: ",c.pnr]})]})]}),t.jsxs("form",{onSubmit:ve,className:"space-y-8",children:[t.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-6",children:[t.jsxs("div",{className:"space-y-2",children:[t.jsx("label",{className:"text-xs font-bold text-slate-500 uppercase",children:"رقم الحجز"}),t.jsx("input",{required:!0,readOnly:i!=="NEW"&&c!==null,className:`w-full p-4 border rounded-2xl font-bold text-xl text-center uppercase outline-none transition-all ${i==="NEW"||c===null?"bg-slate-50 border-slate-200 focus:border-indigo-600 focus:bg-white":"bg-slate-100 text-slate-400 border-transparent cursor-not-allowed"}`,placeholder:"PNR",value:s.pnr,onChange:e=>o({...s,pnr:e.target.value})})]}),t.jsxs("div",{className:"space-y-2",children:[t.jsx("label",{className:"text-xs font-bold text-slate-500 uppercase",children:"كود الطيران"}),t.jsx("input",{required:!0,readOnly:i!=="NEW"&&c!==null,className:`w-full p-4 bg-slate-50 border border-slate-200 rounded-2xl font-bold text-lg text-center text-slate-900 outline-none focus:border-indigo-600 focus:bg-white transition-all ${i!=="NEW"&&c!==null?"opacity-50":""}`,value:s.airlineCode,onChange:e=>o({...s,airlineCode:e.target.value})})]}),t.jsxs("div",{className:"space-y-2",children:[t.jsx("label",{className:"text-xs font-bold text-slate-500 uppercase",children:"رقم التذكرة"}),t.jsx("input",{className:"w-full p-4 bg-slate-50 border border-slate-200 rounded-2xl font-bold text-lg text-center text-slate-900 outline-none focus:border-indigo-600 focus:bg-white transition-all",value:s.ticketNumber,onChange:e=>o({...s,ticketNumber:e.target.value}),placeholder:"Ticket #"})]}),t.jsxs("div",{className:"md:col-span-2 space-y-2",children:[t.jsx("label",{className:"text-xs font-bold text-slate-500 uppercase",children:"اسم الراكب"}),t.jsx("input",{className:"w-full p-4 bg-slate-50 border border-slate-200 rounded-2xl font-bold text-lg text-slate-900 outline-none focus:border-indigo-600 focus:bg-white transition-all",value:s.passengerName,onChange:e=>o({...s,passengerName:e.target.value}),placeholder:"Passenger Name"})]}),t.jsxs("div",{className:"md:col-span-2 space-y-2",children:[t.jsx("label",{className:"text-xs font-bold text-slate-500 uppercase",children:"خط السير (Route)"}),t.jsx("input",{className:"w-full p-4 bg-slate-50 border border-slate-200 rounded-2xl font-bold text-lg text-slate-900 outline-none focus:border-indigo-600 focus:bg-white transition-all",value:s.route,onChange:e=>o({...s,route:e.target.value}),placeholder:"e.g. CAI-DXB-CAI"})]}),t.jsxs("div",{className:"space-y-2",children:[t.jsx("label",{className:"text-xs font-bold text-slate-500 uppercase",children:"العميل"}),t.jsx(S,{options:(h||[]).map(e=>({id:e?.id,name:e?.name,subtext:`الرصيد: ${b?"****":x((W.customers||{})[e?.id||""]||0)}`})),value:s.customerId,onChange:e=>o({...s,customerId:e}),disabled:i!=="NEW"&&c!==null,placeholder:"اختر العميل"})]}),t.jsxs("div",{className:"space-y-2",children:[t.jsxs("div",{className:"flex justify-between items-center mb-1",children:[t.jsx("label",{className:"text-[10px] font-bold text-slate-500 uppercase",children:"جهة الشراء (الموفر)"}),t.jsxs("div",{className:"flex bg-slate-100 p-0.5 rounded-lg gap-0.5",children:[t.jsx("button",{type:"button",disabled:i!=="NEW"&&c!==null,onClick:()=>o({...s,supplierType:"SUPPLIER",supplierId:""}),className:`px-2 py-0.5 rounded text-[8px] font-bold transition-all ${s.supplierType==="SUPPLIER"?"bg-white shadow-sm text-indigo-600":"text-slate-400"}`,children:"مورد"}),t.jsx("button",{type:"button",disabled:i!=="NEW"&&c!==null,onClick:()=>o({...s,supplierType:"CUSTOMER",supplierId:""}),className:`px-2 py-0.5 rounded text-[8px] font-bold transition-all ${s.supplierType==="CUSTOMER"?"bg-white shadow-sm text-indigo-600":"text-slate-400"}`,children:"عميل"}),t.jsx("button",{type:"button",disabled:i!=="NEW"&&c!==null,onClick:()=>o({...s,supplierType:"TREASURY",supplierId:""}),className:`px-2 py-0.5 rounded text-[8px] font-bold transition-all ${s.supplierType==="TREASURY"?"bg-white shadow-sm text-indigo-600":"text-slate-400"}`,children:"خزينة"})]})]}),t.jsx(S,{options:s.supplierType==="SUPPLIER"?(M||[]).map(e=>({id:e?.id,name:e?.company||e?.name,subtext:`الرصيد: ${b?"****":x((W.suppliers||{})[e?.id||""]||0)}`})):s.supplierType==="CUSTOMER"?(h||[]).map(e=>({id:e?.id,name:e?.name,subtext:`الرصيد: ${b?"****":x((W.customers||{})[e?.id||""]||0)}`})):(me||[]).map(e=>({id:e?.id,name:e?.name,subtext:`الرصيد: ${b?"****":x(e?.balance||0)}`})),value:s.supplierId,onChange:e=>o({...s,supplierId:e}),disabled:i!=="NEW"&&c!==null,placeholder:`اختر ${s.supplierType==="SUPPLIER"?"المورد":s.supplierType==="CUSTOMER"?"العميل":"الخزينة"}`})]}),t.jsxs("div",{className:"md:col-span-2 space-y-2 bg-slate-50 p-5 rounded-2xl border border-slate-100",children:[t.jsxs("label",{className:"text-xs font-bold text-slate-500 uppercase flex items-center gap-2",children:[t.jsx(ke,{className:"text-indigo-600",size:14})," الموظف المنفذ للعملية"]}),t.jsx(S,{options:(f||[]).map(e=>({id:e?.id,name:e?.name,subtext:`${e?.position} (الرصيد: ${b?"****":x(e?.balance||0)})`})),value:s.employeeId,onChange:e=>{const a=(f||[]).find(l=>l?.id===e);o({...s,employeeId:e,employeeCommissionRate:a?(a.commissionRate||0).toString():s.employeeCommissionRate})},placeholder:"اختر الموظف المسؤول"})]}),t.jsxs("div",{className:"space-y-2 bg-slate-50 p-5 rounded-2xl border border-slate-100",children:[t.jsxs("label",{className:"text-xs font-bold text-slate-500 uppercase flex items-center gap-2",children:[t.jsx(Ae,{className:"text-indigo-600",size:14})," نسبة العمولة %"]}),t.jsx("input",{type:"number",step:"0.1",className:"w-full p-3 bg-white border border-slate-200 rounded-xl font-bold text-slate-900 focus:border-indigo-600 text-center text-lg outline-none transition-all",value:s.employeeCommissionRate,onChange:e=>o({...s,employeeCommissionRate:e.target.value,commissionAmount:""})})]}),t.jsxs("div",{className:"space-y-2 bg-slate-50 p-5 rounded-2xl border border-slate-100",children:[t.jsxs("label",{className:"text-xs font-bold text-slate-500 uppercase flex items-center gap-2",children:[t.jsx(Le,{className:"text-emerald-600",size:14})," أو مبلغ عمولة محدد"]}),t.jsx("input",{type:"number",className:"w-full p-3 bg-white border border-slate-200 rounded-xl font-bold text-slate-900 focus:border-emerald-600 text-center text-lg outline-none transition-all",value:s.commissionAmount,onChange:e=>o({...s,commissionAmount:e.target.value,employeeCommissionRate:""}),placeholder:"مبلغ ثابت"})]}),t.jsxs("div",{className:"space-y-2 bg-slate-50 p-5 rounded-2xl border border-slate-100",children:[t.jsxs("label",{className:"text-xs font-bold text-slate-500 uppercase flex items-center gap-2",children:[t.jsx($e,{className:"text-indigo-600",size:14})," تاريخ الحركة"]}),t.jsx("input",{type:"date",required:!0,className:"w-full p-3 bg-white border border-slate-200 rounded-xl font-bold text-slate-900 focus:border-indigo-600 text-center text-lg outline-none transition-all",value:s.date,onChange:e=>o({...s,date:e.target.value})})]}),ge&&t.jsxs("div",{className:"md:col-span-4 space-y-2 bg-slate-50 p-5 rounded-2xl border border-slate-100",children:[t.jsxs("label",{className:"text-xs font-bold text-slate-500 uppercase flex items-center gap-2",children:[t.jsx(ne,{className:"text-indigo-600",size:14})," مركز التكلفة (Cost Center)"]}),t.jsxs("select",{className:"w-full p-3 bg-white border border-slate-200 rounded-xl font-bold text-slate-900 focus:border-indigo-600 text-center text-lg outline-none transition-all",value:s.costCenterId,onChange:e=>o({...s,costCenterId:e.target.value}),children:[t.jsx("option",{value:"",children:"بدون مركز تكلفة"}),(xe||[]).filter(e=>e&&e.isActive).map(e=>t.jsx("option",{value:e?.id,children:e?.name},e?.id))]})]}),t.jsxs("div",{className:`${s.programId?"md:col-span-1":"md:col-span-2"} space-y-2 bg-slate-50 p-5 rounded-2xl border border-slate-100`,children:[t.jsxs("label",{className:"text-xs font-bold text-slate-500 uppercase flex items-center gap-2",children:[t.jsx(ne,{className:"text-indigo-600",size:14})," ربط ببرنامج عمرة/حج (اختياري)"]}),t.jsx(S,{options:(z||[]).map(e=>({id:e?.id,name:e?.name,subtext:`${e?.type} - ${e?.date}`})),value:s.programId,onChange:e=>{const a=(z||[]).find(r=>r?.id===e),l=(a?.components||[]).find(r=>r?.type==="FLIGHT");o({...s,programId:e,componentId:l?.id||"",masterTripId:a?.masterTripId||s.masterTripId})},placeholder:"اختر البرنامج"})]}),s.programId&&t.jsxs("div",{className:"md:col-span-1 space-y-2 bg-slate-50 p-5 rounded-2xl border border-slate-100",children:[t.jsxs("label",{className:"text-xs font-bold text-slate-500 uppercase flex items-center gap-2",children:[t.jsx(K,{className:"text-indigo-600",size:14})," المكون المرتبط (اختياري)"]}),t.jsxs("select",{className:"w-full p-4 bg-white border border-slate-200 rounded-2xl font-bold text-sm text-slate-900 outline-none focus:border-indigo-600 transition-all",value:s.componentId,onChange:e=>o({...s,componentId:e.target.value}),children:[t.jsx("option",{value:"",children:"اختر المكون..."}),((z||[]).find(e=>e?.id===s.programId)?.components||[]).map(e=>t.jsxs("option",{value:e?.id,children:[e?.name," (",e?.type,")"]},e?.id))]})]}),t.jsxs("div",{className:"md:col-span-2 space-y-2 bg-slate-50 p-5 rounded-2xl border border-slate-100",children:[t.jsxs("label",{className:"text-xs font-bold text-slate-500 uppercase flex items-center gap-2",children:[t.jsx(Fe,{className:"text-indigo-600",size:14})," ربط برحلة مجمعة (Master Trip)"]}),t.jsx(S,{options:(ue||[]).map(e=>({id:e?.id,name:e?.name,subtext:`${e?.type} - ${e?.date}`})),value:s.masterTripId,onChange:e=>o({...s,masterTripId:e}),placeholder:"اختر الرحلة المجمعة"})]})]}),t.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-5 gap-6 p-8 rounded-3xl border border-slate-100 bg-slate-50 bg-opacity-50 shadow-sm",children:[t.jsxs("div",{className:"md:col-span-5 flex flex-wrap items-center justify-between gap-4 bg-white p-4 rounded-2xl border border-slate-100 mb-2",children:[t.jsxs("div",{className:"flex items-center gap-4",children:[t.jsx("div",{className:"w-12 h-12 bg-indigo-50 rounded-xl flex items-center justify-center text-indigo-600",children:t.jsx(De,{size:24})}),t.jsxs("div",{children:[t.jsx("p",{className:"text-[10px] font-bold text-slate-400 uppercase",children:"صافي الربح المتوقع"}),t.jsx("p",{className:`text-2xl font-black ${(i==="REFUND"?parseFloat(s.purchasePrice||"0")-parseFloat(s.sellingPrice||"0"):parseFloat(s.sellingPrice||"0")-parseFloat(s.discount||"0")-parseFloat(s.purchasePrice||"0"))>=0?"text-emerald-600":"text-rose-600"}`,children:x((i==="REFUND"?parseFloat(s.purchasePrice||"0")-parseFloat(s.sellingPrice||"0"):parseFloat(s.sellingPrice||"0")-parseFloat(s.discount||"0")-parseFloat(s.purchasePrice||"0"))*parseFloat(s.exchangeRate||"1"))})]})]}),t.jsxs("div",{className:"flex items-center gap-3 bg-slate-50 px-4 py-2 rounded-xl border border-slate-200",children:[t.jsx("input",{type:"checkbox",id:"applyCommission",className:"w-5 h-5 accent-indigo-600 rounded",checked:s.applyCommission,onChange:e=>o({...s,applyCommission:e.target.checked})}),t.jsx("label",{htmlFor:"applyCommission",className:"text-sm font-bold text-slate-700 cursor-pointer",children:"ترحيل العمولة لحساب الموظف تلقائياً"})]})]}),t.jsxs("div",{className:"space-y-2",children:[t.jsx("label",{className:`text-xs font-bold uppercase text-center block ${i==="REFUND"?"text-rose-600":"text-slate-500"}`,children:i==="REFUND"?"المسترد من المورد":i==="REISSUE"?"فرق التكلفة للمورد":"سعر الشراء (التكلفة)"}),t.jsx("input",{type:"number",required:!0,className:"w-full p-4 bg-rose-50 border border-rose-100 rounded-2xl font-bold text-2xl text-center text-rose-700 outline-none focus:border-rose-300 focus:bg-white transition-all",value:s.purchasePrice,onChange:e=>o({...s,purchasePrice:e.target.value})})]}),t.jsxs("div",{className:"space-y-2",children:[t.jsx("label",{className:`text-xs font-bold uppercase text-center block ${i==="REFUND"?"text-rose-600":"text-emerald-600"}`,children:i==="REFUND"?"المبلغ للعميل":i==="REISSUE"?"فرق السعر على العميل":"سعر البيع للعميل"}),t.jsx("input",{type:"number",required:!0,className:"w-full p-4 bg-emerald-50 border border-emerald-100 rounded-2xl font-bold text-2xl text-center text-emerald-700 outline-none focus:border-emerald-300 focus:bg-white transition-all",value:s.sellingPrice,onChange:e=>o({...s,sellingPrice:e.target.value})})]}),t.jsxs("div",{className:"space-y-2",children:[t.jsx("label",{className:"text-xs font-bold text-rose-600 uppercase text-center block",children:"خصم مسموح به"}),t.jsx("input",{type:"number",className:"w-full p-4 bg-rose-50 border border-rose-100 rounded-2xl font-bold text-2xl text-center text-rose-700 outline-none focus:border-rose-300 focus:bg-white transition-all",value:s.discount,onChange:e=>o({...s,discount:e.target.value})})]}),t.jsxs("div",{className:"space-y-2",children:[t.jsx("label",{className:"text-xs font-bold text-slate-500 uppercase text-center block",children:"العملة"}),t.jsx("select",{className:"w-full p-4 bg-white border border-slate-200 rounded-2xl font-bold text-xl text-center text-slate-900 outline-none focus:border-indigo-600 transition-all",value:s.currencyCode,onChange:e=>{const a=e.target.value,l=(T||[]).find(r=>r?.code===a)?.rateToMain||1;o({...s,currencyCode:a,exchangeRate:l.toString()})},children:(T||[]).map(e=>t.jsx("option",{value:e?.code,children:e?.code},e?.code))})]}),t.jsxs("div",{className:"space-y-2",children:[t.jsx("label",{className:"text-xs font-bold text-slate-500 uppercase text-center block",children:"سعر الصرف"}),t.jsx("input",{type:"number",step:"any",disabled:s.currencyCode===(k?.baseCurrency||"EGP"),className:"w-full p-4 bg-white border border-slate-200 rounded-2xl font-bold text-xl text-center text-slate-900 outline-none focus:border-indigo-600 transition-all disabled:opacity-50",value:s.currencyCode===(k?.baseCurrency||"EGP")?"1":s.exchangeRate,onChange:e=>o({...s,exchangeRate:e.target.value})})]}),t.jsx("div",{className:"flex items-end",children:t.jsx("button",{type:"submit",className:`w-full py-5 rounded-2xl font-bold text-xl shadow-lg transition-all active:scale-95 ${i==="REFUND"?"bg-rose-600 text-white hover:bg-rose-700":i==="REISSUE"?"bg-amber-500 text-white hover:bg-amber-600":"bg-indigo-600 text-white hover:bg-indigo-700"}`,children:i==="REFUND"?"تأكيد الاسترجاع":i==="REISSUE"?"حفظ إعادة الإصدار":"حفظ الحجز الآن"})})]})]})]}),t.jsx("div",{className:"bg-white rounded-3xl shadow-sm border border-slate-100 overflow-hidden",children:t.jsxs("table",{className:"w-full text-right border-collapse",children:[t.jsx("thead",{children:t.jsxs("tr",{className:"bg-indigo-600 text-white",children:[t.jsx("th",{className:"px-6 py-5 border-b border-white border-opacity-20 text-center w-12",children:t.jsx("input",{type:"checkbox",className:"w-5 h-5 accent-white rounded cursor-pointer",checked:$.length>0&&y.length===$.length,onChange:Re})}),t.jsx("th",{className:"px-6 py-5 font-bold text-[10px] uppercase tracking-[0.2em] border-b border-white border-opacity-20",children:"البيان / PNR"}),t.jsx("th",{className:"px-6 py-5 font-bold text-[10px] uppercase tracking-[0.2em] border-b border-white border-opacity-20",children:"العميل المرتبط"}),t.jsx("th",{className:"px-6 py-5 font-bold text-[10px] uppercase tracking-[0.2em] border-b border-white border-opacity-20",children:"المنفذ / العمولة"}),t.jsx("th",{className:"px-6 py-5 font-bold text-[10px] uppercase tracking-[0.2em] border-b border-white border-opacity-20 text-center",children:"التكلفة"}),t.jsx("th",{className:"px-6 py-5 font-bold text-[10px] uppercase tracking-[0.2em] border-b border-white border-opacity-20 text-center",children:"سعر البيع"}),t.jsx("th",{className:"px-6 py-5 font-bold text-[10px] uppercase tracking-[0.2em] border-b border-white border-opacity-20 text-center",children:"صافي الربح"}),t.jsx("th",{className:"px-6 py-5 font-bold text-[10px] uppercase tracking-[0.2em] border-b border-white border-opacity-20 text-center",children:"التحكم"})]})}),t.jsx("tbody",{className:"divide-y divide-slate-50",children:$.map(e=>t.jsxs("tr",{id:`flight-${e.id}`,className:`hover:bg-slate-50 bg-opacity-50 transition-all group duration-300 ${fe===e.id?"ring-4 ring-indigo-500 border-indigo-500 bg-indigo-50/30 scale-[1.002] z-10 shadow-2xl":e.category==="FLIGHT_REFUND"?"bg-rose-50 bg-opacity-10":e.category==="FLIGHT_REISSUE"?"bg-amber-50 bg-opacity-10":""}`,children:[t.jsx("td",{className:"px-6 py-5 text-center",children:t.jsx("input",{type:"checkbox",className:"w-5 h-5 accent-indigo-600 rounded cursor-pointer",checked:y.includes(e.id),onChange:()=>Ee(e.id)})}),t.jsx("td",{className:"px-6 py-5",children:t.jsxs("div",{className:"flex flex-col",children:[t.jsxs("span",{className:"text-slate-900 font-bold text-lg uppercase flex items-center gap-2 tracking-tight group-hover:text-indigo-600 transition-colors",children:[e?.category==="FLIGHT_REFUND"&&t.jsx(de,{size:16,className:"text-rose-500"}),e?.category==="FLIGHT_REISSUE"&&t.jsx(B,{size:16,className:"text-amber-500"}),e?.pnr||"---"]}),e?.passengerName&&t.jsxs("span",{className:"text-[10px] font-bold text-slate-500 mt-1 flex items-center gap-1",children:[t.jsx(oe,{size:10,className:"text-indigo-400"})," ",e.passengerName]}),e?.ticketNumber&&t.jsxs("span",{className:"text-[9px] font-bold text-slate-400 font-mono flex items-center gap-1",children:[t.jsx(K,{size:10,className:"text-indigo-300"})," ",e.ticketNumber]}),e?.route&&t.jsxs("span",{className:"text-[9px] font-bold text-indigo-400 flex items-center gap-1 mt-0.5",children:[t.jsx(re,{size:10})," ",e.route]}),e?.refNo?t.jsxs("button",{onClick:()=>{e?.refNo&&navigator.clipboard.writeText(e.refNo);const a=document.getElementById(`ref-fl-${e?.id}`);if(a){const l=a.innerText;a.innerText="تم النسخ",setTimeout(()=>{a.innerText=l},1e3)}},id:`ref-fl-${e?.id}`,className:"text-[9px] text-indigo-600 font-bold uppercase tracking-tighter hover:text-indigo-800 transition-all",title:"اضغط للنسخ والبحث",children:["REF: #",e.refNo]}):t.jsxs("span",{className:"text-[9px] text-indigo-600 font-bold uppercase tracking-tighter",children:["REF: #",(e?.id||"").slice(-6).toUpperCase()]}),t.jsxs("span",{className:"text-[9px] text-indigo-600 font-bold uppercase tracking-tighter",children:["| ",(e?.description||"").split(" - ")[0]]})]})}),t.jsx("td",{className:"px-6 py-5",children:t.jsx("span",{className:"text-slate-700 font-bold text-sm",children:(h||[]).find(a=>a?.id===e?.relatedEntityId)?.name||"---"})}),t.jsx("td",{className:"px-6 py-5",children:t.jsxs("div",{className:"flex flex-col gap-1.5",children:[t.jsxs("span",{className:"inline-flex items-center gap-2 px-3 py-1 bg-slate-100 text-slate-700 text-[10px] font-bold rounded-lg border border-slate-200 transition-all",children:[t.jsx(oe,{size:12,className:"text-indigo-600"}),(f||[]).find(a=>a?.id===e?.employeeId)?.name||"---"]}),t.jsxs("div",{className:"flex items-center gap-1.5 px-1",children:[t.jsx("div",{className:"w-1.5 h-1.5 bg-indigo-400 rounded-full"}),t.jsxs("span",{className:"text-[9px] text-indigo-600 font-bold uppercase",children:["العمولة: ",b?"****":e.employeeCommissionRate||0,"%"]})]})]})}),t.jsxs("td",{className:`px-6 py-5 text-center font-bold text-base tabular-nums ${e.category==="FLIGHT_REFUND"?"text-emerald-600":"text-rose-600"}`,children:[e.category==="FLIGHT_REFUND"?"+":"-",Y?"****":x((e.purchasePrice||0)*(e.exchangeRate||1))]}),t.jsxs("td",{className:`px-6 py-5 text-center font-bold text-base tabular-nums ${e.category==="FLIGHT_REFUND"?"text-rose-600":"text-emerald-600"}`,children:[e.category==="FLIGHT_REFUND"?"-":"+",b?"****":x((e.sellingPrice||0)*(e.exchangeRate||1))]}),t.jsx("td",{className:"px-6 py-5 text-center",children:t.jsx("div",{className:"bg-slate-50 p-3 rounded-xl border border-slate-100 group-hover:bg-white transition-all",children:t.jsx("span",{className:"font-bold text-xl text-slate-900 tabular-nums",children:Y?"****":x((e.category==="FLIGHT_REFUND"?(e.purchasePrice||0)-(e.sellingPrice||0):(e.sellingPrice||0)-(e.purchasePrice||0))*(e.exchangeRate||1))})})}),t.jsx("td",{className:"px-6 py-5",children:t.jsxs("div",{className:"flex justify-center gap-2",children:[e.category==="FLIGHT"&&t.jsxs(t.Fragment,{children:[t.jsx("button",{onClick:()=>ae(e),className:"p-2.5 bg-rose-50 text-rose-500 rounded-xl hover:bg-rose-500 hover:text-white transition-all active:scale-90",title:"استرجاع (Refund)",children:t.jsx(de,{size:18})}),t.jsx("button",{onClick:()=>Ie(e),className:"p-2.5 bg-amber-50 text-amber-500 rounded-xl hover:bg-amber-500 hover:text-white transition-all active:scale-90",title:"إعادة إصدار (Reissue)",children:t.jsx(B,{size:18})})]}),t.jsx("button",{onClick:()=>je(e),className:"p-2.5 bg-slate-100 text-slate-600 rounded-xl hover:bg-slate-900 hover:text-white transition-all active:scale-90",children:t.jsx(Me,{size:18})}),g.role==="ADMIN"&&t.jsx("button",{onClick:()=>V(e.id),className:"p-2.5 bg-rose-50 text-rose-500 rounded-xl hover:bg-rose-500 hover:text-white transition-all active:scale-90",children:t.jsx(ie,{size:18})})]})})]},e.id))})]})})]})};export{Je as default};
