import{r as h,j as e,m as C,h as U,i as I,Q as j,H as k}from"./index-DY8MtJq0-v301.js";import{T as O}from"./triangle-alert-nhzk-x01-v301.js";const P=({customers:r,suppliers:o,journalEntries:N,addTransaction:S,transactions:m,currencies:b,currentUser:y,formatCurrency:c,costCenters:E,enableCostCenters:T,settings:x,initialEditingId:g,onClearInitialEdit:v})=>{const p=y?.permissions?.includes("HIDE_FINANCIAL_AMOUNTS");y?.role;const u=h.useMemo(()=>{const t={},a={};return(r||[]).forEach(d=>{d?.id&&(t[d.id]=d.openingBalanceInBase||0)}),(o||[]).forEach(d=>{d?.id&&(a[d.id]=d.openingBalanceInBase||0)}),(N||[]).forEach(d=>{d?.lines&&(d.lines||[]).forEach(l=>{l?.accountId&&(l.accountType==="CUSTOMER"&&t[l.accountId]!==void 0?t[l.accountId]+=(l.debit||0)-(l.credit||0):l.accountType==="SUPPLIER"&&a[l.accountId]!==void 0&&(a[l.accountId]+=(l.credit||0)-(l.debit||0)))})}),{customers:t,suppliers:a}},[r,o,N]),[n,f]=h.useState("C_S"),[R,w]=h.useState(null);h.useEffect(()=>{if(g){const t=(m||[]).find(a=>a?.id===g);t&&(w(t.id),setTimeout(()=>{const a=document.getElementById(`clearing-${t.id}`);a&&(a.scrollIntoView({behavior:"smooth",block:"center"}),setTimeout(()=>w(null),3e3))},500)),v?.()}},[g,m,v]);const[s,i]=h.useState({fromId:"",toId:"",amount:"",currencyCode:x?.baseCurrency||"EGP",exchangeRate:"1",date:new Date().toISOString().split("T")[0],description:"مقاصة وتحويل أرصدة",costCenterId:""});(b||[]).find(t=>t?.code===s.currencyCode);const _=t=>{t.preventDefault();const a=parseFloat(s.amount);if(!a||!s.fromId||!s.toId)return;let d="CUSTOMER",l="SUPPLIER";n==="C_S"?(d="SUPPLIER",l="CUSTOMER"):n==="C_C"?(d="CUSTOMER",l="CUSTOMER"):n==="S_S"&&(d="SUPPLIER",l="SUPPLIER"),S({description:s.description,amount:a,currencyCode:s.currencyCode,exchangeRate:parseFloat(s.exchangeRate||"1"),type:"CLEARING",category:"ACCOUNT_CLEARING",date:s.date,relatedEntityId:s.fromId,relatedEntityType:d,targetEntityId:s.toId,targetEntityType:l,costCenterId:s.costCenterId||void 0}),i({...s,amount:"",fromId:"",toId:"",costCenterId:"",currencyCode:x?.baseCurrency||"EGP",exchangeRate:"1"}),alert("✅ تمت عملية التسوية بنجاح وتم ترحيل القيود للأطراف المعنية")};return e.jsxs("div",{className:"space-y-8 animate-in fade-in duration-500",children:[e.jsx("div",{className:"bg-white p-8 rounded-3xl shadow-xl border-b-8 border-indigo-600",children:e.jsxs("div",{className:"flex items-center gap-6",children:[e.jsx("div",{className:"w-16 h-16 bg-indigo-600 text-white rounded-2xl flex items-center justify-center shadow-lg",children:e.jsx(C,{size:32})}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-3xl font-bold text-slate-900",children:"المقاصة والتسويات المتقدمة"}),e.jsx("p",{className:"text-slate-400 font-bold text-sm",children:"إدارة الحسابات المتقابلة والتحويلات بين العملاء والموردين"})]})]})}),e.jsxs("div",{className:"flex bg-white p-2 rounded-2xl shadow-md border max-w-fit mx-auto",children:[e.jsx("button",{onClick:()=>f("C_S"),className:`px-8 py-3 rounded-xl font-bold text-sm transition-all ${n==="C_S"?"bg-indigo-600 text-white shadow-lg":"text-slate-400 hover:bg-slate-50"}`,children:"عميل ↔ مورد"}),e.jsx("button",{onClick:()=>f("C_C"),className:`px-8 py-3 rounded-xl font-bold text-sm transition-all ${n==="C_C"?"bg-indigo-600 text-white shadow-lg":"text-slate-400 hover:bg-slate-50"}`,children:"عميل ↔ عميل"}),e.jsx("button",{onClick:()=>f("S_S"),className:`px-8 py-3 rounded-xl font-bold text-sm transition-all ${n==="S_S"?"bg-indigo-600 text-white shadow-lg":"text-slate-400 hover:bg-slate-50"}`,children:"مورد ↔ مورد"})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-8",children:[e.jsx("div",{className:"lg:col-span-2 bg-white p-12 rounded-3xl shadow-2xl border-4 border-indigo-50",children:e.jsxs("form",{onSubmit:_,className:"space-y-10",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-10",children:[e.jsxs("div",{className:"space-y-3",children:[e.jsxs("label",{className:"text-xs font-bold text-slate-400 uppercase flex items-center gap-2",children:[e.jsx(U,{size:14}),n==="C_S"?"خصم من حساب (المورد)":"خصم من حساب"]}),e.jsx(I,{options:n==="S_S"||n==="C_S"?(o||[]).map(t=>({id:t?.id,name:t?.company,subtext:`الرصيد: ${p?"****":c(u.suppliers[t?.id||""]||0)}`})):(r||[]).map(t=>({id:t?.id,name:t?.name,subtext:`الرصيد: ${p?"****":c(u.customers[t?.id||""]||0)}`})),value:s.fromId,onChange:t=>i({...s,fromId:t}),placeholder:"اختر الطرف الأول"})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("label",{className:"text-xs font-bold text-slate-400 uppercase flex items-center gap-2",children:[e.jsx(j,{size:14}),n==="C_S"?"تخفيض مديونية (العميل)":"تحويل لصالح حساب"]}),e.jsx(I,{options:n==="S_S"?(o||[]).map(t=>({id:t?.id,name:t?.company,subtext:`الرصيد: ${p?"****":c(u.suppliers[t?.id||""]||0)}`})):(r||[]).map(t=>({id:t?.id,name:t?.name,subtext:`الرصيد: ${p?"****":c(u.customers[t?.id||""]||0)}`})),value:s.toId,onChange:t=>i({...s,toId:t}),placeholder:"اختر الطرف الثاني"})]})]}),e.jsxs("div",{className:"bg-slate-900 p-10 rounded-3xl text-white flex flex-col items-center gap-6 shadow-2xl relative overflow-hidden",children:[e.jsx(j,{className:"text-indigo-500 absolute top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 opacity-10",size:150}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-8 w-full relative z-10",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-[10px] font-bold text-indigo-300 uppercase block text-center",children:"المبلغ المراد تسويته"}),e.jsx("input",{type:"number",required:!0,className:"w-full p-5 bg-white/10 border-2 border-white/20 rounded-2xl font-bold text-3xl text-center text-indigo-400 outline-none focus:border-indigo-400",value:s.amount,onChange:t=>i({...s,amount:t.target.value})})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-[10px] font-bold text-indigo-300 uppercase block text-center",children:"عملة التسوية"}),e.jsx("select",{className:"w-full p-5 bg-white/10 border-2 border-white/20 rounded-2xl font-bold text-2xl text-center text-white outline-none",value:s.currencyCode,onChange:t=>{const a=t.target.value,d=(b||[]).find(l=>l&&l.code===a)?.rateToMain||1;i({...s,currencyCode:a,exchangeRate:d.toString()})},children:(b||[]).map(t=>t&&e.jsx("option",{value:t.code,className:"text-slate-900",children:t.code},t.code))})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("label",{className:"text-[10px] font-bold text-indigo-300 uppercase block text-center",children:["سعر الصرف (",x?.baseCurrency,")"]}),e.jsx("input",{type:"number",step:"any",disabled:s.currencyCode===x?.baseCurrency,className:"w-full p-5 bg-white/10 border-2 border-white/20 rounded-2xl font-bold text-2xl text-center text-white outline-none focus:border-indigo-400 disabled:opacity-50",value:s.currencyCode===x?.baseCurrency?"1":s.exchangeRate,onChange:t=>i({...s,exchangeRate:t.target.value})})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-[10px] font-bold text-indigo-300 uppercase block text-center",children:"تاريخ العملية"}),e.jsx("input",{type:"date",className:"w-full p-5 bg-white/10 border-2 border-white/20 rounded-2xl font-bold text-lg text-center text-white outline-none",value:s.date,onChange:t=>i({...s,date:t.target.value})})]})]}),e.jsxs("div",{className:"w-full space-y-2 relative z-10",children:[e.jsx("label",{className:"text-[10px] font-bold text-indigo-300 uppercase block",children:"البيان / ملاحظات العملية"}),e.jsx("input",{required:!0,className:"w-full p-4 bg-white/5 border-2 border-white/10 rounded-xl font-bold text-white text-center",value:s.description,onChange:t=>i({...s,description:t.target.value})})]}),T&&e.jsxs("div",{className:"w-full space-y-2 relative z-10",children:[e.jsx("label",{className:"text-[10px] font-bold text-indigo-300 uppercase block",children:"مركز التكلفة (اختياري)"}),e.jsxs("select",{className:"w-full p-4 bg-white/10 border-2 border-white/20 rounded-xl font-bold text-white text-center outline-none",value:s.costCenterId,onChange:t=>i({...s,costCenterId:t.target.value}),children:[e.jsx("option",{value:"",className:"text-slate-900",children:"بدون مركز تكلفة"}),(E||[]).filter(t=>t&&t.isActive).map(t=>e.jsx("option",{value:t.id,className:"text-slate-900",children:t.name},t.id))]})]})]}),e.jsx("div",{className:"flex justify-end pt-6",children:e.jsx("button",{type:"submit",className:"bg-slate-900 text-indigo-400 px-24 py-6 rounded-3xl font-bold text-3xl shadow-2xl hover:bg-indigo-700 hover:text-white transition-all transform hover:scale-105 active:scale-95",children:"إتمام العملية الآن"})})]})}),e.jsx("div",{className:"space-y-6",children:e.jsxs("div",{className:"bg-white p-8 rounded-3xl shadow-xl border border-indigo-50",children:[e.jsxs("h3",{className:"text-xl font-bold text-slate-900 mb-6 flex items-center gap-3",children:[e.jsx(O,{className:"text-indigo-600"})," تنبيه محاسبي"]}),e.jsxs("p",{className:"text-slate-500 font-bold leading-relaxed text-sm",children:["تُستخدم هذه الواجهة لإجراء التسويات المباشرة بين الحسابات دون الحاجة لصرف أو قبض نقدية. مثالية لحالات:",e.jsx("br",{}),e.jsx("br",{}),"1. العميل الذي يورد خدمة للمؤسسة (خصم مستحقاته من مديونيته).",e.jsx("br",{}),"2. تحويل مبالغ من عميل لآخر.",e.jsx("br",{}),"3. تسوية حسابات الموردين البينية."]})]})})]}),e.jsxs("div",{className:"bg-white rounded-3xl shadow-xl border border-slate-100 overflow-hidden",children:[e.jsx("div",{className:"bg-slate-900 p-6 flex items-center justify-between",children:e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"w-10 h-10 bg-indigo-500/20 rounded-xl flex items-center justify-center text-indigo-400",children:e.jsx(k,{size:20})}),e.jsx("h3",{className:"text-white font-bold text-lg",children:"سجل عمليات التسوية الأخيرة"})]})}),e.jsxs("div",{className:"overflow-x-auto",children:[e.jsxs("table",{className:"w-full text-right",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"bg-slate-50 border-b border-slate-100",children:[e.jsx("th",{className:"px-8 py-5 text-xs font-bold text-slate-500 uppercase tracking-widest",children:"التاريخ"}),e.jsx("th",{className:"px-8 py-5 text-xs font-bold text-slate-500 uppercase tracking-widest",children:"البيان"}),e.jsx("th",{className:"px-8 py-5 text-xs font-bold text-slate-500 uppercase tracking-widest",children:"من حساب"}),e.jsx("th",{className:"px-8 py-5 text-xs font-bold text-slate-500 uppercase tracking-widest text-center",children:"→"}),e.jsx("th",{className:"px-8 py-5 text-xs font-bold text-slate-500 uppercase tracking-widest",children:"إلى حساب"}),e.jsx("th",{className:"px-8 py-5 text-xs font-bold text-slate-500 uppercase tracking-widest text-left",children:"المبلغ"})]})}),e.jsx("tbody",{className:"divide-y divide-slate-50",children:(m||[]).filter(t=>t?.category==="ACCOUNT_CLEARING").sort((t,a)=>(a.date||"").localeCompare(t.date||"")).map(t=>e.jsxs("tr",{id:`clearing-${t?.id}`,className:`hover:bg-slate-50/80 transition-all duration-300 group ${R===t?.id?"ring-4 ring-indigo-500 border-indigo-500 bg-indigo-50/30 scale-[1.002] z-10 shadow-2xl":""}`,children:[e.jsx("td",{className:"px-8 py-5",children:e.jsx("span",{className:"text-slate-500 font-bold text-xs",children:t?.date})}),e.jsxs("td",{className:"px-8 py-5",children:[e.jsx("p",{className:"font-bold text-slate-900 text-sm",children:t?.description}),e.jsxs("span",{className:"text-[10px] text-indigo-600 font-bold uppercase tracking-tighter",children:["REF: #",t?.refNo||t?.id?.slice(-6).toUpperCase()]})]}),e.jsx("td",{className:"px-8 py-5",children:e.jsxs("div",{className:"flex flex-col",children:[e.jsx("span",{className:"text-slate-700 font-bold text-sm",children:t?.relatedEntityType==="CUSTOMER"?(r||[]).find(a=>a?.id===t?.relatedEntityId)?.name:(o||[]).find(a=>a?.id===t?.relatedEntityId)?.company}),e.jsx("span",{className:"text-[10px] text-slate-400 font-bold uppercase",children:t?.relatedEntityType==="CUSTOMER"?"عميل":"مورد"})]})}),e.jsx("td",{className:"px-8 py-5 text-center",children:e.jsx(j,{size:16,className:"text-slate-300 mx-auto"})}),e.jsx("td",{className:"px-8 py-5",children:e.jsxs("div",{className:"flex flex-col",children:[e.jsx("span",{className:"text-slate-700 font-bold text-sm",children:t?.targetEntityType==="CUSTOMER"?(r||[]).find(a=>a?.id===t?.targetEntityId)?.name:(o||[]).find(a=>a?.id===t?.targetEntityId)?.company}),e.jsx("span",{className:"text-[10px] text-slate-400 font-bold uppercase",children:t?.targetEntityType==="CUSTOMER"?"عميل":"مورد"})]})}),e.jsx("td",{className:"px-8 py-5 text-left",children:e.jsx("span",{className:"text-lg font-black text-slate-900 tabular-nums",children:p?"****":c(t?.amountInBase||t?.amount||0)})})]},t?.id))})]}),(m||[]).filter(t=>t?.category==="ACCOUNT_CLEARING").length===0&&e.jsxs("div",{className:"p-20 text-center",children:[e.jsx("div",{className:"w-16 h-16 bg-slate-50 rounded-2xl flex items-center justify-center mx-auto mb-4 border border-dashed border-slate-200",children:e.jsx(C,{size:32,className:"text-slate-200"})}),e.jsx("p",{className:"text-slate-400 font-bold text-sm",children:"لا توجد عمليات تسوية سابقة"})]})]})]})]})};export{P as default};
